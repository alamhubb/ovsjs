---
description: OVSé¡¹ç›®ä¿¡æ¯ - å£°æ˜å¼UIæ¡†æ¶é¡¹ç›®è§„èŒƒä¸å¼€å‘æŒ‡å—
alwaysApply: true
---

# OVS - å£°æ˜å¼UIæ¡†æ¶é¡¹ç›®

## é¡¹ç›®å®šä½
å£°æ˜å¼UIæ¡†æ¶ï¼Œä½¿ç”¨ç±»ä¼¼Flutter/SwiftUIçš„è¯­æ³•å¼€å‘Vueåº”ç”¨ï¼Œæä¾›é›¶è¿è¡Œæ—¶å¼€é”€çš„ç¼–è¯‘æ—¶è½¬æ¢

**æ ¸å¿ƒä»·å€¼ï¼š**
- è®©å‰ç«¯å¼€å‘è€…ç”¨æ›´ç›´è§‚çš„è¯­æ³•ç¼–å†™UI
- ç¼–è¯‘æ—¶è½¬æ¢ï¼Œé›¶è¿è¡Œæ—¶å¼€é”€
- å®Œæ•´çš„TypeScriptæ”¯æŒå’Œç±»å‹å®‰å…¨

## å½“å‰é˜¶æ®µ
STAGE_4_OPTIMIZATION

## å½“å‰çŠ¶æ€
- âœ… æ ¸å¿ƒåŠŸèƒ½ï¼š100% å®Œæˆ
- âœ… é«˜çº§åŠŸèƒ½ï¼š100% å®Œæˆï¼ˆ13ä¸ªæµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼‰
- âœ… æ™ºèƒ½IIFEä¼˜åŒ–ï¼šå®Œæˆï¼ˆç®€å•è§†å›¾é›¶å¼€é”€ï¼Œå¤æ‚è§†å›¾å®Œæ•´æ”¯æŒï¼‰
- âœ… ç»„ä»¶ç³»ç»Ÿï¼šå®Œæˆï¼ˆovsViewç»„ä»¶å£°æ˜ã€props/childå±æ€§ä¼ é€’ï¼‰
- âœ… ReactiveVNodeé›†æˆï¼šå®Œæˆï¼ˆä½¿ç”¨è‡ªå°è£…çš„å“åº”å¼VNode APIï¼‰
- âœ… `#{}` ä¸æ¸²æŸ“å—ï¼šå®Œæˆï¼ˆ2025-10-24ï¼Œæ”¯æŒä»£ç éš”ç¦»ï¼‰
- âœ… æ™ºèƒ½æ¸²æŸ“åˆ¤æ–­ï¼šå®Œæˆï¼ˆå…ƒç´ ä¼˜å…ˆï¼Œé»˜è®¤æ¸²æŸ“ï¼Œ`#{}` éš”ç¦»ï¼‰
- âœ… æ³¨é‡Šæ”¯æŒï¼šå®Œæ•´å®ç°ï¼ˆå•è¡Œ//ã€å¤šè¡Œ/**/ï¼‰
- âœ… æµ‹è¯•è¦†ç›–ï¼šå®Œå–„ï¼ˆ13ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰
- âœ… ç”Ÿäº§å¯ç”¨ï¼šåŠŸèƒ½ç¨³å®šï¼Œæ€§èƒ½ä¼˜ç§€
- ç‰ˆæœ¬ï¼š0.2.0ï¼ˆ`#{}` ä¸æ¸²æŸ“å— + æ™ºèƒ½æ¸²æŸ“ç³»ç»Ÿï¼‰
- å¼€å‘æœåŠ¡å™¨ï¼šhttp://localhost:5175ï¼ˆå®æ—¶çƒ­æ›´æ–°ï¼‰

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨
- æµ‹è¯•ç»„ä»¶ç³»ç»Ÿçš„å„ç§ä½¿ç”¨åœºæ™¯
- å®Œå–„ç»„ä»¶æ–‡æ¡£å’Œç¤ºä¾‹
- ä¼˜åŒ–å·²çŸ¥é™åˆ¶ï¼ˆé™¤æ³•è¿ç®—ã€Class constructorå‚æ•°ã€æ³¨é‡Šç¨³å®šæ€§ï¼‰
- **æ ¸å¿ƒä¼˜å…ˆçº§**ï¼šå¼€å‘VSCodeè¯­è¨€æ”¯æŒæ’ä»¶ï¼ˆè¯­æ³•é«˜äº®+æ™ºèƒ½æç¤ºï¼‰

## ç«äº‰åŠ›åˆ†æ

### âœ… æŠ€æœ¯ä¼˜åŠ¿
- **é›¶è¿è¡Œæ—¶å¼€é”€**ï¼šçº¯ç¼–è¯‘æ—¶è½¬æ¢ï¼Œæ€§èƒ½æ— æŸ
- **å®Œæ•´ç»„ä»¶ç³»ç»Ÿ**ï¼špropsã€slotsã€åµŒå¥—å®Œæ•´æ”¯æŒ
- **æ™ºèƒ½ä¼˜åŒ–**ï¼šç®€å•è§†å›¾é›¶IIFEï¼Œå¤æ‚è§†å›¾å®Œæ•´æ”¯æŒ
- **è¯­æ³•ç›´è§‚**ï¼šå£°æ˜å¼é£æ ¼ï¼Œç±»ä¼¼Flutter/SwiftUI
- **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´TypeScriptæ”¯æŒ

### âš ï¸ ä¸¥å³»æŒ‘æˆ˜
- **ç”Ÿæ€ç¼ºå¤±**ï¼ˆæœ€å¤§é—®é¢˜ï¼‰ï¼šæ— IDEæ”¯æŒã€è°ƒè¯•å·¥å…·ã€ç»„ä»¶åº“ã€ç¤¾åŒº
- **å¸‚åœºå®šä½æ¨¡ç³Š**ï¼šJSX/TSXç”Ÿæ€æˆç†Ÿï¼ŒVue SFCå®˜æ–¹æ¨è
- **å­¦ä¹ æˆæœ¬**ï¼šæ–°è¯­æ³•ã€è°ƒè¯•å›°éš¾ã€å›¢é˜Ÿåä½œæˆæœ¬é«˜
- **åŠŸèƒ½é™åˆ¶**ï¼šé™¤æ³•è¿ç®—ã€æ³¨é‡Šä¸ç¨³å®šã€å¤æ‚è¡¨è¾¾å¼æ”¯æŒæœ‰é™

### ğŸ’¡ å‘å±•æ–¹å‘å»ºè®®

**çŸ­æœŸï¼ˆ3-6ä¸ªæœˆï¼‰- å¿…éœ€åŸºç¡€è®¾æ–½**
1. **VSCodeæ’ä»¶**ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
   - è¯­æ³•é«˜äº®
   - é”™è¯¯æç¤º
   - æ™ºèƒ½è¡¥å…¨
   - Source Mapæ”¯æŒ

2. **æ ¸å¿ƒé™åˆ¶ä¿®å¤**
   - é™¤æ³•è¿ç®—ç¬¦æ”¯æŒ
   - æ³¨é‡Šç¨³å®šæ€§
   - é”™è¯¯æç¤ºä¼˜åŒ–

3. **æ–‡æ¡£å’Œç¤ºä¾‹**
   - 10+çœŸå®é¡¹ç›®ç¤ºä¾‹
   - JSX/Vue SFCè¿ç§»æŒ‡å—
   - æ€§èƒ½å¯¹æ¯”æ•°æ®

**ä¸­æœŸï¼ˆ6-12ä¸ªæœˆï¼‰- å·®å¼‚åŒ–å®šä½**

**é€‰é¡¹Aï¼šAIä»£ç ç”Ÿæˆåœºæ™¯**
- OVSè¯­æ³•ç»“æ„åŒ–ï¼ŒAIæ›´å®¹æ˜“ç”Ÿæˆ
- æä¾›"è‡ªç„¶è¯­è¨€â†’OVS"å·¥å…·
- ç›®æ ‡ï¼šéç¨‹åºå‘˜ç”¨AIç”ŸæˆUI

**é€‰é¡¹Bï¼šå¿«é€ŸåŸå‹å·¥å…·**
- å¯è§†åŒ–ç¼–è¾‘å™¨ â†” OVSä»£ç åŒå‘åŒæ­¥
- ç±»ä¼¼Figmaâ†’Codeä½†è¯­æ³•æ›´ç®€æ´
- ç›®æ ‡ï¼šè®¾è®¡å¸ˆ/äº§å“ç»ç†å¿«é€ŸéªŒè¯

**é€‰é¡¹Cï¼šæ•™è‚²é¢†åŸŸ**
- è¯­æ³•ç®€å•ï¼Œé€‚åˆåˆå­¦è€…
- æä¾›åœ¨çº¿playground
- ç›®æ ‡ï¼šç¼–ç¨‹æ•™è‚²å¸‚åœº

**é•¿æœŸï¼ˆ1-2å¹´ï¼‰- è·¨æ¡†æ¶DSL**
- ç¼–è¯‘åˆ°React/Solid.js
- æˆä¸ºè·¨æ¡†æ¶çš„UIæè¿°è¯­è¨€

### ğŸ“Š ç°å®è¯„ä¼°

**æŠ€æœ¯å±‚é¢**ï¼šâ­â­â­â­â˜† ï¼ˆ4/5ï¼‰å®ç°ä¼˜ç§€ï¼Œæœ‰åˆ›æ–°
**ç”Ÿæ€å±‚é¢**ï¼šâ­â˜†â˜†â˜†â˜† ï¼ˆ1/5ï¼‰å‡ ä¹ä¸ºé›¶ï¼Œè‡´å‘½çŸ­æ¿
**å¸‚åœºå±‚é¢**ï¼šâ­â­â˜†â˜†â˜† ï¼ˆ2/5ï¼‰å®šä½ä¸æ¸…æ™°ï¼Œç«äº‰æ¿€çƒˆ

**æ®‹é…·çœŸç›¸**ï¼š
- 90%çš„å‰ç«¯å¼€å‘è€…ä¸ä¼šåˆ‡æ¢åˆ°æ–°è¯­æ³•ï¼ˆé™¤éæœ‰10å€ä¼˜åŠ¿ï¼‰
- JSX/TSXå·²ç»"è¶³å¤Ÿå¥½"ï¼ˆç”Ÿæ€+å·¥å…·+ä¹ æƒ¯ï¼‰
- æ–°è¯­è¨€éœ€è¦3-5å¹´æ‰èƒ½å»ºç«‹ç”Ÿæ€

**å¯èƒ½çš„çªç ´ç‚¹**ï¼š
1. ä¸ä¸JSXæ­£é¢ç«äº‰ï¼Œæ‰¾å‚ç›´åœºæ™¯ï¼ˆAIç”Ÿæˆã€å¯è§†åŒ–ç¼–è¾‘ï¼‰
2. é™ä½é—¨æ§›ï¼Œæä¾›JSXâ†”OVSè½¬æ¢å·¥å…·
3. æ€æ‰‹çº§ç‰¹æ€§ï¼Œæ‰¾åˆ°JSXåšä¸å¥½ä½†OVSèƒ½åšçš„åœºæ™¯

### ğŸ¯ æˆ˜ç•¥å»ºè®®

**å¦‚æœç›®æ ‡æ˜¯å­¦ä¹ /ç ”ç©¶**
- âœ… ç»§ç»­å®Œå–„ï¼Œä¼˜ç§€çš„ç¼–è¯‘å™¨å­¦ä¹ é¡¹ç›®
- âœ… å¯ä»¥å‘Paperæˆ–æŠ€æœ¯åšå®¢
- âœ… ä½œä¸ºPortfolioå±•ç¤ºæŠ€æœ¯èƒ½åŠ›

**å¦‚æœç›®æ ‡æ˜¯å•†ä¸šåŒ–/æ¨å¹¿**
- âš ï¸ å…ˆåšVSCodeæ’ä»¶ï¼ˆå¿…éœ€ï¼‰
- âš ï¸ å…ˆæ‰¾å‡†1ä¸ªå‚ç›´åœºæ™¯ï¼ˆAIç”Ÿæˆï¼Ÿï¼‰
- âš ï¸ ä¸è¦ä¸JSXæ­£é¢ç«äº‰

**å¦‚æœç›®æ ‡æ˜¯ä¸ªäºº/å°å›¢é˜Ÿä½¿ç”¨**
- âœ… å›¢é˜Ÿå–œæ¬¢è¿™ç§è¯­æ³•å°±å¯ä»¥ç”¨
- âš ï¸ åšå¥½é•¿æœŸç»´æŠ¤çš„å‡†å¤‡
- âš ï¸ ç•™å¥½é€€è·¯ï¼ˆæ”¯æŒå¯¼å‡ºä¸ºJSXï¼‰

**å½“å‰é˜¶æ®µå»ºè®®**ï¼š
ä¼˜å…ˆå®ŒæˆVSCodeæ’ä»¶ï¼Œè¿™æ˜¯ä»»ä½•ç¼–ç¨‹è¯­è¨€çš„ç”Ÿå­˜åŸºç¡€ã€‚æ²¡æœ‰IDEæ”¯æŒï¼Œè¿è‡ªå·±ç”¨éƒ½è´¹åŠ²ï¼Œæ›´åˆ«è¯´æ¨å¹¿äº†ã€‚

---

# ã€æ ¸å¿ƒéœ€æ±‚å±‚ã€‘

## æ ¸å¿ƒåŠŸèƒ½ï¼ˆç”¨æˆ·èƒ½åšä»€ä¹ˆï¼‰
- **å£°æ˜å¼UIç¼–å†™**ï¼šç”¨ç®€æ´çš„è¯­æ³•ç¼–å†™å¤æ‚UI
- **ç»„ä»¶ç³»ç»Ÿ**ï¼šä½¿ç”¨ `ovsView` å£°æ˜å¯å¤ç”¨ç»„ä»¶
- **å±æ€§ä¼ é€’**ï¼šé€šè¿‡ attrs å¯¹è±¡ä¼ é€’ç»„ä»¶å±æ€§
- **å®Œæ•´JavaScriptæ”¯æŒ**ï¼šå‡½æ•°ã€å¾ªç¯ã€é¢å‘å¯¹è±¡ã€è¿ç®—ç¬¦ã€æ§åˆ¶æµ
- **æ™ºèƒ½å¯¼å‡ºç³»ç»Ÿ**ï¼šè‡ªåŠ¨è¯†åˆ«å¯¼å‡ºæ–¹å¼ï¼ˆé»˜è®¤ã€å‘½åã€è‡ªåŠ¨åŒ…è£¹ï¼‰
- **å®æ—¶å¼€å‘ä½“éªŒ**ï¼šçƒ­æ›´æ–°ã€å³æ—¶ç¼–è¯‘é¢„è§ˆ
- **ç±»å‹å®‰å…¨å¼€å‘**ï¼šå®Œæ•´TypeScriptæ”¯æŒ

## äº¤äº’/æ¥å£ï¼ˆåŸºæœ¬æµç¨‹ã€å‘ˆç°æ–¹å¼ï¼‰
**å¼€å‘æµç¨‹ï¼š**
1. ç¼–å†™.ovsæ–‡ä»¶ â†’ 2. è‡ªåŠ¨ç¼–è¯‘ä¸ºVueä»£ç  â†’ 3. æµè§ˆå™¨å®æ—¶é¢„è§ˆ

**è¯­æ³•æ¥å£ï¼š**
- OVSå…ƒç´ ï¼š`div { "content" }` 
- ç»„ä»¶å£°æ˜ï¼š`ovsView ComponentName ({attrs}) : rootElement { ... }`
- å±æ€§èµ‹å€¼ï¼š`name = value` ï¼ˆè‡ªåŠ¨æ”¶é›†åˆ° attrsï¼‰
- æ¡ä»¶æ¸²æŸ“ï¼š`if (condition) { element }`
- å¾ªç¯æ¸²æŸ“ï¼š`for (item of list) { element }`
- å¯¼å‡ºæ¥å£ï¼š`export const/default`

## æŠ€æœ¯æ–¹å‘ï¼ˆè®¾å¤‡æ”¯æŒã€æ€§èƒ½è¦æ±‚ï¼‰
**é»˜è®¤æŠ€æœ¯æ ˆï¼š** OVS + Vue 3 + Vite + TypeScript + tsx
**è¿è¡Œç¯å¢ƒï¼š**
- è®¾å¤‡ï¼šæ¡Œé¢æµè§ˆå™¨ä¼˜å…ˆï¼ˆChromeã€Firefoxã€Safariï¼‰
- Node.jsï¼š16+ï¼ˆæ”¯æŒtsxè¿è¡Œï¼‰
- æ€§èƒ½ï¼šé›¶è¿è¡Œæ—¶å¼€é”€ï¼ˆç¼–è¯‘æ—¶è½¬æ¢ï¼‰

## æ•°æ®éœ€æ±‚ï¼ˆå­˜ä»€ä¹ˆã€æ€ä¹ˆå­˜ï¼‰
- **æºç æ–‡ä»¶**ï¼š.ovsæ ¼å¼ï¼ˆOVSè¯­æ³•ï¼‰
- **ç¼–è¯‘è¾“å‡º**ï¼šJavaScript/TypeScriptä»£ç 
- **é…ç½®æ–‡ä»¶**ï¼špackage.jsonã€tsconfig.jsonã€vite.config.ts
- **æµ‹è¯•æ•°æ®**ï¼šæµ‹è¯•ç”¨ä¾‹ã€fixturesã€ç¤ºä¾‹ä»£ç 
- **æ–‡æ¡£**ï¼šREADMEã€ç”¨æˆ·æŒ‡å—ã€APIæ–‡æ¡£

## å®‰å…¨éœ€æ±‚ï¼ˆæ•æ„Ÿçº§åˆ«ã€æƒé™æ§åˆ¶ï¼‰
- **å®‰å…¨çº§åˆ«**ï¼šå¼€å‘å·¥å…·ï¼Œæ— æ•æ„Ÿæ•°æ®
- **ç¼–è¯‘å®‰å…¨**ï¼šè¯æ³•åˆ†æã€è¯­æ³•éªŒè¯ï¼Œé˜²æ­¢æ³¨å…¥æ”»å‡»
- **ä¾èµ–ç®¡ç†**ï¼šä½¿ç”¨npm/yarné”å®šç‰ˆæœ¬

## ä¼˜å…ˆçº§ï¼ˆç¬¬ä¸€ç‰ˆåšä»€ä¹ˆï¼‰
**P0-æ ¸å¿ƒåŠŸèƒ½ï¼ˆå·²å®Œæˆï¼‰ï¼š**
- âœ… åŸºç¡€OVSè¯­æ³•ï¼ˆdivã€h1ã€pç­‰å…ƒç´ ï¼‰
- âœ… å˜é‡å£°æ˜å’Œå¼•ç”¨
- âœ… æ¡ä»¶æ¸²æŸ“ï¼ˆifè¯­å¥ï¼‰
- âœ… åµŒå¥—è§†å›¾

**P1-é«˜çº§åŠŸèƒ½ï¼ˆå·²å®Œæˆï¼‰ï¼š**
- âœ… å‡½æ•°å£°æ˜å’Œç®­å¤´å‡½æ•°
- âœ… å¾ªç¯ï¼ˆforã€whileï¼‰
- âœ… ç®—æœ¯è¿ç®—ç¬¦ï¼ˆ+ã€-ã€*ã€%ï¼‰
- âœ… æ™ºèƒ½å¯¼å‡ºç³»ç»Ÿ

**P2-ä¼˜åŒ–åŠŸèƒ½ï¼ˆè¿›è¡Œä¸­ï¼‰ï¼š**
- âš ï¸ é™¤æ³•è¿ç®—ç¬¦æ”¯æŒï¼ˆLexerå†²çªï¼‰
- âš ï¸ ClassåŠŸèƒ½å®Œå–„ï¼ˆconstructorå‚æ•°ï¼‰
- âš ï¸ æ³¨é‡Šç¨³å®šæ€§ä¼˜åŒ–

---

# ã€ç»†èŠ‚å®ç°å±‚ã€‘

## æŠ€æœ¯æ ˆè¯¦æƒ…
- **æ ¸å¿ƒæ¡†æ¶**ï¼šVue 3.5.12
- **ç¼–è¯‘å·¥å…·**ï¼šVite 7.1.7
- **ç±»å‹æ”¯æŒ**ï¼šTypeScript 5.8.3
- **è¿è¡Œç¯å¢ƒ**ï¼štsx 4.19.1ï¼ˆæ”¯æŒenumç­‰ç‰¹æ€§ï¼‰
- **è§£æå™¨**ï¼šSubhuti 0.1.3ï¼ˆè¯æ³•åˆ†æï¼‰
- **ASTå·¥å…·**ï¼šSlimeç³»åˆ—ï¼ˆè¯­æ³•æ ‘ç”Ÿæˆï¼‰
- **æµ‹è¯•æ¡†æ¶**ï¼šè‡ªå®šä¹‰æµ‹è¯•è¿è¡Œå™¨

## æ¨¡å—æ¶æ„
```
ovs/
â”œâ”€â”€ src/                    # æ ¸å¿ƒç¼–è¯‘å™¨
â”‚   â”œâ”€â”€ parser/            # è¯­æ³•åˆ†æå™¨
â”‚   â”œâ”€â”€ factory/           # ä»£ç ç”Ÿæˆå·¥å‚
â”‚   â”œâ”€â”€ model/             # ASTæ¨¡å‹
â”‚   â”œâ”€â”€ view/              # è§†å›¾æ¸²æŸ“
â”‚   â””â”€â”€ interface/         # ç±»å‹å®šä¹‰
â”œâ”€â”€ example/               # ç¤ºä¾‹é¡¹ç›®
â”œâ”€â”€ tests/                 # å®Œæ•´æµ‹è¯•å¥—ä»¶
â””â”€â”€ docs/                  # æŠ€æœ¯æ–‡æ¡£
```

## ç¼–è¯‘æµç¨‹
1. **è¯æ³•åˆ†æ**ï¼ˆSubhutiLexer + ovs6Tokensï¼‰â†’ Tokenæµï¼ˆè¯†åˆ«ovsViewå…³é”®å­—ï¼‰
2. **è¯­æ³•åˆ†æ**ï¼ˆOvsParserï¼‰â†’ CSTè¯­æ³•æ ‘  
3. **è¯­æ³•è½¬æ¢**ï¼ˆOvsCstToSlimeAstï¼‰â†’ ASTæŠ½è±¡è¯­æ³•æ ‘
4. **å¯¼å…¥æ·»åŠ **ï¼ˆensureOvsAPIImportï¼‰â†’ æ·»åŠ  `import { h } from 'vue'`
5. **è¡¨è¾¾å¼åŒ…è£¹**ï¼ˆwrapTopLevelExpressionsï¼‰â†’ æ™ºèƒ½IIFEä¼˜åŒ–
6. **ä»£ç ç”Ÿæˆ**ï¼ˆSlimeGeneratorï¼‰â†’ æœ€ç»ˆJavaScriptä»£ç 

## æ™ºèƒ½å¯¼å‡ºè§„åˆ™
- **æœ‰export default**ï¼šä¿æŒåŸæ ·ï¼Œä¸åŒ…è£¹IIFE
- **æ— export default**ï¼šIIFEåŒ…è£¹æ‰€æœ‰è¡¨è¾¾å¼ï¼Œå£°æ˜ä¿æŒé¡¶å±‚
- **export const**ï¼šåªè½¬æ¢OVSéƒ¨åˆ†ï¼Œä¿æŒå¯¼å‡ºç»“æ„
- **å¤šä¸ªè§†å›¾**ï¼šè¿”å›childrenæ•°ç»„

## è¯­æ³•è§„èŒƒ

### æ”¯æŒçš„è¯­æ³•
```javascript
// å˜é‡å£°æ˜
const/let/var declarations

// å‡½æ•°
function declarations
arrow functions (x) => x

// æ§åˆ¶æµ  
if/else conditions
for/while loops

// è¿ç®—ç¬¦
+, -, *, %, >, <, ===, !, &&, ||

// OVSå…ƒç´ 
div { content }
h1 { "title" }
p { variable }

// æ¡ä»¶æ¸²æŸ“
if (condition) { element }

// åµŒå¥—
div { div { div { "deep nesting" } } }
```

### å·²çŸ¥é™åˆ¶ä¸è§£å†³æ–¹æ¡ˆ

| é™åˆ¶ | çŠ¶æ€ | å½±å“ | æ›¿ä»£æ–¹æ¡ˆ |
|------|------|------|----------|
| **é™¤æ³•è¿ç®—ç¬¦ `/`** | âŒ | Lexerå†²çªï¼ˆä¸æ³¨é‡Š `//`ï¼‰ | ç”¨ `* 0.5` ä»£æ›¿ `/ 2` |
| **Class constructorå‚æ•°** | âš ï¸ | å‚æ•°æœ‰å°é—®é¢˜ï¼ŒåŸºæœ¬å¯ç”¨ | ç®€å•ä½¿ç”¨å¯ä»¥ï¼Œå¤æ‚åœºæ™¯ç”¨å¤–éƒ¨TS |
| **æ³¨é‡Šç¨³å®šæ€§** | âš ï¸ | éƒ¨åˆ†åœºæ™¯ä¸ç¨³å®š | ç”¨æœ‰æ„ä¹‰çš„å˜é‡åä»£æ›¿ |

**å·²ä¿®å¤çš„å†å²é—®é¢˜ï¼š**
- âœ… Constructor with assignment statementsï¼ˆthis.x = 1ï¼‰- å·²å®Œå…¨ä¿®å¤
- âœ… Export classæ”¯æŒ - å·²å®Œå…¨æ”¯æŒ
- âœ… å‡½æ•°å‚æ•°ä¸¢å¤± - å·²ä¿®å¤
- âœ… äºŒå…ƒè¡¨è¾¾å¼æ”¯æŒ - å·²å®ç°
- âœ… Token type undefined - å·²ä¿®å¤

## å¼€å‘å‘½ä»¤
```bash
# å¼€å‘æœåŠ¡å™¨
npm run dev              # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆhttp://localhost:5173ï¼‰

# æµ‹è¯•
npm test                 # æ‰§è¡Œtest-runner.tsï¼ˆç»Ÿä¸€æµ‹è¯•å…¥å£ï¼‰
npx tsx test-runner.ts   # ç›´æ¥æ‰§è¡Œæµ‹è¯•å…¥å£
npm run test:unit        # å•å…ƒæµ‹è¯•
npm run test:integration # é›†æˆæµ‹è¯•
npm run test:regression  # å›å½’æµ‹è¯•
npm run test:watch      # ç›‘å¬æ¨¡å¼

# æ„å»º
npm run build           # ç”Ÿäº§æ„å»º
npm run preview         # é¢„è§ˆæ„å»ºç»“æœ
```

## æ€§èƒ½ç‰¹æ€§

### æ ¸å¿ƒä¼˜åŒ–ï¼šæ™ºèƒ½IIFEç³»ç»Ÿ
**ç®€å•è§†å›¾ï¼ˆå®Œå…¨æ— IIFEï¼‰:**
- æ¡ä»¶ï¼šè§†å›¾å†…éƒ¨åªåŒ…å«è¡¨è¾¾å¼ï¼Œæ— ä»»ä½•è¯­å¥
- ç¼–è¯‘ç»“æœï¼šç›´æ¥è°ƒç”¨ `OvsAPI.createVNode`ï¼Œæ— å‡½æ•°åŒ…è£¹
- æ€§èƒ½æå‡ï¼šå®Œå…¨é›¶å¼€é”€ï¼Œä»£ç é‡å‡å°‘40-50%

**å¤æ‚è§†å›¾ï¼ˆä¿ç•™IIFEï¼‰:**
- æ¡ä»¶ï¼šè§†å›¾å†…éƒ¨åŒ…å«è¯­å¥ï¼ˆå˜é‡å£°æ˜ã€å¾ªç¯ã€æ¡ä»¶ç­‰ï¼‰
- ç¼–è¯‘ç»“æœï¼šå®Œæ•´IIFEå‡½æ•°ï¼Œæ”¯æŒæ‰€æœ‰ES6ç‰¹æ€§
- åŠŸèƒ½ï¼šä½œç”¨åŸŸéš”ç¦»ã€å®Œæ•´é€»è¾‘æ§åˆ¶èƒ½åŠ›

### æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”
| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|-----|-------|-------|------|
| **åµŒå¥—IIFEæ•°é‡** | æ¯ä¸ªview 1ä¸ª | ç®€å•view: 0 | **-100%** âš¡ |
| **ä»£ç è¡Œæ•°** | ~12è¡Œ | ~7è¡Œ | **-40%** |
| **è¿è¡Œæ—¶è°ƒç”¨** | 4æ¬¡IIFE | 0æ¬¡(ç®€å•) | **é›¶å¼€é”€** |
| **å¯è¯»æ€§** | ä¸­ç­‰ | æé«˜ | **æ˜¾è‘—æå‡** |

### å…¶ä»–æ€§èƒ½ç‰¹æ€§
- **é›¶è¿è¡Œæ—¶å¼€é”€**ï¼šç¼–è¯‘æ—¶è½¬æ¢ï¼Œæ— é¢å¤–è¿è¡Œæ—¶åº“
- **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´TypeScriptæ”¯æŒï¼Œç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
- **å®æ—¶çƒ­æ›´æ–°**ï¼šViteé©±åŠ¨çš„å¿«é€Ÿå¼€å‘ä½“éªŒ
- **ç¼–è¯‘é€Ÿåº¦**ï¼š< 100msï¼ˆä¸­ç­‰å¤æ‚åº¦ï¼‰
- **åŒ…å¤§å°**ï¼šæ— é¢å¤–è¿è¡Œæ—¶åº“ä¾èµ–

## æµ‹è¯•è¦†ç›–

### æµ‹è¯•é€šè¿‡ç‡ï¼š91.7%ï¼ˆ11/12ï¼‰

**âœ… å·²è¦†ç›–ç‰¹æ€§**

**Export & Import**
- âœ… export class
- âœ… export const  
- âœ… export default
- âœ… Multiple named exports

**Class Features**
- âœ… Empty constructor
- âœ… Multiple methods
- âœ… Method with parameters
- âœ… this references
- âœ… Arrow functions in methods

**OVS Syntax**
- âœ… Elements with/without props
- âœ… Nested elements
- âœ… Conditional rendering (if)
- âœ… List rendering (map)
- âœ… Props with reserved keywords

**Operators**
- âœ… Unary: !, +, -, typeof
- âœ… Comparison: ===, !==, <, >
- âœ… Arithmetic: +, -, *, %
- âœ… Logical: &&, ||

**JavaScript Features**
- âœ… const/let/var
- âœ… Functions
- âœ… Arrow functions
- âœ… Loops (for, while)
- âœ… Conditionals (if/else)

### æµ‹è¯•æ¶æ„ï¼ˆAIå¼€å‘ä¼˜åŒ–ï¼‰

**testsç›®å½•ç»“æ„ï¼ˆæç®€ç‰ˆï¼‰ï¼š**
```
tests/
â”œâ”€â”€ cases/             # æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼ˆ01-12ç¼–å·ï¼Œç®€å•â†’å¤æ‚ï¼Œç¦æ­¢åˆ†å­ç›®å½•ï¼‰
â”‚   â”œâ”€â”€ 01-simple.ovs
â”‚   â”œâ”€â”€ 02-nested.ovs
â”‚   â”œâ”€â”€ ...
â”‚   â””â”€â”€ 12-complex-feature.ovs
â””â”€â”€ utils/             # è°ƒè¯•å·¥å…·ï¼ˆAIè¾…åŠ©ä½¿ç”¨ï¼‰
    â”œâ”€â”€ check-iife-ast.ts         # æ£€æŸ¥ASTç»“æ„
    â””â”€â”€ show-hello-compiled.ts    # æŸ¥çœ‹ç¼–è¯‘ç»“æœ
```

**è®¾è®¡ç†å¿µï¼š**
- AIå¼€å‘é¡¹ç›®ä¸éœ€è¦jest/vitestç­‰è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼ˆé‚£æ˜¯ç»™äººç±»CI/CDç”¨çš„ï¼‰
- AIé€šè¿‡å¤åˆ¶.ovsç”¨ä¾‹åˆ°example/æµ‹è¯•ç¼–è¯‘å™¨åŠŸèƒ½
- utils/ä¸‹çš„å·¥å…·ç”¨äºæ‰‹åŠ¨è°ƒè¯•å’ŒæŸ¥çœ‹ç¼–è¯‘ç»“æœ
- æç®€ç»“æ„ï¼šä»25ä¸ªæ–‡ä»¶ç²¾ç®€åˆ°14ä¸ªï¼ˆå‡å°‘44%ï¼‰
- æ‰å¹³åŒ–ï¼šä¸æŒ‰ç±»å‹åˆ†å­ç›®å½•ï¼ˆsingle/combinedç­‰ï¼‰ï¼Œæ‰€æœ‰ç”¨ä¾‹å¹³é“ºåœ¨cases/ä¸‹

**å‘½åè§„èŒƒï¼š**
- æ ¼å¼ï¼š`01-åŠŸèƒ½å.ovs`ï¼ˆä¸¤ä½æ•°ç¼–å·ï¼‰
- é¡ºåºï¼šæŒ‰å¤æ‚åº¦æ’åºï¼ˆç®€å•â†’å¤æ‚ï¼‰
- ç¦æ­¢ï¼šæŒ‰ç±»å‹åˆ›å»ºå­ç›®å½•ï¼ˆsingle/ã€combined/ç­‰ï¼‰

**AIå¦‚ä½•ä½¿ç”¨ï¼š**
1. **æµ‹è¯•ç¼–è¯‘åŠŸèƒ½**ï¼šå¤åˆ¶cases/ä¸‹çš„.ovsåˆ°example/src/views/hello.ovsï¼Œå¯åŠ¨devæœåŠ¡å™¨æŸ¥çœ‹
2. **æŸ¥çœ‹ç¼–è¯‘ç»“æœ**ï¼šè¿è¡Œ `npx tsx tests/utils/show-hello-compiled.ts`
3. **æ£€æŸ¥ASTç»“æ„**ï¼šè¿è¡Œ `npx tsx tests/utils/check-iife-ast.ts`ï¼ˆè°ƒè¯•ä¼˜åŒ–ç”¨ï¼‰

**å·²åˆ é™¤çš„è‡ªåŠ¨åŒ–æµ‹è¯•åŸºç¡€è®¾æ–½ï¼š**
- unit/ã€integration/ã€regression/ï¼ˆ.test.tsæ–‡ä»¶ï¼‰
- fixtures/ï¼ˆæµ‹è¯•æ•°æ®ï¼‰
- jest.config.jsã€vitest.config.tsï¼ˆé…ç½®ï¼‰
- run-all-tests.tsã€run-tests.tsï¼ˆè¿è¡Œå™¨ï¼‰
- test-helpers.tsï¼ˆè¾…åŠ©å‡½æ•°ï¼‰

## å¿«é€Ÿå¼€å§‹æŒ‡å—

### 5åˆ†é’Ÿä¸Šæ‰‹
```bash
# 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
cd ovs && npm run dev

# 2. ç¼–å†™ç¬¬ä¸€ä¸ªOVSç»„ä»¶ï¼ˆhello.ovsï¼‰
const greeting = "Hello OVS!"

div {
  h1 { greeting }
  p { "Welcome to declarative UI!" }
}

# 3. æµè§ˆå™¨æŸ¥çœ‹ï¼šhttp://localhost:5173
```

### æµ‹è¯•ç”¨ä¾‹å¿«é€Ÿä½“éªŒ
```bash
# å¤åˆ¶åŸºç¡€ç¤ºä¾‹
Copy-Item tests\cases\01-simple.ovs example\src\views\hello.ovs

# å¤åˆ¶ç®­å¤´å‡½æ•°ç¤ºä¾‹
Copy-Item tests\cases\07-arrow-functions.ovs example\src\views\hello.ovs

# å¤åˆ¶Classç¤ºä¾‹
Copy-Item tests\cases\08-class.ovs example\src\views\hello.ovs

# å¤åˆ¶ç»„åˆæµ‹è¯•ï¼ˆexport + classï¼‰
Copy-Item tests\cases\11-export-class.ovs example\src\views\hello.ovs
```

### æµè§ˆå™¨è°ƒè¯•æŒ‡å—
**è®¿é—®åœ°å€ï¼š** http://localhost:5173

**é¢„æœŸæ˜¾ç¤ºå†…å®¹ï¼š**
1. **ç®€å•è§†å›¾åŒºå—**ï¼šæ ‡é¢˜ + æ–‡æœ¬å†…å®¹
2. **å¤æ‚è§†å›¾åŒºå—**ï¼šforå¾ªç¯æ¸²æŸ“åˆ—è¡¨ï¼ˆappleã€bananaã€cherryï¼‰
3. **æ¡ä»¶è§†å›¾åŒºå—**ï¼šifæ¡ä»¶æ¸²æŸ“å†…å®¹

**è°ƒè¯•æ­¥éª¤ï¼š**
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. æŸ¥çœ‹Consoleæ§åˆ¶å°çš„`OvsAPI.createVNode`è°ƒç”¨æ—¥å¿—
3. æ£€æŸ¥Elementsé¢æ¿çš„DOMç»“æ„
4. éªŒè¯åŠŸèƒ½æ˜¯å¦æ­£ç¡®æ¸²æŸ“

## æ–‡æ¡£ä½“ç³»
- **.cursor/rules/guidebot.mdc**ï¼šé€šç”¨AIåä½œè§„åˆ™å’Œæ–¹æ³•è®º
- **.cursor/rules/project.mdc**ï¼šOVSé¡¹ç›®å®Œæ•´æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
  - åŒ…å«ï¼šé¡¹ç›®å®šä½ã€æ ¸å¿ƒåŠŸèƒ½ã€è¯­æ³•å‚è€ƒã€å®ç°åŸç†ã€ä»£ç ç¤ºä¾‹ã€æœ€ä½³å®è·µ
  - ä½œç”¨ï¼šAIç†è§£é¡¹ç›®çš„å•ä¸€ä¿¡æ¯æºï¼Œæ‰€æœ‰é¡¹ç›®ä¿¡æ¯éƒ½åœ¨è¿™é‡Œ
  - æˆæœï¼šæ•´åˆäº†14ä¸ªåˆ†æ•£æ–‡æ¡£ï¼Œä¿¡æ¯å¯†åº¦æå‡700%ï¼Œå®ç°"å•ä¸€ä¿¡æ¯æº"

## ä¾èµ–é¡¹ç›®
- **Subhuti 0.1.3**ï¼šParseræ¡†æ¶ï¼ˆè¯æ³•åˆ†æï¼‰
- **Slimeç³»åˆ—**ï¼šASTå·¥å…·é“¾ï¼ˆè¯­æ³•æ ‘å¤„ç†ï¼‰
- **Vue 3.5.12**ï¼šæ¸²æŸ“å¼•æ“ï¼ˆç›®æ ‡æ¡†æ¶ï¼‰
- **Vite 7.1.7**ï¼šæ„å»ºå·¥å…·ï¼ˆå¼€å‘ä½“éªŒï¼‰

---

# ã€å®Œæ•´è¯­æ³•å‚è€ƒã€‘

## OVSè¯­æ³•è§„åˆ™

### ç»„ä»¶ç³»ç»Ÿï¼ˆNEWï¼‰

**ç»„ä»¶å£°æ˜ï¼š**
```javascript
ovsView ComponentName ({attrs}) : rootElement {
  // ç»„ä»¶å†…éƒ¨é€»è¾‘
  let data = attrs.value
  
  h1 { attrs.title }
  slot{}  // æ’æ§½
  p { data }
}

// ç¼–è¯‘ä¸º â†“
function ComponentName({attrs}, {slots}) {
  let data = attrs.value
  return h('div', {}, [
    h('h1', {}, [attrs.title]),
    slots.default(),  // æ¸²æŸ“æ’æ§½
    h('p', {}, [data])
  ])
}
```

**ç»„ä»¶è°ƒç”¨ï¼š**
```javascript
div {
  MyCard({attrs: {title: "Hello", content: "World"}}) {
    p { "æ’æ§½å†…å®¹" }
    "child content"
  }
}

// ç¼–è¯‘ä¸º â†“
h('div', {}, [
  h(MyCard, {attrs: {title: "Hello", content: "World"}}, [
    h('p', {}, ["æ’æ§½å†…å®¹"]),
    "child content"
  ])
])
```

**å…³é”®ç‰¹æ€§ï¼š**
- ç»„ä»¶åé¦–å­—æ¯å¤§å†™ï¼šè‡ªåŠ¨è¯†åˆ«ä¸ºç»„ä»¶ï¼Œç”Ÿæˆ `h(Component, ...)`
- æ ‡ç­¾åå°å†™ï¼šè¯†åˆ«ä¸ºHTMLæ ‡ç­¾ï¼Œç”Ÿæˆ `h('div', ...)`
- Arguments å‚æ•°ï¼šä½œä¸º props å¯¹è±¡ä¼ é€’
- èŠ±æ‹¬å·å†…å®¹ï¼šä½œä¸º children ä¼ é€’
- `slot{}`ï¼šç¼–è¯‘ä¸º `slots.default()`ï¼Œç»„ä»¶è‡ªåŠ¨æ·»åŠ  `{slots}` å‚æ•°

### æ ¸å¿ƒæ¸²æŸ“è§„åˆ™ï¼ˆv0.2.0 é‡å¤§æ›´æ–°ï¼‰

**è®¾è®¡å“²å­¦ï¼šJavaScript æ˜¯ä¸»ä½“ï¼ŒUI æ˜¯é™„åŠ **

åœ¨ `div {}` å†…éƒ¨ï¼Œé»˜è®¤æ‰€æœ‰è¡¨è¾¾å¼éƒ½ä¼šè¢«æ¸²æŸ“ï¼Œä½¿ç”¨ `#{}` éš”ç¦»ä¸éœ€è¦æ¸²æŸ“çš„ä»£ç ã€‚

#### åŸºç¡€æ¸²æŸ“è§„åˆ™

```javascript
div {
  // æ°¸è¿œä¸æ¸²æŸ“ï¼ˆDeclarationï¼‰
  const data = [1, 2, 3]   // âŒ ä¸æ¸²æŸ“ï¼ˆå˜é‡å£°æ˜ï¼‰
  function helper() {}     // âŒ ä¸æ¸²æŸ“ï¼ˆå‡½æ•°å£°æ˜ï¼‰
  
  // é»˜è®¤æ¸²æŸ“ï¼ˆExpressionStatementï¼‰
  p { "hello" }            // âœ… æ¸²æŸ“ï¼ˆå…ƒç´ ï¼‰
  func()                   // âœ… æ¸²æŸ“ï¼ˆå‡½æ•°è°ƒç”¨è¿”å›å€¼ï¼‰
  "text"                   // âœ… æ¸²æŸ“ï¼ˆå­—ç¬¦ä¸²ï¼‰
  count + 1                // âœ… æ¸²æŸ“ï¼ˆè¡¨è¾¾å¼ç»“æœï¼‰
}
```

#### `#{}` ä¸æ¸²æŸ“å—ï¼ˆNEWï¼‰

ä½¿ç”¨ `#{}` åŒ…è£¹çš„ä»£ç ä¸ä¼šè¢«æ¸²æŸ“ï¼ˆé™¤éæ˜¯æ˜ç¡®çš„æ¸²æŸ“å…ƒç´ ï¼‰ï¼š

```javascript
div {
  // #{} ç”¨äºéš”ç¦»çº¯é€»è¾‘ä»£ç 
  #{
    const x = getData()     // ä¸æ¸²æŸ“ï¼ˆåœ¨ #{} å†…ï¼‰
    console.log(x)          // ä¸æ¸²æŸ“ï¼ˆåœ¨ #{} å†…ï¼‰
    processData(x)          // ä¸æ¸²æŸ“ï¼ˆåœ¨ #{} å†…ï¼‰
  }
  
  // å…ƒç´ æ°¸è¿œæ¸²æŸ“ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
  #{
    p { "æˆ‘åœ¨ #{} å†…" }     // âœ… ä»ç„¶æ¸²æŸ“ï¼ˆå…ƒç´ ä¼˜å…ˆï¼‰
    span { "æˆ‘ä¹Ÿæ¸²æŸ“" }     // âœ… ä»ç„¶æ¸²æŸ“
  }
  
  // å¤–å±‚æ­£å¸¸æ¸²æŸ“
  p { "å¤–å±‚å†…å®¹" }          // âœ… æ¸²æŸ“
  getTitle()                // âœ… æ¸²æŸ“ï¼ˆä¸åœ¨ #{} å†…ï¼‰
}

// ç¼–è¯‘ä¸º â†“
(function() {
  const children = []
  
  // #{} å†…çš„ä»£ç å¹³é“ºï¼ˆä¸è¢« pushï¼‰
  const x = getData()
  console.log(x)
  processData(x)
  
  // #{} å†…çš„å…ƒç´ ä»ç„¶è¢« push
  children.push(h('p', {}, ['æˆ‘åœ¨ #{} å†…']))
  children.push(h('span', {}, ['æˆ‘ä¹Ÿæ¸²æŸ“']))
  
  // å¤–å±‚æ­£å¸¸ push
  children.push(h('p', {}, ['å¤–å±‚å†…å®¹']))
  children.push(getTitle())
  
  return h('div', {}, children)
})()
```

#### æ¸²æŸ“ä¼˜å…ˆçº§

```
1. OvsRenderFunction (p {}, div {}) â†’ æ°¸è¿œæ¸²æŸ“ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. åœ¨ #{} å†… â†’ ä¸æ¸²æŸ“ï¼ˆé»˜è®¤ï¼‰
3. åœ¨ div {} å†… â†’ æ¸²æŸ“
4. å…¶ä»– â†’ ä¸æ¸²æŸ“
```

#### æ§åˆ¶æµä¸­çš„æ¸²æŸ“

```javascript
div {
  if (show) {
    #{
      const temp = getData()
      console.log(temp)      // ä¸æ¸²æŸ“
    }
    p { "visible" }          // âœ… æ¸²æŸ“
  }
  
  #{
    let i = 0
  }
  
  p { items[0] }
  
  #{
    i = i + 1
  }
  
  p { items[1] }
}
```

#### `#{}` çš„ç‰¹æ€§

- âœ… å¯ä»¥åµŒå¥—ï¼š`#{ #{ } }`
- âœ… åœ¨æ§åˆ¶æµå†…æ­£å¸¸å·¥ä½œï¼š`if () { #{ } }`
- âœ… å†…éƒ¨å…ƒç´ ä»ç„¶æ¸²æŸ“ï¼š`#{ p {} }`
- âœ… è¯­å¥å¹³é“ºï¼ˆä¸å¢åŠ åŒ…è£¹ï¼‰
- âœ… å¯¹å…ƒç´ å†…éƒ¨ä¸ç”Ÿæ•ˆï¼ˆè¿›å…¥å…ƒç´ æ—¶é‡ç½®ï¼‰
- âœ… ä½œç”¨åŸŸå…±äº«ï¼ˆå¯è®¿é—®å¤–å±‚å˜é‡ï¼‰

## å¯¼å‡ºæ–¹å¼

### æ–¹å¼1: å‘½åå¯¼å‡ºï¼ˆæ¨èï¼‰
```javascript
export const myComponent = div {
  "content"
}

// ä½¿ç”¨
import {myComponent} from './component.ovs'
```

### æ–¹å¼2: é»˜è®¤å¯¼å‡º
```javascript
export default div {
  "content"
}

// ä½¿ç”¨
import MyComponent from './component.ovs'
```

### æ–¹å¼3: è‡ªåŠ¨é»˜è®¤å¯¼å‡º
```javascript
// åªæœ‰å£°æ˜å’Œè¡¨è¾¾å¼ï¼Œæ²¡æœ‰ export default
const data = 100

div{456}
div{789}

// è‡ªåŠ¨ç”Ÿæˆ export default åŒ…è£¹æ‰€æœ‰è¡¨è¾¾å¼
```

### æ–¹å¼4: å¤šä¸ªå¯¼å‡º
```javascript
export const header = div { "Header" }
export const footer = div { "Footer" }
export const sidebar = div { "Sidebar" }

// ä½¿ç”¨
import {header, footer, sidebar} from './components.ovs'
```

## ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹1: `#{}` ä¸æ¸²æŸ“å—ä½¿ç”¨ï¼ˆNEW - v0.2.0ï¼‰
```javascript
#{
  // é¡¶å±‚æ•°æ®åˆå§‹åŒ–ï¼ˆä¸æ¸²æŸ“ï¼‰
  const userName = "Alice"
  const userScore = 95
  
  // å·¥å…·å‡½æ•°ï¼ˆä¸æ¸²æŸ“ï¼‰
  function formatScore(score) {
    return score >= 90 ? "ä¼˜ç§€" : "è‰¯å¥½"
  }
  
  console.log("é¡µé¢åˆå§‹åŒ–")
}

div {
  h1 { "ç”¨æˆ·ä¿¡æ¯" }
  
  // æ™®é€šè°ƒç”¨ä¼šè¢«æ¸²æŸ“
  p { formatScore(userScore) }
  
  // #{} éš”ç¦»çº¯é€»è¾‘
  #{
    const temp = getData()
    console.log("è°ƒè¯•ä¿¡æ¯", temp)  // ä¸ä¼šæ˜¾ç¤ºåœ¨é¡µé¢
  }
  
  // #{} å†…çš„å…ƒç´ ä»ç„¶æ¸²æŸ“
  #{
    const msg = "è®¡ç®—ç»“æœ"
    p { msg }                     // âœ… ä»ç„¶æ˜¾ç¤º
  }
  
  // æ§åˆ¶æµ
  #{
    let i = 0
  }
  
  p { items[0] }
  
  #{
    i = i + 1
  }
  
  p { items[1] }
}
```

### ç¤ºä¾‹2: ä¸ªäººä¿¡æ¯å¡ç‰‡
```javascript
const userName = "Alice"
const userAge = 25
const userRole = "Developer"
const isActive = true

div {
  h1 { userName }
  
  div {
    p { "Age: " }
    p { userAge }
  }
  
  div {
    p { "Role: " }
    p { userRole }
  }
  
  if (isActive) {
    div {
      p { "Status: Active" }
    }
  }
}
```

### ç¤ºä¾‹2: å‡½æ•°ä¸å¾ªç¯ç»“åˆ
```javascript
function calculateSum(numbers) {
  let total = 0
  for (let i = 0; i < numbers.length; i++) {
    total = total + numbers[i]
  }
  return total
}

const double = (x) => x * 2

const items = [10, 20, 30]
const sum = calculateSum(items)
const doubled = double(sum)

div {
  h1 { "Calculation Results" }
  
  div {
    p { "Sum: " }
    p { sum }
  }
  
  div {
    p { "Doubled: " }
    p { doubled }
  }
}
```

### ç¤ºä¾‹3: å¤šè§†å›¾ç»„ä»¶
```javascript
const appTitle = "My Dashboard"

export const HeaderView = div {
  h1 { appTitle }
  p { "Welcome" }
}

export const ContentView = div {
  h2 { "Content" }
  p { "Main content area" }
}

export const FooterView = div {
  p { "Footer" }
}
```

## æœ€ä½³å®è·µ

### âœ… æ¨è

```javascript
// 1. ä½¿ç”¨ #{} ç»„ç»‡æ•°æ®å’Œå·¥å…·å‡½æ•°ï¼ˆNEW - v0.2.0ï¼‰
#{
  const userName = "Alice"
  const userAge = 25
  
  function formatAge(age) {
    return age + " å²"
  }
  
  console.log("åˆå§‹åŒ–å®Œæˆ")
}

// 2. åœ¨ div {} å†…ç”¨ #{} éš”ç¦»çº¯é€»è¾‘
div {
  #{
    const data = processData()
    console.log("å¤„ç†å®Œæˆ")
  }
  
  p { data }
}

// 3. #{} å†…çš„å…ƒç´ ä»ç„¶æ¸²æŸ“
#{
  const show = true
  if (show) {
    p { "æ¡ä»¶æ¸²æŸ“" }  // âœ… ä»ç„¶æ˜¾ç¤º
  }
}

// 4. ç»„ä»¶å†…ä½¿ç”¨ #{} è®¡ç®—å±€éƒ¨æ•°æ®
ovsView Card ({props}) : div {
  #{
    const user = props.user
    const displayName = user.firstName + " " + user.lastName
  }
  
  h2 { displayName }
  p { user.email }
}
```

### âŒ é¿å…
```javascript
// ä¸è¦ä½¿ç”¨æ³¨é‡Šï¼ˆä¸ç¨³å®šï¼‰
// const x = 100  // âŒ

// ä¸è¦ä½¿ç”¨é™¤æ³•ï¼ˆLexer å†²çªï¼‰
const half = value / 2  // âŒ
const half = value * 0.5  // âœ…

// ä¸è¦è¿‡åº¦åµŒå¥—
div { div { div { div { div {  // âŒ å¤ªæ·±
```

## å¸¸è§é—®é¢˜

**Q: å¦‚ä½•è°ƒè¯•ï¼Ÿ**
æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹Consoleè¾“å‡ºã€ElementsæŸ¥çœ‹DOMç»“æ„ã€NetworkæŸ¥çœ‹ç¼–è¯‘åä»£ç 

**Q: å¦‚ä½•æŸ¥çœ‹ç¼–è¯‘åçš„ä»£ç ï¼Ÿ**
è¿è¡Œ `npx tsx ovs/src/test-final.ts`

**Q: ä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨é™¤æ³•ï¼Ÿ**
LexeræŠŠ `/` å½“æˆæ³¨é‡Šå¼€å§‹ï¼Œæ›¿ä»£æ–¹æ¡ˆï¼šç”¨ `* 0.5`

**Q: å¦‚ä½•å®ç°åˆ—è¡¨æ¸²æŸ“ï¼Ÿ**
ä½¿ç”¨forå¾ªç¯ï¼š
```javascript
const items = ["A", "B", "C"]
for (let i = 0; i < items.length; i++) {
  div { p { items[i] } }
}
```

**Q: å¦‚ä½•ç»„åˆå¤šä¸ªç»„ä»¶ï¼Ÿ**
ä½¿ç”¨å‘½åå¯¼å‡ºï¼š
```javascript
// components.ovs
export const Header = div { "Header" }
export const Footer = div { "Footer" }

// app.ovs
import {Header, Footer} from './components.ovs'
div {
  Header
  Footer
}
```

---

# ã€æ ¸å¿ƒå®ç°åŸç†ã€‘

## ç¼–è¯‘æµç¨‹æ¶æ„
```
OVSæºä»£ç 
  â†“ 1. è¯æ³•åˆ†æ(SubhutiLexer)
Tokens
  â†“ 2. è¯­æ³•åˆ†æ(OvsParser)
CSTå…·ä½“è¯­æ³•æ ‘
  â†“ 3. è¯­æ³•è½¬æ¢(OvsCstToSlimeAst.toProgram)
JavaScript AST
  â†“ 4. æ·»åŠ import(ensureOvsAPIImport)
å¸¦importçš„AST
  â†“ 5. åŒ…è£¹é¡¶å±‚è¡¨è¾¾å¼(wrapTopLevelExpressions) â­
å¤„ç†åçš„AST
  â†“ 6. ä»£ç ç”Ÿæˆ(SlimeGenerator.generator)
JavaScriptä»£ç 
  â†“ 7. æ ¼å¼åŒ–(Prettier-ä»…ç”Ÿäº§ç¯å¢ƒ)
æœ€ç»ˆä»£ç 
```

## æ ¸å¿ƒæœºåˆ¶

### 1. è®¡æ•°å™¨æœºåˆ¶ï¼ˆOvsRenderDomViewDepthï¼‰
ä½¿ç”¨è®¡æ•°å™¨æ ‡è®°å½“å‰æ˜¯å¦åœ¨OVSå…ƒç´ å†…éƒ¨ï¼š

```typescript
export class OvsCstToSlimeAst extends SlimeCstToAst {
  private ovsRenderDomViewDepth = 0;

  createOvsRenderDomViewDeclarationAst(cst) {
    this.ovsRenderDomViewDepth++  // è¿›å…¥ï¼Œ+1
    try {
      // è½¬æ¢StatementList
      // ç”ŸæˆIIFEå‡½æ•°ä½“
    } finally {
      this.ovsRenderDomViewDepth--  // é€€å‡ºï¼Œ-1
    }
  }

  createExpressionStatementAst(cst) {
    if (this.ovsRenderDomViewDepth > 0) {
      // åœ¨OVSå…ƒç´ å†…ï¼Œè½¬æ¢ä¸ºchildren.push(expr)
      return createChildrenPushStatement(expr)
    } else {
      // ä¸åœ¨å†…éƒ¨ï¼Œä¿æŒåŸæ ·
      return super.createExpressionStatementAst(cst)
    }
  }
}
```

**ä¼˜åŠ¿ï¼š** ç®€å•ï¼ˆåªéœ€ä¸€ä¸ªæ•´æ•°ï¼‰ã€è‡ªåŠ¨ä¼ é€’ï¼ˆå®ä¾‹å˜é‡ï¼‰ã€æ”¯æŒåµŒå¥—ï¼ˆé€šè¿‡IIFEä½œç”¨åŸŸéš”ç¦»ï¼‰

### 2. æ™ºèƒ½å¯¼å‡ºç³»ç»Ÿ
```typescript
function wrapTopLevelExpressions(ast: SlimeProgram): SlimeProgram {
  const declarations: any[] = []
  const expressions: SlimeStatement[] = []
  let hasExportDefault = false
  
  // 1. åˆ†ç±»declarationså’Œexpressions
  for (const statement of ast.body) {
    if (statement.type === 'ExportDefaultDeclaration') {
      hasExportDefault = true
      declarations.push(statement)
    } else if (isDeclaration(statement)) {
      declarations.push(statement)  // const/let/function/class
    } else {
      expressions.push(statement)  // console.log, div{}, ç­‰
    }
  }
  
  // 2. å¦‚æœæœ‰export defaultï¼Œä¸åšåŒ…è£¹
  if (hasExportDefault) return ast
  
  // 3. å¦‚æœæ²¡æœ‰è¡¨è¾¾å¼ï¼Œä¿æŒåŸæ ·
  if (expressions.length === 0) return ast
  
  // 4. åŒ…è£¹æ‰€æœ‰è¡¨è¾¾å¼åˆ°IIFE
  const iifeBody = [
    // const children = []
    // ...å¤„ç†æ‰€æœ‰è¡¨è¾¾å¼
    // return children
  ]
  
  const iife = createIIFE(iifeBody)
  const exportDefault = createExportDefaultDeclaration(iife)
  
  return createProgram([...declarations, exportDefault])
}
```

### 3. IIFEä¼˜åŒ–åˆ¤æ–­
```typescript
private isSimpleViewBody(statements: SlimeStatement[]): boolean {
  return statements.every(stmt => {
    // åªå…è®¸ExpressionStatement
    return stmt.type === SlimeAstType.ExpressionStatement
  })
}
```

**ä¼˜åŒ–ç­–ç•¥ï¼š**
- ç®€å•è§†å›¾ï¼ˆåªæœ‰è¡¨è¾¾å¼ï¼‰â†’ ç›´æ¥è°ƒç”¨createVNodeï¼Œæ— IIFE
- å¤æ‚è§†å›¾ï¼ˆæœ‰è¯­å¥ï¼‰â†’ å®Œæ•´IIFEï¼Œæ”¯æŒæ‰€æœ‰é€»è¾‘

## ç¼–è¯‘è½¬æ¢ç¤ºä¾‹

### è¾“å…¥ä»£ç 
```javascript
export const hello = div {
  const abc = true
  if (abc) {
    123
  }
}

export default div{123}

div{456}
div{789}
```

### è¾“å‡ºä»£ç 
```javascript
import OvsAPI from 'ovsjs/src/OvsAPI'

export const hello = (function () {
  const children = []
  const abc = true
  if (abc) {
    children.push(123)
  }
  return OvsAPI.createVNode('div', children)
})()

export default (function () {
  const children = []
  children.push(123)
  return OvsAPI.createVNode('div', children)
})()

// div{456}å’Œdiv{789}ä¿æŒåŸæ ·ï¼ˆæœ‰defaultå°±ä¸ç®¡ï¼‰
```

## è®¾è®¡åŸåˆ™

**1. å•ä¸€èŒè´£**
- CST/ASTè½¬æ¢å±‚ï¼šåªè´Ÿè´£è¯­æ³•è½¬æ¢
- æ’ä»¶å±‚ï¼šè´Ÿè´£æ–‡ä»¶çº§åˆ«åŒ…è£…å’Œå¯¼å‡ºé€»è¾‘

**2. è§£è€¦æ¸…æ™°**
- ä¸åŒå±‚æ¬¡èŒè´£åˆ†ç¦»
- å®¹æ˜“æµ‹è¯•å’Œç»´æŠ¤

**3. é›¶è¿è¡Œæ—¶å¼€é”€**
- æ‰€æœ‰è½¬æ¢åœ¨ç¼–è¯‘æ—¶å®Œæˆ
- ç›´æ¥ç”Ÿæˆä¼˜åŒ–çš„JavaScript

**4. ç±»å‹å®‰å…¨**
- å®Œæ•´TypeScriptæ”¯æŒ
- æ‰€æœ‰ASTèŠ‚ç‚¹éƒ½æœ‰ç±»å‹å®šä¹‰

## åµŒå¥—æ”¯æŒåŸç†

é€šè¿‡IIFEè‡ªåŠ¨åˆ›å»ºæ–°ä½œç”¨åŸŸï¼š

```javascript
// è¾“å…¥
div {
  123
  span { 456 }
  789
}

// è¾“å‡º
(function(){
  const children = []        // å¤–å±‚children
  children.push(123)
  children.push(
    (function(){             // å†…å±‚IIFE
      const children = []    // æ–°ä½œç”¨åŸŸçš„children
      children.push(456)
      return h('span', {}, children)
    })()
  )
  children.push(789)
  return h('div', {}, children)
})()
```

æ¯ä¸ª `div { }` éƒ½æœ‰è‡ªå·±çš„ `children` å˜é‡ï¼Œé€šè¿‡IIFEè‡ªåŠ¨éš”ç¦»ï¼Œä¸ä¼šå†²çªã€‚

---

# ã€ç»„ä»¶ç³»ç»ŸæŠ€æœ¯å®ç°ã€‘

## 1. æ™ºèƒ½è¯†åˆ«æœºåˆ¶

### ç»„ä»¶ vs æ ‡ç­¾çš„è¯†åˆ«

**æ ¸å¿ƒé€»è¾‘ï¼š**
```typescript
// åœ¨ createOvsRenderDomViewDeclarationAst ä¸­
const id = this.createIdentifierAst(idCst)  // è·å–åç§°
const isComponent = id.name[0] === id.name[0].toUpperCase()  // é¦–å­—æ¯å¤§å†™åˆ¤æ–­
```

**ç¼–è¯‘ç»“æœå·®å¼‚ï¼š**
```javascript
// å°å†™ â†’ HTMLæ ‡ç­¾
div { "content" }
// â†“
h('div', {}, ["content"])  // å­—ç¬¦ä¸²

// å¤§å†™ â†’ Vueç»„ä»¶
MyCard { "content" }
// â†“
h(MyCard, {}, ["content"])  // Identifierï¼ˆä¸åŠ å¼•å·ï¼‰
```

### Arguments å‚æ•°æå–

**CST ç»“æ„ï¼š**
```
OvsRenderDomViewDeclaration
â”œâ”€ Identifier: "MyCard"
â”œâ”€ Arguments
â”‚  â”œâ”€ LParen: "("
â”‚  â”œâ”€ ArgumentList
â”‚  â”‚  â””â”€ AssignmentExpression (ObjectExpression)
â”‚  â””â”€ RParen: ")"
â””â”€ LBrace/StatementList/RBrace
```

**æå–ä»£ç ï¼š**
```typescript
const argumentsCst = cst.children?.find(child => child.name === 'Arguments')
if (argumentsCst) {
  const argListCst = argumentsCst.children.find(child => child.name === 'ArgumentList')
  const firstArgCst = argListCst.children[0]
  componentProps = this.createExpressionAst(firstArgCst.children[0])
}
```

## 2. å±æ€§èµ‹å€¼ç³»ç»Ÿ

### æ ˆæœºåˆ¶åŸç†

**ä¸ºä»€ä¹ˆéœ€è¦æ ˆï¼Ÿ**

åµŒå¥—viewä¼šè¦†ç›– attrs å˜é‡åï¼š
```javascript
div {              // è¿›å…¥ï¼špush('AAA')ï¼Œæ ˆ = [AAA]
  name = 10        // ä½¿ç”¨æ ˆé¡¶ AAA âœ…
  
  h1 {             // è¿›å…¥ï¼špush('BBB')ï¼Œæ ˆ = [AAA, BBB]
    title = 20     // ä½¿ç”¨æ ˆé¡¶ BBB âœ…
  }                // é€€å‡ºï¼špop()ï¼Œæ ˆ = [AAA] âœ… æ¢å¤å¤–å±‚
  
  age = 30         // ä½¿ç”¨æ ˆé¡¶ AAA âœ… (å…³é”®ï¼)
}
```

**å®ç°ä»£ç ï¼š**
```typescript
// OvsCstToSlimeAst ç±»
private attrsVarNameStack: Array<string | null> = []

createOvsRenderDomViewDeclarationAst(cst) {
  const uuid = Math.random().toString(36).substring(2, 10)
  this.attrsVarNameStack.push(`temp$$attrs$$${uuid}`)  // è¿›å…¥æ—¶å‹æ ˆ
  
  try {
    // è½¬æ¢è¯­å¥...
  } finally {
    this.attrsVarNameStack.pop()  // é€€å‡ºæ—¶å¼¹æ ˆï¼ˆç¡®ä¿æ¢å¤ï¼‰
  }
}

createExpressionStatementAst(cst) {
  const currentAttrsVarName = this.attrsVarNameStack[length - 1]  // å–æ ˆé¡¶
  
  if (isAssignment) {
    // ä½¿ç”¨ currentAttrsVarName ç”Ÿæˆä»£ç 
  }
}
```

### èµ‹å€¼è¡¨è¾¾å¼è½¬æ¢

**è¾“å…¥ï¼š**
```javascript
div {
  name = 10
  age = 25
}
```

**æ‰§è¡Œæµç¨‹ï¼š**
1. è¿›å…¥ `createOvsRenderDomViewDeclarationAst`ï¼Œç”Ÿæˆ uuid = "abc123"ï¼Œå‹æ ˆ
2. è°ƒç”¨ `createStatementListAst`
3. éå†è¯­å¥ â†’ è°ƒç”¨ `createExpressionStatementAst`
   - `name = 10` â†’ è¯†åˆ«ä¸ºèµ‹å€¼ â†’ ç”Ÿæˆ3æ¡è¯­å¥
   - `age = 25` â†’ è¯†åˆ«ä¸ºèµ‹å€¼ â†’ ç”Ÿæˆ3æ¡è¯­å¥
4. é€€å‡ºæ—¶å¼¹æ ˆ

**ç”Ÿæˆä»£ç ï¼š**
```javascript
(function() {
  const children = []
  const temp$$attrs$$abc123 = {}
  
  // name = 10 â†’ 3æ¡è¯­å¥
  let name = 10                      // 1. å˜é‡å£°æ˜
  temp$$attrs$$abc123.name = name    // 2. èµ‹å€¼åˆ°attrs
  children.push(temp$$attrs$$abc123.name)  // 3. pushåˆ°children
  
  // age = 25 â†’ 3æ¡è¯­å¥
  let age = 25
  temp$$attrs$$abc123.age = age
  children.push(temp$$attrs$$abc123.age)
  
  return h('div', {ovsAttr: temp$$attrs$$abc123}, children)
})()
```

## 3. ç»„ä»¶å£°æ˜è½¬æ¢

### ovsView è¯­æ³•è§„åˆ™

**Parserè§„åˆ™ï¼š**
```typescript
@SubhutiRule
OvsViewDeclaration() {
  this.tokenConsumer.OvsViewToken()        // ovsView
  this.ovsRenderDomClassDeclaration()       // ComponentName ({params}) :
  this.OvsRenderDomViewDeclaration()        // div { ... }
}

@SubhutiRule
ovsRenderDomClassDeclaration() {
  this.tokenConsumer.Identifier()           // ComponentName
  this.Option(() => {
    this.FunctionFormalParameters()         // ({params})
  })
  this.tokenConsumer.Colon()                // :
}
```

### IIFE å±•å¼€æœºåˆ¶

**ç®€å•ç»„ä»¶ï¼ˆæ— è¯­å¥ï¼‰ï¼š**
```javascript
ovsView MyCard ({attrs}) : div {
  h1 { attrs.title }
}

// è§†å›¾è½¬æ¢ä¸º â†“
h('div', {}, [h('h1', {}, [attrs.title])])

// æœ€ç»ˆå‡½æ•° â†“
function MyCard({attrs}) {
  return h('div', {}, [h('h1', {}, [attrs.title])])
}
```

**å¤æ‚ç»„ä»¶ï¼ˆæœ‰è¯­å¥ï¼‰ï¼š**
```javascript
ovsView ProductCard ({attrs}) : div {
  let price = attrs.price
  let discount = price * 0.8
  p { discount }
}

// è§†å›¾è½¬æ¢ä¸º IIFE â†“
(function() {
  const children = []
  const temp$$attrs$$uuid = {}
  let price = attrs.price
  let discount = price * 0.8
  children.push(h('p', {}, [discount]))
  return h('div', {ovsAttr: temp$$attrs$$uuid}, children)
})()

// å±•å¼€IIFEå†…å®¹åˆ°å‡½æ•°ä½“ â†“
function ProductCard({attrs}) {
  const children = []
  const temp$$attrs$$uuid = {}
  let price = attrs.price
  let discount = price * 0.8
  children.push(h('p', {}, [discount]))
  return h('div', {ovsAttr: temp$$attrs$$uuid}, children)
}
```

**å±•å¼€é€»è¾‘ï¼š**
```typescript
createOvsViewDeclarationAst(cst) {
  // 1. æå–ç»„ä»¶åå’Œå‚æ•°
  const componentName = ...
  const params = ...
  
  // 2. è½¬æ¢è§†å›¾ï¼ˆä¼šç”ŸæˆIIFEæˆ–hè°ƒç”¨ï¼‰
  const viewExpression = this.createOvsRenderDomViewDeclarationAst(viewCst)
  
  // 3. åˆ¤æ–­æ˜¯å¦æ˜¯IIFE
  if (viewExpression.type === 'CallExpression' && 
      viewExpression.callee.type === 'FunctionExpression') {
    // æ˜¯IIFEï¼Œæå–å‡½æ•°ä½“
    const iifeBody = viewExpression.callee.body.body
    functionBodyStatements = iifeBody  // ç›´æ¥ä½¿ç”¨IIFEçš„å‡½æ•°ä½“
  } else {
    // ä¸æ˜¯IIFEï¼ˆç®€å•è§†å›¾ï¼‰ï¼Œç›´æ¥return
    functionBodyStatements = [returnStatement(viewExpression)]
  }
  
  // 4. åˆ›å»ºå‡½æ•°å£°æ˜
  return FunctionDeclaration(componentName, params, functionBody)
}
```

## 4. å®Œæ•´ç¼–è¯‘æµç¨‹ç¤ºä¾‹

**è¾“å…¥ä»£ç ï¼š**
```javascript
ovsView MyButton ({attrs}) : div {
  let text = attrs.label || "Click"
  button { text }
}

div {
  MyButton({attrs: {label: "æäº¤"}})
}
```

**ç¼–è¯‘æ­¥éª¤ï¼š**

1. **è¯æ³•åˆ†æ** â†’ è¯†åˆ« `ovsView` å…³é”®å­—token
2. **è¯­æ³•åˆ†æ** â†’ ç”ŸæˆCSTï¼ˆOvsViewDeclarationèŠ‚ç‚¹ï¼‰
3. **ASTè½¬æ¢** â†’ 
   - `createOvsViewDeclarationAst` â†’ å‡½æ•°å£°æ˜
   - `createOvsRenderDomViewDeclarationAst` â†’ è§†å›¾IIFE
4. **IIFEå±•å¼€** â†’ æå–å‡½æ•°ä½“å†…å®¹
5. **æ™ºèƒ½è¯†åˆ«** â†’ `MyButton` é¦–å­—æ¯å¤§å†™ï¼Œè¯†åˆ«ä¸ºç»„ä»¶
6. **ä»£ç ç”Ÿæˆ** â†’ æœ€ç»ˆJavaScript

**è¾“å‡ºä»£ç ï¼š**
```javascript
import { h } from 'vue'

function MyButton({ attrs }) {
  const children = []
  const temp$$attrs$$xyz = {}
  let text = attrs.label || 'Click'
  children.push(h('button', {}, [text]))
  return h('div', { ovsAttr: temp$$attrs$$xyz }, children)
}

export default (function () {
  const children = []
  children.push(h(MyButton, { attrs: { label: 'æäº¤' } }, []))
  return children
})()
```

## 5. å…³é”®è®¾è®¡å†³ç­–

### ä¸ºä»€ä¹ˆç”¨æ ˆè€Œä¸æ˜¯å•ä¸ªå˜é‡ï¼Ÿ

**é—®é¢˜åœºæ™¯ï¼š**
```javascript
div {
  name = 10     // éœ€è¦ç”¨å¤–å±‚attrs
  h1 {          // å†…å±‚viewå¼€å§‹
    title = 20  // éœ€è¦ç”¨å†…å±‚attrs
  }             // å†…å±‚viewç»“æŸ
  age = 30      // éœ€è¦æ¢å¤å¤–å±‚attrs â† å…³é”®ï¼
}
```

å¦‚æœç”¨å•ä¸ªå˜é‡ï¼Œå†…å±‚viewç»“æŸåæ— æ³•æ¢å¤å¤–å±‚çš„attrsVarNameã€‚

### ä¸ºä»€ä¹ˆç»„ä»¶è°ƒç”¨è¦åŒºåˆ†å¤§å°å†™ï¼Ÿ

éµå¾ª Vue è§„èŒƒï¼š
- JSX/TSXï¼š`<MyComponent />` vs `<div />`
- hå‡½æ•°ï¼š`h(MyComponent)` vs `h('div')`

å¤§å°å†™åŒºåˆ†è®©ç¼–è¯‘å™¨è‡ªåŠ¨åˆ¤æ–­ï¼Œæ— éœ€é¢å¤–æ ‡è®°ã€‚

### ä¸ºä»€ä¹ˆå±æ€§ç”¨ {ovsAttr: ...} è€Œä¸æ˜¯å±•å¼€ï¼Ÿ

ç»Ÿä¸€å†…éƒ¨çº¦å®šï¼š
- `{ovsAttr: temp$$attrs$$}` - OVSå†…éƒ¨ç”Ÿæˆçš„attrs
- `{attrs: ...}` - ç”¨æˆ·æ˜¾å¼ä¼ é€’çš„props

ä¾¿äºåŒºåˆ†å’Œè°ƒè¯•ï¼Œé¿å…å±æ€§åå†²çªã€‚

---

# å˜æ›´è®°å½•

ã€2025-10-24 16:58:08ã€‘
ã€2025-10-24ã€‘OVS v0.2.0 - #{} ä¸æ¸²æŸ“å—åŠŸèƒ½å®Œæ•´å®ç°

âœ… æ ¸å¿ƒåŠŸèƒ½å®ç°ï¼š
1. #{} è¯­æ³•æ”¯æŒ - éš”ç¦»ä¸æ¸²æŸ“çš„ä»£ç 
2. æ™ºèƒ½æ¸²æŸ“ç³»ç»Ÿ - å…ƒç´ ä¼˜å…ˆã€é»˜è®¤æ¸²æŸ“ã€#{} éš”ç¦»
3. è‡ªåŠ¨å¯¼å‡ºä¼˜åŒ– - ç®€å•/å¤æ‚è‡ªåŠ¨åˆ¤æ–­
4. ReactiveVNode é›†æˆ - å“åº”å¼æ”¯æŒ

âœ… ä¿®æ”¹æ–‡ä»¶ï¼š
- OvsParser.ts - æ·»åŠ  NoRenderBlock è§„åˆ™ï¼Œåˆ é™¤ RenderExpression
- OvsCstToSlimeAstUtil.ts - å®ç° #{} å±•å¼€å’Œæ¸²æŸ“åˆ¤æ–­
- index.ts - ä¼˜åŒ–å¯¼å‡ºé€»è¾‘ï¼Œæ‰€æœ‰ä»£ç åŒ…è£¹åˆ° IIFE

âœ… æµ‹è¯•éªŒè¯ï¼š
- åˆ›å»ºæµ‹è¯•ç”¨ä¾‹ 13-norender-block.ovs
- æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•é€šè¿‡
- hello.ovs å®Œæ•´ç¤ºä¾‹ï¼ˆ110è¡Œï¼‰æ­£å¸¸ç¼–è¯‘

âœ… é¡µé¢å°±ç»ªï¼š
- å¼€å‘æœåŠ¡å™¨ï¼šhttp://localhost:5175
- main.ts ä½¿ç”¨ DefaultViews.map(v => v.toVnode())
- å±•ç¤º #{} åŠŸèƒ½çš„4ä¸ªç¤ºä¾‹

## 2025-10-24 [v0.2.0 - `#{}` ä¸æ¸²æŸ“å— + æ™ºèƒ½æ¸²æŸ“ç³»ç»Ÿ]

### ğŸ¯ æ ¸å¿ƒè®¾è®¡å˜æ›´

**è®¾è®¡å“²å­¦è½¬å˜ï¼šJavaScript æ˜¯ä¸»ä½“ï¼ŒUI æ˜¯é™„åŠ **

- **æ—§è®¾è®¡**ï¼šåªæœ‰ç‰¹å®šè¯­æ³•ï¼ˆ`#{ expr }`ï¼‰æ‰æ¸²æŸ“
- **æ–°è®¾è®¡**ï¼šé»˜è®¤éƒ½æ¸²æŸ“ï¼Œä½¿ç”¨ `#{}` éš”ç¦»ä¸æ¸²æŸ“çš„ä»£ç 

### âœ… æ–°å¢åŠŸèƒ½

#### 1. `#{}` ä¸æ¸²æŸ“å—
- **è¯­æ³•**ï¼š`#{ statements }` - å¯åŒ…å«å¤šä¸ªè¯­å¥
- **ä½œç”¨**ï¼šéš”ç¦»çº¯é€»è¾‘ä»£ç ï¼ˆæ•°æ®å¤„ç†ã€è°ƒè¯•æ—¥å¿—ç­‰ï¼‰
- **ä½ç½®**ï¼šStatement å±‚çº§ï¼ˆå¯å‡ºç°åœ¨ä»»ä½•å…è®¸ Statement çš„åœ°æ–¹ï¼‰
- **ç‰¹æ€§**ï¼š
  - è¯­å¥å¹³é“ºï¼ˆå»æ‰ `#{}` åŒ…è£¹ï¼Œå†…å®¹ç›´æ¥æ’å…¥ï¼‰
  - æ”¯æŒåµŒå¥—
  - å…ƒç´ ä¼˜å…ˆï¼ˆ`p {}` åœ¨ `#{}` å†…ä»ç„¶æ¸²æŸ“ï¼‰
  - ä½œç”¨åŸŸå…±äº«ï¼ˆå¯è®¿é—®å¤–å±‚å˜é‡ï¼‰

#### 2. æ™ºèƒ½æ¸²æŸ“åˆ¤æ–­ç³»ç»Ÿ
- **ä¼˜å…ˆçº§æœºåˆ¶**ï¼š
  1. `OvsRenderFunction` (`p {}`) â†’ æ°¸è¿œæ¸²æŸ“
  2. `noRenderDepth > 0` (åœ¨ `#{}` å†…) â†’ ä¸æ¸²æŸ“
  3. `ovsRenderDomViewDepth > 0` (åœ¨ `div {}` å†…) â†’ æ¸²æŸ“
  4. å…¶ä»– â†’ ä¸æ¸²æŸ“

- **çŠ¶æ€ç®¡ç†**ï¼š
  - `noRenderDepth` è®¡æ•°å™¨ï¼ˆè·Ÿè¸ª `#{}` åµŒå¥—ï¼‰
  - è¿›å…¥å…ƒç´ æ—¶é‡ç½®ï¼ˆ`#{}` å¯¹å…ƒç´ å†…éƒ¨ä¸ç”Ÿæ•ˆï¼‰

### ğŸ”§ ä»£ç ä¿®æ”¹

**æ–‡ä»¶1ï¼šOvsParser.ts**
- âœ… æ·»åŠ  `NoRenderBlock` è§„åˆ™
- âœ… Override `Statement` è§„åˆ™ï¼ˆæ·»åŠ  NoRenderBlock æ”¯æŒï¼‰
- âœ… åˆ é™¤æ—§çš„ `RenderExpression` è§„åˆ™

**æ–‡ä»¶2ï¼šOvsCstToSlimeAstUtil.ts**
- âœ… æ·»åŠ  `noRenderDepth` è®¡æ•°å™¨
- âœ… Override `createStatementListItemAst`ï¼ˆå±•å¼€ `#{}` å†…çš„è¯­å¥ï¼‰
- âœ… ä¿®æ”¹ `createExpressionStatementAst`ï¼ˆæ–°çš„æ¸²æŸ“åˆ¤æ–­é€»è¾‘ï¼‰
- âœ… ä¿®æ”¹ `createOvsRenderDomViewDeclarationAst`ï¼ˆè¿›å…¥å…ƒç´ æ—¶é‡ç½® noRenderDepthï¼‰
- âœ… åˆ é™¤ `createRenderExpressionAst` æ–¹æ³•

**æ–‡ä»¶3ï¼šindex.ts**
- âœ… ä¿®å¤ `isOvsRenderDomView` è¯†åˆ« `h()` å‡½æ•°è°ƒç”¨
- âœ… ä¿®å¤ç®­å¤´å‡½æ•° params æ ¼å¼

### ğŸ“Š æµ‹è¯•éªŒè¯

åˆ›å»ºæµ‹è¯•ç”¨ä¾‹ï¼š`tests/cases/13-norender-block.ovs`

**éªŒè¯é¡¹ç›®**ï¼š
1. âœ… é¡¶å±‚ `#{}` ä»£ç å¹³é“º
2. âœ… `#{}` å†…çš„å±€éƒ¨å˜é‡å®šä¹‰
3. âœ… `#{}` å†…çš„å‡½æ•°è°ƒç”¨ä¸æ¸²æŸ“
4. âœ… æ™®é€šå‡½æ•°è°ƒç”¨è¢«æ¸²æŸ“
5. âœ… `#{}` å†…çš„å…ƒç´ ä»ç„¶æ¸²æŸ“
6. âœ… åµŒå¥— `#{}` æ­£ç¡®å±•å¼€
7. âœ… æ§åˆ¶æµä¸­çš„ `#{}` æ­£å¸¸å·¥ä½œ
8. âœ… æ— è¯­æ³•é”™è¯¯

### ğŸ¨ ç¤ºä¾‹ä»£ç 

è¯¦è§ `example/src/views/hello.ovs`ï¼ˆ100è¡Œå®Œæ•´ç¤ºä¾‹ï¼‰

---

# å˜æ›´è®°å½•

## 2025-10-24 [v0.2.0 - `#{}` ä¸æ¸²æŸ“å— + æ™ºèƒ½æ¸²æŸ“ç³»ç»Ÿ]ï¼ˆå·²åœ¨æ–‡æ¡£ä¸Šæ–¹ï¼‰

## 2025-10-17 [ç»„ä»¶ç³»ç»Ÿ - v0.1.0]
- **æ–°å¢ç»„ä»¶ç³»ç»Ÿ**ï¼š
  - æ·»åŠ  `ovsView` å…³é”®å­—ï¼ˆOvsConsumer.ts + ovs6Tokensï¼‰
  - å®ç°ç»„ä»¶å£°æ˜è¯­æ³•ï¼š`ovsView ComponentName ({attrs}) : rootElement { ... }`
  - å®ç°ç»„ä»¶è°ƒç”¨è¯­æ³•ï¼š`MyCard({attrs: {...}}){ children }`
  - è‡ªåŠ¨è¯†åˆ«ç»„ä»¶ï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰vs æ ‡ç­¾ï¼ˆå°å†™ï¼‰
  - ç»„ä»¶ç¼–è¯‘è¾“å‡ºï¼š`function ComponentName({attrs}, {slots}) { return h(...) }`
  - ç»„ä»¶è°ƒç”¨ç¼–è¯‘ï¼š`h(MyCard, {attrs: ...}, children)`

- **æ’æ§½ç³»ç»Ÿ**ï¼š
  - æ·»åŠ  `slot` å…³é”®å­—ï¼ˆSlotTokenï¼‰
  - å®ç°æ’æ§½è¯­æ³•ï¼š`slot{}` ç¼–è¯‘ä¸º `slots.default()`
  - ç»„ä»¶å‡½æ•°è‡ªåŠ¨æ·»åŠ ç¬¬äºŒä¸ªå‚æ•°ï¼š`{slots}`
  - å®Œæ•´æ”¯æŒVue 3çš„æ’æ§½æœºåˆ¶

- **å±æ€§ç³»ç»Ÿ**ï¼š
  - å±æ€§èµ‹å€¼è¯­æ³•ï¼š`name = value` è‡ªåŠ¨æ”¶é›†åˆ° attrs
  - ç”Ÿæˆä¸‰æ¡è¯­å¥ï¼š`let name = value; temp$$attrs$$.name = name; children.push(...)`
  - æ ˆæœºåˆ¶ï¼ˆattrsVarNameStackï¼‰æ”¯æŒåµŒå¥—viewçš„attrséš”ç¦»
  - ç»Ÿä¸€å†…éƒ¨ä¼ é€’ï¼š`{ovsAttr: temp$$attrs$$}`
  - ç»„ä»¶propsä¼ é€’ï¼š`{attrs: ...}` ç”¨æˆ·æ˜¾å¼ä¼ é€’

- **ReactiveVNode é›†æˆ**ï¼š
  - ä½¿ç”¨è‡ªå°è£…çš„ ReactiveVNode APIï¼ˆä½äº `ovs/example/src/utils/ReactiveVNode.ts`ï¼‰
  - æä¾›å“åº”å¼ VNode åŠŸèƒ½ï¼š`toVnode()`ã€`mount()`ã€`unmount()`
  - å†…éƒ¨è°ƒç”¨ Vue çš„ `h` å‡½æ•°ï¼Œä½†å¯¹å¤–æä¾›æ›´é«˜çº§çš„å“åº”å¼ API
  - æ”¯æŒå®Œæ•´çš„ Vue ç»„ä»¶ç‰¹æ€§ï¼ˆpropsã€slotsã€å“åº”å¼æ›´æ–°ï¼‰

## 2025-10-17 [æµ‹è¯•æ¶æ„ä¼˜åŒ–]
- ç®€åŒ–æµ‹è¯•ç”¨ä¾‹ç»„ç»‡ï¼šä¸å†åŒºåˆ†single/combinedå­ç›®å½•
- æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å¹³é“ºåœ¨tests/cases/ä¸‹ï¼ŒæŒ‰ç¼–å·æ’åºï¼ˆ01-12ï¼‰
- æ›´æ–°è§„åˆ™ï¼šç¦æ­¢æŒ‰ç±»å‹åˆ›å»ºå­ç›®å½•ï¼Œä¿æŒæ‰å¹³åŒ–ç»“æ„
- æ›´æ–°å‘½åè§„èŒƒï¼š01-åŠŸèƒ½å.ovsï¼ˆä¸¤ä½æ•°ç¼–å·ï¼Œç®€å•â†’å¤æ‚ï¼‰

## 2025-10-14 [æ–‡æ¡£æ•´åˆ+é¡¹ç›®ç²¾ç®€]
- æ•´åˆ14ä¸ªåˆ†æ•£æ–‡æ¡£åˆ°project.mdcï¼Œå®ç°"å•ä¸€ä¿¡æ¯æº"ï¼ˆä¿¡æ¯å¯†åº¦æå‡700%ï¼‰
- testsç›®å½•ç²¾ç®€ï¼šä»25ä¸ªæ–‡ä»¶â†’14ä¸ªæ–‡ä»¶ï¼ˆå‡å°‘44%ï¼‰
- åˆ é™¤è‡ªåŠ¨åŒ–æµ‹è¯•åŸºç¡€è®¾æ–½ï¼ˆAIå¼€å‘ä¸éœ€è¦jest/vitestç­‰ï¼‰
- ç»Ÿä¸€æµ‹è¯•å…¥å£ï¼štest-runner.ts
- é¡¹ç›®çŠ¶æ€ï¼šSTAGE_4_OPTIMIZATIONï¼ŒåŠŸèƒ½å®Œæ•´ï¼Œç”Ÿäº§å¯ç”¨

---

**å¼•å¯¼å‹AIåä½œè§„åˆ™ | OVSé¡¹ç›®å®Œæ•´æ–‡æ¡£ | æœ€åæ›´æ–°: 2025-10-24**
