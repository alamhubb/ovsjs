---
description: OVSé¡¹ç›®ä¿¡æ¯ - å£°æ˜å¼UIæ¡†æ¶é¡¹ç›®è§„èŒƒä¸å¼€å‘æŒ‡ï¿½?alwaysApply: true
---

# OVS - å£°æ˜å¼UIæ¡†æ¶é¡¹ç›®

## é¡¹ç›®å®šä½
å£°æ˜å¼UIæ¡†æ¶ï¼Œä½¿ç”¨ç±»ä¼¼Flutter/SwiftUIçš„è¯­æ³•å¼€å‘Vueåº”ç”¨ï¼Œæä¾›é›¶è¿è¡Œæ—¶å¼€é”€çš„ç¼–è¯‘æ—¶è½¬æ¢

**æ ¸å¿ƒä»·å€¼ï¼š**
- è®©å‰ç«¯å¼€å‘è€…ç”¨æ›´ç›´è§‚çš„è¯­æ³•ç¼–å†™UI
- ç¼–è¯‘æ—¶è½¬æ¢ï¼Œé›¶è¿è¡Œæ—¶å¼€é”€
- å®Œæ•´çš„TypeScriptæ”¯æŒå’Œç±»å‹å®‰ï¿½?
## å½“å‰é˜¶æ®µ
STAGE_4_OPTIMIZATION

## å½“å‰çŠ¶ï¿½?- ï¿½?æ ¸å¿ƒåŠŸèƒ½ï¿½?00% å®Œæˆ
- ï¿½?LSP æ”¯æŒï¼šæºç æ˜ å°„å‡†ç¡®ç‡ 100%ï¿½?025-10-30 ä¿®å¤å®Œæˆï¿½?- ï¿½?æ™ºèƒ½IIFEä¼˜åŒ–ï¼šå®Œæˆï¼ˆç®€å•è§†å›¾é›¶å¼€é”€ï¿½?- ï¿½?ç»„ä»¶ç³»ç»Ÿï¼šå®Œæˆï¼ˆovsViewç»„ä»¶å£°æ˜ã€props/childå±æ€§ä¼ é€’ï¼‰
- ï¿½?`#{}` ä¸æ¸²æŸ“å—ï¼šå®Œæˆï¼ˆä»£ç éš”ç¦»ï¿½?- ç‰ˆæœ¬ï¿½?.2.1ï¼ˆæºç æ˜ å°„ä¿®å¤ï¼‰
- å¼€å‘æœåŠ¡å™¨ï¼šhttp://localhost:5175

## æµ‹è¯•å·¥å…·ï¼ˆæ˜ å°„è¯Šæ–­ï¼‰
```bash
# å¿«é€Ÿè¯Šæ–­æ˜ å°„è´¨é‡ï¼ˆæ£€æŸ¥æœ‰æ•ˆç‡ï¿½?npx tsx test-mapping-diagnosis.ts

# å®Œæ•´æµ‹è¯•ï¿½?ä¸ªåœºæ™¯ï¼šæ’åºã€æ ¼å¼åŒ–ã€æŸ¥æ‰¾ã€åµŒå¥—ï¼‰
npx tsx test-mapping-issues.ts

# æœ€ç»ˆéªŒè¯ï¼ˆå¯¹æ¯”ä¿®å¤å‰åï¿½?npx tsx test-final-mapping-check.ts
```

## ä¸‹ä¸€æ­¥è¡Œï¿½?- æµ‹è¯•ç»„ä»¶ç³»ç»Ÿçš„å„ç§ä½¿ç”¨åœºï¿½?- å®Œå–„ç»„ä»¶æ–‡æ¡£å’Œç¤ºï¿½?- ä¼˜åŒ–å·²çŸ¥é™åˆ¶ï¼ˆé™¤æ³•è¿ç®—ã€Class constructorå‚æ•°ã€æ³¨é‡Šç¨³å®šæ€§ï¼‰
- **æ ¸å¿ƒä¼˜å…ˆï¿½?*ï¼šå¼€å‘VSCodeè¯­è¨€æ”¯æŒæ’ä»¶ï¼ˆè¯­æ³•é«˜ï¿½?æ™ºèƒ½æç¤ºï¿½?
## ç«äº‰åŠ›åˆ†ï¿½?
### ï¿½?æŠ€æœ¯ä¼˜ï¿½?- **é›¶è¿è¡Œæ—¶å¼€é”€**ï¼šçº¯ç¼–è¯‘æ—¶è½¬æ¢ï¼Œæ€§èƒ½æ— æŸ
- **å®Œæ•´ç»„ä»¶ç³»ç»Ÿ**ï¼špropsã€slotsã€åµŒå¥—å®Œæ•´æ”¯ï¿½?- **æ™ºèƒ½ä¼˜åŒ–**ï¼šç®€å•è§†å›¾é›¶IIFEï¼Œå¤æ‚è§†å›¾å®Œæ•´æ”¯ï¿½?- **è¯­æ³•ç›´è§‚**ï¼šå£°æ˜å¼é£æ ¼ï¼Œç±»ä¼¼Flutter/SwiftUI
- **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´TypeScriptæ”¯æŒ

### âš ï¸ ä¸¥å³»æŒ‘æˆ˜
- **ç”Ÿæ€ç¼ºï¿½?*ï¼ˆæœ€å¤§é—®é¢˜ï¼‰ï¼šæ— IDEæ”¯æŒã€è°ƒè¯•å·¥å…·ã€ç»„ä»¶åº“ã€ç¤¾ï¿½?- **å¸‚åœºå®šä½æ¨¡ç³Š**ï¼šJSX/TSXç”Ÿæ€æˆç†Ÿï¼ŒVue SFCå®˜æ–¹æ¨è
- **å­¦ä¹ æˆæœ¬**ï¼šæ–°è¯­æ³•ã€è°ƒè¯•å›°éš¾ã€å›¢é˜Ÿåä½œæˆæœ¬é«˜
- **åŠŸèƒ½é™åˆ¶**ï¼šé™¤æ³•è¿ç®—ã€æ³¨é‡Šä¸ç¨³å®šã€å¤æ‚è¡¨è¾¾å¼æ”¯æŒæœ‰é™

### ğŸ’¡ å‘å±•æ–¹å‘å»ºè®®

**çŸ­æœŸï¿½?-6ä¸ªæœˆï¿½? å¿…éœ€åŸºç¡€è®¾æ–½**
1. **VSCodeæ’ä»¶**ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
   - è¯­æ³•é«˜äº®
   - é”™è¯¯æç¤º
   - æ™ºèƒ½è¡¥å…¨
   - Source Mapæ”¯æŒ

2. **æ ¸å¿ƒé™åˆ¶ä¿®å¤**
   - é™¤æ³•è¿ç®—ç¬¦æ”¯ï¿½?   - æ³¨é‡Šç¨³å®šï¿½?   - é”™è¯¯æç¤ºä¼˜åŒ–

3. **æ–‡æ¡£å’Œç¤ºï¿½?*
   - 10+çœŸå®é¡¹ç›®ç¤ºä¾‹
   - JSX/Vue SFCè¿ç§»æŒ‡å—
   - æ€§èƒ½å¯¹æ¯”æ•°æ®

**ä¸­æœŸï¿½?-12ä¸ªæœˆï¿½? å·®å¼‚åŒ–å®šï¿½?*

**é€‰é¡¹Aï¼šAIä»£ç ç”Ÿæˆåœºæ™¯**
- OVSè¯­æ³•ç»“æ„åŒ–ï¼ŒAIæ›´å®¹æ˜“ç”Ÿï¿½?- æä¾›"è‡ªç„¶è¯­è¨€â†’OVS"å·¥å…·
- ç›®æ ‡ï¼šéç¨‹åºå‘˜ç”¨AIç”ŸæˆUI

**é€‰é¡¹Bï¼šå¿«é€ŸåŸå‹å·¥ï¿½?*
- å¯è§†åŒ–ç¼–è¾‘å™¨ ï¿½?OVSä»£ç åŒå‘åŒæ­¥
- ç±»ä¼¼Figmaâ†’Codeä½†è¯­æ³•æ›´ç®€ï¿½?- ç›®æ ‡ï¼šè®¾è®¡å¸ˆ/äº§å“ç»ç†å¿«é€ŸéªŒï¿½?
**é€‰é¡¹Cï¼šæ•™è‚²é¢†ï¿½?*
- è¯­æ³•ç®€å•ï¼Œé€‚åˆåˆå­¦ï¿½?- æä¾›åœ¨çº¿playground
- ç›®æ ‡ï¼šç¼–ç¨‹æ•™è‚²å¸‚ï¿½?
**é•¿æœŸï¿½?-2å¹´ï¼‰- è·¨æ¡†æ¶DSL**
- ç¼–è¯‘åˆ°React/Solid.js
- æˆä¸ºè·¨æ¡†æ¶çš„UIæè¿°è¯­è¨€

### ğŸ“Š ç°å®è¯„ä¼°

**æŠ€æœ¯å±‚ï¿½?*ï¼šâ­â­â­â­â˜† ï¿½?/5ï¼‰å®ç°ä¼˜ç§€ï¼Œæœ‰åˆ›æ–°
**ç”Ÿæ€å±‚ï¿½?*ï¼šâ­â˜†â˜†â˜†â˜† ï¿½?/5ï¼‰å‡ ä¹ä¸ºé›¶ï¼Œè‡´å‘½çŸ­æ¿
**å¸‚åœºå±‚é¢**ï¼šâ­â­â˜†â˜†â˜† ï¿½?/5ï¼‰å®šä½ä¸æ¸…æ™°ï¼Œç«äº‰æ¿€ï¿½?
**æ®‹é…·çœŸç›¸**ï¿½?- 90%çš„å‰ç«¯å¼€å‘è€…ä¸ä¼šåˆ‡æ¢åˆ°æ–°è¯­æ³•ï¼ˆé™¤éï¿½?0å€ä¼˜åŠ¿ï¼‰
- JSX/TSXå·²ç»"è¶³å¤Ÿï¿½?ï¼ˆç”Ÿï¿½?å·¥å…·+ä¹ æƒ¯ï¿½?- æ–°è¯­è¨€éœ€ï¿½?-5å¹´æ‰èƒ½å»ºç«‹ç”Ÿï¿½?
**å¯èƒ½çš„çªç ´ç‚¹**ï¿½?1. ä¸ä¸JSXæ­£é¢ç«äº‰ï¼Œæ‰¾å‚ç›´åœºæ™¯ï¼ˆAIç”Ÿæˆã€å¯è§†åŒ–ç¼–è¾‘ï¿½?2. é™ä½é—¨æ§›ï¼Œæä¾›JSXâ†”OVSè½¬æ¢å·¥å…·
3. æ€æ‰‹çº§ç‰¹æ€§ï¼Œæ‰¾åˆ°JSXåšä¸å¥½ä½†OVSèƒ½åšçš„åœºï¿½?
### ğŸ¯ æˆ˜ç•¥å»ºè®®

**å¦‚æœç›®æ ‡æ˜¯å­¦ï¿½?ç ”ç©¶**
- ï¿½?ç»§ç»­å®Œå–„ï¼Œä¼˜ç§€çš„ç¼–è¯‘å™¨å­¦ä¹ é¡¹ç›®
- ï¿½?å¯ä»¥å‘Paperæˆ–æŠ€æœ¯åšï¿½?- ï¿½?ä½œä¸ºPortfolioå±•ç¤ºæŠ€æœ¯èƒ½ï¿½?
**å¦‚æœç›®æ ‡æ˜¯å•†ä¸šåŒ–/æ¨å¹¿**
- âš ï¸ å…ˆåšVSCodeæ’ä»¶ï¼ˆå¿…éœ€ï¿½?- âš ï¸ å…ˆæ‰¾ï¿½?ä¸ªå‚ç›´åœºæ™¯ï¼ˆAIç”Ÿæˆï¼Ÿï¼‰
- âš ï¸ ä¸è¦ä¸JSXæ­£é¢ç«äº‰

**å¦‚æœç›®æ ‡æ˜¯ä¸ªï¿½?å°å›¢é˜Ÿä½¿ï¿½?*
- ï¿½?å›¢é˜Ÿå–œæ¬¢è¿™ç§è¯­æ³•å°±å¯ä»¥ç”¨
- âš ï¸ åšå¥½é•¿æœŸç»´æŠ¤çš„å‡†ï¿½?- âš ï¸ ç•™å¥½é€€è·¯ï¼ˆæ”¯æŒå¯¼å‡ºä¸ºJSXï¿½?
**å½“å‰é˜¶æ®µå»ºè®®**ï¿½?ä¼˜å…ˆå®ŒæˆVSCodeæ’ä»¶ï¼Œè¿™æ˜¯ä»»ä½•ç¼–ç¨‹è¯­è¨€çš„ç”Ÿå­˜åŸºç¡€ã€‚æ²¡æœ‰IDEæ”¯æŒï¼Œè¿è‡ªå·±ç”¨éƒ½è´¹åŠ²ï¼Œæ›´åˆ«è¯´æ¨å¹¿äº†ï¿½?
---

# ã€æ ¸å¿ƒéœ€æ±‚å±‚ï¿½?
## æ ¸å¿ƒåŠŸèƒ½ï¼ˆç”¨æˆ·èƒ½åšä»€ä¹ˆï¼‰
- **å£°æ˜å¼UIç¼–å†™**ï¼šç”¨ç®€æ´çš„è¯­æ³•ç¼–å†™å¤æ‚UI
- **ç»„ä»¶ç³»ç»Ÿ**ï¼šä½¿ï¿½?`ovsView` å£°æ˜å¯å¤ç”¨ç»„ï¿½?- **å±æ€§ä¼ ï¿½?*ï¼šé€šè¿‡ attrs å¯¹è±¡ä¼ é€’ç»„ä»¶å±ï¿½?- **å®Œæ•´JavaScriptæ”¯æŒ**ï¼šå‡½æ•°ã€å¾ªç¯ã€é¢å‘å¯¹è±¡ã€è¿ç®—ç¬¦ã€æ§åˆ¶æµ
- **æ™ºèƒ½å¯¼å‡ºç³»ç»Ÿ**ï¼šè‡ªåŠ¨è¯†åˆ«å¯¼å‡ºæ–¹å¼ï¼ˆé»˜è®¤ã€å‘½åã€è‡ªåŠ¨åŒ…è£¹ï¼‰
- **å®æ—¶å¼€å‘ä½“ï¿½?*ï¼šçƒ­æ›´æ–°ã€å³æ—¶ç¼–è¯‘é¢„ï¿½?- **ç±»å‹å®‰å…¨å¼€ï¿½?*ï¼šå®Œæ•´TypeScriptæ”¯æŒ

## äº¤äº’/æ¥å£ï¼ˆåŸºæœ¬æµç¨‹ã€å‘ˆç°æ–¹å¼ï¼‰
**å¼€å‘æµç¨‹ï¼š**
1. ç¼–å†™.ovsæ–‡ä»¶ ï¿½?2. è‡ªåŠ¨ç¼–è¯‘ä¸ºVueä»£ç  ï¿½?3. æµè§ˆå™¨å®æ—¶é¢„ï¿½?
**è¯­æ³•æ¥å£ï¿½?*
- OVSå…ƒç´ ï¼š`div { "content" }` 
- ç»„ä»¶å£°æ˜ï¼š`ovsView ComponentName ({attrs}) : rootElement { ... }`
- å±æ€§èµ‹å€¼ï¼š`name = value` ï¼ˆè‡ªåŠ¨æ”¶é›†åˆ° attrsï¿½?- æ¡ä»¶æ¸²æŸ“ï¼š`if (condition) { element }`
- å¾ªç¯æ¸²æŸ“ï¼š`for (item of list) { element }`
- å¯¼å‡ºæ¥å£ï¼š`export const/default`

## æŠ€æœ¯æ–¹å‘ï¼ˆè®¾å¤‡æ”¯æŒã€æ€§èƒ½è¦æ±‚ï¿½?**é»˜è®¤æŠ€æœ¯æ ˆï¿½?* OVS + Vue 3 + Vite + TypeScript + tsx
**è¿è¡Œç¯å¢ƒï¿½?*
- è®¾å¤‡ï¼šæ¡Œé¢æµè§ˆå™¨ä¼˜å…ˆï¼ˆChromeã€Firefoxã€Safariï¿½?- Node.jsï¿½?6+ï¼ˆæ”¯æŒtsxè¿è¡Œï¿½?- æ€§èƒ½ï¼šé›¶è¿è¡Œæ—¶å¼€é”€ï¼ˆç¼–è¯‘æ—¶è½¬æ¢ï¿½?
## æ•°æ®éœ€æ±‚ï¼ˆå­˜ä»€ä¹ˆã€æ€ä¹ˆå­˜ï¼‰
- **æºç æ–‡ä»¶**ï¿½?ovsæ ¼å¼ï¼ˆOVSè¯­æ³•ï¿½?- **ç¼–è¯‘è¾“å‡º**ï¼šJavaScript/TypeScriptä»£ç 
- **é…ç½®æ–‡ä»¶**ï¼špackage.jsonã€tsconfig.jsonã€vite.config.ts
- **æµ‹è¯•æ•°æ®**ï¼šæµ‹è¯•ç”¨ä¾‹ã€fixturesã€ç¤ºä¾‹ä»£ï¿½?- **æ–‡æ¡£**ï¼šREADMEã€ç”¨æˆ·æŒ‡å—ã€APIæ–‡æ¡£

## å®‰å…¨éœ€æ±‚ï¼ˆæ•æ„Ÿçº§åˆ«ã€æƒé™æ§åˆ¶ï¼‰
- **å®‰å…¨çº§åˆ«**ï¼šå¼€å‘å·¥å…·ï¼Œæ— æ•æ„Ÿæ•°ï¿½?- **ç¼–è¯‘å®‰å…¨**ï¼šè¯æ³•åˆ†æã€è¯­æ³•éªŒè¯ï¼Œé˜²æ­¢æ³¨å…¥æ”»å‡»
- **ä¾èµ–ç®¡ç†**ï¼šä½¿ç”¨npm/yarné”å®šç‰ˆæœ¬

## ä¼˜å…ˆçº§ï¼ˆç¬¬ä¸€ç‰ˆåšä»€ä¹ˆï¼‰
**P0-æ ¸å¿ƒåŠŸèƒ½ï¼ˆå·²å®Œæˆï¼‰ï¼š**
- ï¿½?åŸºç¡€OVSè¯­æ³•ï¼ˆdivã€h1ã€pç­‰å…ƒç´ ï¼‰
- ï¿½?å˜é‡å£°æ˜å’Œå¼•ï¿½?- ï¿½?æ¡ä»¶æ¸²æŸ“ï¼ˆifè¯­å¥ï¿½?- ï¿½?åµŒå¥—è§†å›¾

**P1-é«˜çº§åŠŸèƒ½ï¼ˆå·²å®Œæˆï¼‰ï¼š**
- ï¿½?å‡½æ•°å£°æ˜å’Œç®­å¤´å‡½ï¿½?- ï¿½?å¾ªç¯ï¼ˆforã€whileï¿½?- ï¿½?ç®—æœ¯è¿ç®—ç¬¦ï¼ˆ+ï¿½?ï¿½?ï¿½?ï¿½?- ï¿½?æ™ºèƒ½å¯¼å‡ºç³»ç»Ÿ

**P2-ä¼˜åŒ–åŠŸèƒ½ï¼ˆè¿›è¡Œä¸­ï¼‰ï¼š**
- âš ï¸ é™¤æ³•è¿ç®—ç¬¦æ”¯æŒï¼ˆLexerå†²çªï¿½?- âš ï¸ ClassåŠŸèƒ½å®Œå–„ï¼ˆconstructorå‚æ•°ï¿½?- âš ï¸ æ³¨é‡Šç¨³å®šæ€§ä¼˜ï¿½?
---

# ã€ç»†èŠ‚å®ç°å±‚ï¿½?
## æŠ€æœ¯æ ˆè¯¦æƒ…
- **æ ¸å¿ƒæ¡†æ¶**ï¼šVue 3.5.12
- **ç¼–è¯‘å·¥å…·**ï¼šVite 7.1.7
- **ç±»å‹æ”¯æŒ**ï¼šTypeScript 5.8.3
- **è¿è¡Œç¯å¢ƒ**ï¼štsx 4.19.1ï¼ˆæ”¯æŒenumç­‰ç‰¹æ€§ï¼‰
- **è§£æï¿½?*ï¼šSubhuti 0.1.3ï¼ˆè¯æ³•åˆ†æï¼‰
- **ASTå·¥å…·**ï¼šSlimeç³»åˆ—ï¼ˆè¯­æ³•æ ‘ç”Ÿæˆï¿½?- **æµ‹è¯•æ¡†æ¶**ï¼šè‡ªå®šä¹‰æµ‹è¯•è¿è¡Œï¿½?
## æ¨¡å—æ¶æ„
```
ovs/
â”œâ”€â”€ src/                    # æ ¸å¿ƒç¼–è¯‘ï¿½?ï¿½?  â”œâ”€â”€ parser/            # è¯­æ³•åˆ†æï¿½?ï¿½?  â”œâ”€â”€ factory/           # ä»£ç ç”Ÿæˆå·¥å‚
ï¿½?  â”œâ”€â”€ model/             # ASTæ¨¡å‹
ï¿½?  â”œâ”€â”€ view/              # è§†å›¾æ¸²æŸ“
ï¿½?  â””â”€â”€ interface/         # ç±»å‹å®šä¹‰
â”œâ”€â”€ example/               # ç¤ºä¾‹é¡¹ç›®
â”œâ”€â”€ tests/                 # å®Œæ•´æµ‹è¯•å¥—ä»¶
â””â”€â”€ docs/                  # æŠ€æœ¯æ–‡ï¿½?```

## ç¼–è¯‘æµç¨‹
1. **è¯æ³•åˆ†æ**ï¼ˆSubhutiLexer + ovs6Tokensï¼‰â†’ Tokenæµï¼ˆè¯†åˆ«ovsViewå…³é”®å­—ï¼‰
2. **è¯­æ³•åˆ†æ**ï¼ˆOvsParserï¼‰â†’ CSTè¯­æ³•ï¿½? 
3. **è¯­æ³•è½¬æ¢**ï¼ˆOvsCstToSlimeAstï¼‰â†’ ASTæŠ½è±¡è¯­æ³•ï¿½?4. **å¯¼å…¥æ·»åŠ **ï¼ˆensureOvsAPIImportï¼‰â†’ æ·»åŠ  `import { h } from 'vue'`
5. **è¡¨è¾¾å¼åŒ…ï¿½?*ï¼ˆwrapTopLevelExpressionsï¼‰â†’ æ™ºèƒ½IIFEä¼˜åŒ–
6. **ä»£ç ç”Ÿæˆ**ï¼ˆSlimeGeneratorï¼‰â†’ æœ€ç»ˆJavaScriptä»£ç 

## æ™ºèƒ½å¯¼å‡ºè§„åˆ™
- **æœ‰export default**ï¼šä¿æŒåŸæ ·ï¼Œä¸åŒ…è£¹IIFE
- **æ— export default**ï¼šIIFEåŒ…è£¹æ‰€æœ‰è¡¨è¾¾å¼ï¼Œå£°æ˜ä¿æŒé¡¶ï¿½?- **export const**ï¼šåªè½¬æ¢OVSéƒ¨åˆ†ï¼Œä¿æŒå¯¼å‡ºç»“ï¿½?- **å¤šä¸ªè§†å›¾**ï¼šè¿”å›childrenæ•°ç»„

## è¯­æ³•è§„èŒƒ

### æ”¯æŒçš„è¯­ï¿½?```javascript
// å˜é‡å£°æ˜
const/let/var declarations

// å‡½æ•°
function declarations
arrow functions (x) => x

// æ§åˆ¶ï¿½? 
if/else conditions
for/while loops

// è¿ç®—ï¿½?+, -, *, %, >, <, ===, !, &&, ||

// OVSå…ƒç´ 
div { content }
h1 { "title" }
p { variable }

// æ¡ä»¶æ¸²æŸ“
if (condition) { element }

// åµŒå¥—
div { div { div { "deep nesting" } } }
```

### å·²çŸ¥é™åˆ¶ä¸è§£å†³æ–¹ï¿½?
| é™åˆ¶ | çŠ¶ï¿½?| å½±å“ | æ›¿ä»£æ–¹æ¡ˆ |
|------|------|------|----------|
| **é™¤æ³•è¿ç®—ï¿½?`/`** | ï¿½?| Lexerå†²çªï¼ˆä¸æ³¨é‡Š `//`ï¿½?| ï¿½?`* 0.5` ä»£æ›¿ `/ 2` |
| **Class constructorå‚æ•°** | âš ï¸ | å‚æ•°æœ‰å°é—®é¢˜ï¼ŒåŸºæœ¬å¯ï¿½?| ç®€å•ä½¿ç”¨å¯ä»¥ï¼Œå¤æ‚åœºæ™¯ç”¨å¤–éƒ¨TS |
| **æ³¨é‡Šç¨³å®šï¿½?* | âš ï¸ | éƒ¨åˆ†åœºæ™¯ä¸ç¨³ï¿½?| ç”¨æœ‰æ„ä¹‰çš„å˜é‡åä»£æ›¿ |

**å·²ä¿®å¤çš„å†å²é—®é¢˜ï¿½?*
- ï¿½?Constructor with assignment statementsï¼ˆthis.x = 1ï¿½? å·²å®Œå…¨ä¿®ï¿½?- ï¿½?Export classæ”¯æŒ - å·²å®Œå…¨æ”¯ï¿½?- ï¿½?å‡½æ•°å‚æ•°ä¸¢å¤± - å·²ä¿®ï¿½?- ï¿½?äºŒå…ƒè¡¨è¾¾å¼æ”¯ï¿½?- å·²å®ï¿½?- ï¿½?Token type undefined - å·²ä¿®ï¿½?
## å¼€å‘å‘½ï¿½?```bash
# å¼€å‘æœåŠ¡å™¨
npm run dev              # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆhttp://localhost:5173ï¿½?
# æµ‹è¯•
npm test                 # æ‰§è¡Œtest-runner.tsï¼ˆç»Ÿä¸€æµ‹è¯•å…¥å£ï¿½?npx tsx test-runner.ts   # ç›´æ¥æ‰§è¡Œæµ‹è¯•å…¥å£
npm run test:unit        # å•å…ƒæµ‹è¯•
npm run test:integration # é›†æˆæµ‹è¯•
npm run test:regression  # å›å½’æµ‹è¯•
npm run test:watch      # ç›‘å¬æ¨¡å¼

# æ„å»º
npm run build           # ç”Ÿäº§æ„å»º
npm run preview         # é¢„è§ˆæ„å»ºç»“æœ
```

## æ€§èƒ½ç‰¹ï¿½?
### æ ¸å¿ƒä¼˜åŒ–ï¼šæ™ºèƒ½IIFEç³»ç»Ÿ
**ç®€å•è§†å›¾ï¼ˆå®Œå…¨æ— IIFEï¿½?**
- æ¡ä»¶ï¼šè§†å›¾å†…éƒ¨åªåŒ…å«è¡¨è¾¾å¼ï¼Œæ— ä»»ä½•è¯­ï¿½?- ç¼–è¯‘ç»“æœï¼šç›´æ¥è°ƒï¿½?`OvsAPI.createVNode`ï¼Œæ— å‡½æ•°åŒ…è£¹
- æ€§èƒ½æå‡ï¼šå®Œå…¨é›¶å¼€é”€ï¼Œä»£ç é‡å‡å°‘40-50%

**å¤æ‚è§†å›¾ï¼ˆä¿ç•™IIFEï¿½?**
- æ¡ä»¶ï¼šè§†å›¾å†…éƒ¨åŒ…å«è¯­å¥ï¼ˆå˜é‡å£°æ˜ã€å¾ªç¯ã€æ¡ä»¶ç­‰ï¿½?- ç¼–è¯‘ç»“æœï¼šå®Œæ•´IIFEå‡½æ•°ï¼Œæ”¯æŒæ‰€æœ‰ES6ç‰¹ï¿½?- åŠŸèƒ½ï¼šä½œç”¨åŸŸéš”ç¦»ã€å®Œæ•´é€»è¾‘æ§åˆ¶èƒ½åŠ›

### æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”
| æŒ‡æ ‡ | ä¼˜åŒ–ï¿½?| ä¼˜åŒ–ï¿½?| æå‡ |
|-----|-------|-------|------|
| **åµŒå¥—IIFEæ•°é‡** | æ¯ä¸ªview 1ï¿½?| ç®€å•view: 0 | **-100%** ï¿½?|
| **ä»£ç è¡Œæ•°** | ~12ï¿½?| ~7ï¿½?| **-40%** |
| **è¿è¡Œæ—¶è°ƒï¿½?* | 4æ¬¡IIFE | 0ï¿½?ç®€ï¿½? | **é›¶å¼€é”€** |
| **å¯è¯»ï¿½?* | ä¸­ç­‰ | æé«˜ | **æ˜¾è‘—æå‡** |

### å…¶ä»–æ€§èƒ½ç‰¹ï¿½?- **é›¶è¿è¡Œæ—¶å¼€é”€**ï¼šç¼–è¯‘æ—¶è½¬æ¢ï¼Œæ— é¢å¤–è¿è¡Œæ—¶åº“
- **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´TypeScriptæ”¯æŒï¼Œç¼–è¯‘æ—¶ç±»å‹æ£€ï¿½?- **å®æ—¶çƒ­æ›´ï¿½?*ï¼šViteé©±åŠ¨çš„å¿«é€Ÿå¼€å‘ä½“ï¿½?- **ç¼–è¯‘é€Ÿåº¦**ï¿½? 100msï¼ˆä¸­ç­‰å¤æ‚åº¦ï¿½?- **åŒ…å¤§ï¿½?*ï¼šæ— é¢å¤–è¿è¡Œæ—¶åº“ä¾èµ–

## æµ‹è¯•è¦†ç›–

### æµ‹è¯•é€šè¿‡ç‡ï¼š91.7%ï¿½?1/12ï¿½?
**ï¿½?å·²è¦†ç›–ç‰¹ï¿½?*

**Export & Import**
- ï¿½?export class
- ï¿½?export const  
- ï¿½?export default
- ï¿½?Multiple named exports

**Class Features**
- ï¿½?Empty constructor
- ï¿½?Multiple methods
- ï¿½?Method with parameters
- ï¿½?this references
- ï¿½?Arrow functions in methods

**OVS Syntax**
- ï¿½?Elements with/without props
- ï¿½?Nested elements
- ï¿½?Conditional rendering (if)
- ï¿½?List rendering (map)
- ï¿½?Props with reserved keywords

**Operators**
- ï¿½?Unary: !, +, -, typeof
- ï¿½?Comparison: ===, !==, <, >
- ï¿½?Arithmetic: +, -, *, %
- ï¿½?Logical: &&, ||

**JavaScript Features**
- ï¿½?const/let/var
- ï¿½?Functions
- ï¿½?Arrow functions
- ï¿½?Loops (for, while)
- ï¿½?Conditionals (if/else)

### æµ‹è¯•æ¶æ„ï¼ˆAIå¼€å‘ä¼˜åŒ–ï¼‰

**testsç›®å½•ç»“æ„ï¼ˆæç®€ç‰ˆï¼‰ï¿½?*
```
tests/
â”œâ”€â”€ cases/             # æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼ˆ01-12ç¼–å·ï¼Œç®€å•â†’å¤æ‚ï¼Œç¦æ­¢åˆ†å­ç›®å½•ï¼‰
ï¿½?  â”œâ”€â”€ 01-simple.ovs
ï¿½?  â”œâ”€â”€ 02-nested.ovs
ï¿½?  â”œâ”€â”€ ...
ï¿½?  â””â”€â”€ 12-complex-feature.ovs
â””â”€â”€ utils/             # è°ƒè¯•å·¥å…·ï¼ˆAIè¾…åŠ©ä½¿ç”¨ï¿½?    â”œâ”€â”€ check-iife-ast.ts         # æ£€æŸ¥ASTç»“æ„
    â””â”€â”€ show-hello-compiled.ts    # æŸ¥çœ‹ç¼–è¯‘ç»“æœ
```

**è®¾è®¡ç†å¿µï¿½?*
- AIå¼€å‘é¡¹ç›®ä¸éœ€è¦jest/vitestç­‰è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼ˆé‚£æ˜¯ç»™äººç±»CI/CDç”¨çš„ï¿½?- AIé€šè¿‡å¤åˆ¶.ovsç”¨ä¾‹åˆ°example/æµ‹è¯•ç¼–è¯‘å™¨åŠŸï¿½?- utils/ä¸‹çš„å·¥å…·ç”¨äºæ‰‹åŠ¨è°ƒè¯•å’ŒæŸ¥çœ‹ç¼–è¯‘ç»“ï¿½?- æç®€ç»“æ„ï¼šä»25ä¸ªæ–‡ä»¶ç²¾ç®€ï¿½?4ä¸ªï¼ˆå‡å°‘44%ï¿½?- æ‰å¹³åŒ–ï¼šä¸æŒ‰ç±»å‹åˆ†å­ç›®å½•ï¼ˆsingle/combinedç­‰ï¼‰ï¼Œæ‰€æœ‰ç”¨ä¾‹å¹³é“ºåœ¨cases/ï¿½?
**å‘½åè§„èŒƒï¿½?*
- æ ¼å¼ï¼š`01-åŠŸèƒ½ï¿½?ovs`ï¼ˆä¸¤ä½æ•°ç¼–å·ï¿½?- é¡ºåºï¼šæŒ‰å¤æ‚åº¦æ’åºï¼ˆç®€å•â†’å¤æ‚ï¿½?- ç¦æ­¢ï¼šæŒ‰ç±»å‹åˆ›å»ºå­ç›®å½•ï¼ˆsingle/ã€combined/ç­‰ï¼‰

**AIå¦‚ä½•ä½¿ç”¨ï¿½?*
1. **æµ‹è¯•ç¼–è¯‘åŠŸèƒ½**ï¼šå¤åˆ¶cases/ä¸‹çš„.ovsåˆ°example/src/views/hello.ovsï¼Œå¯åŠ¨devæœåŠ¡å™¨æŸ¥ï¿½?2. **æŸ¥çœ‹ç¼–è¯‘ç»“æœ**ï¼šè¿ï¿½?`npx tsx tests/utils/show-hello-compiled.ts`
3. **æ£€æŸ¥ASTç»“æ„**ï¼šè¿ï¿½?`npx tsx tests/utils/check-iife-ast.ts`ï¼ˆè°ƒè¯•ä¼˜åŒ–ç”¨ï¿½?
**å·²åˆ é™¤çš„è‡ªåŠ¨åŒ–æµ‹è¯•åŸºç¡€è®¾æ–½ï¿½?*
- unit/ã€integration/ã€regression/ï¿½?test.tsæ–‡ä»¶ï¿½?- fixtures/ï¼ˆæµ‹è¯•æ•°æ®ï¼‰
- jest.config.jsã€vitest.config.tsï¼ˆé…ç½®ï¼‰
- run-all-tests.tsã€run-tests.tsï¼ˆè¿è¡Œå™¨ï¿½?- test-helpers.tsï¼ˆè¾…åŠ©å‡½æ•°ï¼‰

## å¿«é€Ÿå¼€å§‹æŒ‡ï¿½?
### 5åˆ†é’Ÿä¸Šæ‰‹
```bash
# 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
cd ovs && npm run dev

# 2. ç¼–å†™ç¬¬ä¸€ä¸ªOVSç»„ä»¶ï¼ˆhello.ovsï¿½?const greeting = "Hello OVS!"

div {
  h1 { greeting }
  p { "Welcome to declarative UI!" }
}

# 3. æµè§ˆå™¨æŸ¥çœ‹ï¼šhttp://localhost:5173
```

### æµ‹è¯•ç”¨ä¾‹å¿«é€Ÿä½“ï¿½?```bash
# å¤åˆ¶åŸºç¡€ç¤ºä¾‹
Copy-Item tests\cases\01-simple.ovs example\src\views\hello.ovs

# å¤åˆ¶ç®­å¤´å‡½æ•°ç¤ºä¾‹
Copy-Item tests\cases\07-arrow-functions.ovs example\src\views\hello.ovs

# å¤åˆ¶Classç¤ºä¾‹
Copy-Item tests\cases\08-class.ovs example\src\views\hello.ovs

# å¤åˆ¶ç»„åˆæµ‹è¯•ï¼ˆexport + classï¿½?Copy-Item tests\cases\11-export-class.ovs example\src\views\hello.ovs
```

### æµè§ˆå™¨è°ƒè¯•æŒ‡ï¿½?**è®¿é—®åœ°å€ï¿½?* http://localhost:5173

**é¢„æœŸæ˜¾ç¤ºå†…å®¹ï¿½?*
1. **ç®€å•è§†å›¾åŒºï¿½?*ï¼šæ ‡ï¿½?+ æ–‡æœ¬å†…å®¹
2. **å¤æ‚è§†å›¾åŒºå—**ï¼šforå¾ªç¯æ¸²æŸ“åˆ—è¡¨ï¼ˆappleã€bananaã€cherryï¿½?3. **æ¡ä»¶è§†å›¾åŒºå—**ï¼šifæ¡ä»¶æ¸²æŸ“å†…å®¹

**è°ƒè¯•æ­¥éª¤ï¿½?*
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¿½?2. æŸ¥çœ‹Consoleæ§åˆ¶å°çš„`OvsAPI.createVNode`è°ƒç”¨æ—¥å¿—
3. æ£€æŸ¥Elementsé¢æ¿çš„DOMç»“æ„
4. éªŒè¯åŠŸèƒ½æ˜¯å¦æ­£ç¡®æ¸²æŸ“

## æ–‡æ¡£ä½“ç³»
- **.cursor/rules/guidebot.mdc**ï¼šé€šç”¨AIåä½œè§„åˆ™å’Œæ–¹æ³•è®º
- **.cursor/rules/project.mdc**ï¼šOVSé¡¹ç›®å®Œæ•´æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¿½?  - åŒ…å«ï¼šé¡¹ç›®å®šä½ã€æ ¸å¿ƒåŠŸèƒ½ã€è¯­æ³•å‚è€ƒã€å®ç°åŸç†ã€ä»£ç ç¤ºä¾‹ã€æœ€ä½³å®ï¿½?  - ä½œç”¨ï¼šAIç†è§£é¡¹ç›®çš„å•ä¸€ä¿¡æ¯æºï¼Œæ‰€æœ‰é¡¹ç›®ä¿¡æ¯éƒ½åœ¨è¿™ï¿½?  - æˆæœï¼šæ•´åˆäº†14ä¸ªåˆ†æ•£æ–‡æ¡£ï¼Œä¿¡æ¯å¯†åº¦æå‡700%ï¼Œå®ï¿½?å•ä¸€ä¿¡æ¯ï¿½?

## ä¾èµ–é¡¹ç›®
- **Subhuti 0.1.3**ï¼šParseræ¡†æ¶ï¼ˆè¯æ³•åˆ†æï¼‰
- **Slimeç³»åˆ—**ï¼šASTå·¥å…·é“¾ï¼ˆè¯­æ³•æ ‘å¤„ç†ï¼‰
- **Vue 3.5.12**ï¼šæ¸²æŸ“å¼•æ“ï¼ˆç›®æ ‡æ¡†æ¶ï¿½?- **Vite 7.1.7**ï¼šæ„å»ºå·¥å…·ï¼ˆå¼€å‘ä½“éªŒï¼‰

---

# ã€å®Œæ•´è¯­æ³•å‚è€ƒï¿½?
## OVSè¯­æ³•è§„åˆ™

### ç»„ä»¶ç³»ç»Ÿï¼ˆNEWï¿½?
**ç»„ä»¶å£°æ˜ï¿½?*
```javascript
ovsView ComponentName ({attrs}) : rootElement {
  // ç»„ä»¶å†…éƒ¨é€»è¾‘
  let data = attrs.value
  
  h1 { attrs.title }
  slot{}  // æ’æ§½
  p { data }
}

// ç¼–è¯‘ï¿½?ï¿½?function ComponentName({attrs}, {slots}) {
  let data = attrs.value
  return h('div', {}, [
    h('h1', {}, [attrs.title]),
    slots.default(),  // æ¸²æŸ“æ’æ§½
    h('p', {}, [data])
  ])
}
```

**ç»„ä»¶è°ƒç”¨ï¿½?*
```javascript
div {
  MyCard({attrs: {title: "Hello", content: "World"}}) {
    p { "æ’æ§½å†…å®¹" }
    "child content"
  }
}

// ç¼–è¯‘ï¿½?ï¿½?h('div', {}, [
  h(MyCard, {attrs: {title: "Hello", content: "World"}}, [
    h('p', {}, ["æ’æ§½å†…å®¹"]),
    "child content"
  ])
])
```

**å…³é”®ç‰¹æ€§ï¼š**
- ç»„ä»¶åé¦–å­—æ¯å¤§å†™ï¼šè‡ªåŠ¨è¯†åˆ«ä¸ºç»„ä»¶ï¼Œç”Ÿï¿½?`h(Component, ...)`
- æ ‡ç­¾åå°å†™ï¼šè¯†åˆ«ä¸ºHTMLæ ‡ç­¾ï¼Œç”Ÿï¿½?`h('div', ...)`
- Arguments å‚æ•°ï¼šä½œï¿½?props å¯¹è±¡ä¼ ï¿½?- èŠ±æ‹¬å·å†…å®¹ï¼šä½œä¸º children ä¼ ï¿½?- `slot{}`ï¼šç¼–è¯‘ä¸º `slots.default()`ï¼Œç»„ä»¶è‡ªåŠ¨æ·»ï¿½?`{slots}` å‚æ•°

### æ ¸å¿ƒæ¸²æŸ“è§„åˆ™ï¼ˆv0.2.0 é‡å¤§æ›´æ–°ï¿½?
**è®¾è®¡å“²å­¦ï¼šJavaScript æ˜¯ä¸»ä½“ï¼ŒUI æ˜¯é™„ï¿½?*

ï¿½?`div {}` å†…éƒ¨ï¼Œé»˜è®¤æ‰€æœ‰è¡¨è¾¾å¼éƒ½ä¼šè¢«æ¸²æŸ“ï¼Œä½¿ç”¨ `#{}` éš”ç¦»ä¸éœ€è¦æ¸²æŸ“çš„ä»£ç ï¿½?
#### åŸºç¡€æ¸²æŸ“è§„åˆ™

```javascript
div {
  // æ°¸è¿œä¸æ¸²æŸ“ï¼ˆDeclarationï¿½?  const data = [1, 2, 3]   // ï¿½?ä¸æ¸²æŸ“ï¼ˆå˜é‡å£°æ˜ï¿½?  function helper() {}     // ï¿½?ä¸æ¸²æŸ“ï¼ˆå‡½æ•°å£°æ˜ï¿½?  
  // é»˜è®¤æ¸²æŸ“ï¼ˆExpressionStatementï¿½?  p { "hello" }            // ï¿½?æ¸²æŸ“ï¼ˆå…ƒç´ ï¼‰
  func()                   // ï¿½?æ¸²æŸ“ï¼ˆå‡½æ•°è°ƒç”¨è¿”å›å€¼ï¼‰
  "text"                   // ï¿½?æ¸²æŸ“ï¼ˆå­—ç¬¦ä¸²ï¿½?  count + 1                // ï¿½?æ¸²æŸ“ï¼ˆè¡¨è¾¾å¼ç»“æœï¿½?}
```

#### `#{}` ä¸æ¸²æŸ“å—ï¼ˆNEWï¿½?
ä½¿ç”¨ `#{}` åŒ…è£¹çš„ä»£ç ä¸ä¼šè¢«æ¸²æŸ“ï¼ˆé™¤éæ˜¯æ˜ç¡®çš„æ¸²æŸ“å…ƒç´ ï¼‰ï¿½?
```javascript
div {
  // #{} ç”¨äºéš”ç¦»çº¯é€»è¾‘ä»£ç 
  #{
    const x = getData()     // ä¸æ¸²æŸ“ï¼ˆï¿½?#{} å†…ï¼‰
    console.log(x)          // ä¸æ¸²æŸ“ï¼ˆï¿½?#{} å†…ï¼‰
    processData(x)          // ä¸æ¸²æŸ“ï¼ˆï¿½?#{} å†…ï¼‰
  }
  
  // å…ƒç´ æ°¸è¿œæ¸²æŸ“ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
  #{
    p { "æˆ‘åœ¨ #{} ï¿½? }     // ï¿½?ä»ç„¶æ¸²æŸ“ï¼ˆå…ƒç´ ä¼˜å…ˆï¼‰
    span { "æˆ‘ä¹Ÿæ¸²æŸ“" }     // ï¿½?ä»ç„¶æ¸²æŸ“
  }
  
  // å¤–å±‚æ­£å¸¸æ¸²æŸ“
  p { "å¤–å±‚å†…å®¹" }          // ï¿½?æ¸²æŸ“
  getTitle()                // ï¿½?æ¸²æŸ“ï¼ˆä¸ï¿½?#{} å†…ï¼‰
}

// ç¼–è¯‘ï¿½?ï¿½?(function() {
  const children = []
  
  // #{} å†…çš„ä»£ç å¹³é“ºï¼ˆä¸ï¿½?pushï¿½?  const x = getData()
  console.log(x)
  processData(x)
  
  // #{} å†…çš„å…ƒç´ ä»ç„¶ï¿½?push
  children.push(h('p', {}, ['æˆ‘åœ¨ #{} ï¿½?]))
  children.push(h('span', {}, ['æˆ‘ä¹Ÿæ¸²æŸ“']))
  
  // å¤–å±‚æ­£å¸¸ push
  children.push(h('p', {}, ['å¤–å±‚å†…å®¹']))
  children.push(getTitle())
  
  return h('div', {}, children)
})()
```

#### æ¸²æŸ“ä¼˜å…ˆï¿½?
```
1. OvsRenderFunction (p {}, div {}) ï¿½?æ°¸è¿œæ¸²æŸ“ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¿½?2. ï¿½?#{} ï¿½?ï¿½?ä¸æ¸²æŸ“ï¼ˆé»˜è®¤ï¿½?3. ï¿½?div {} ï¿½?ï¿½?æ¸²æŸ“
4. å…¶ä»– ï¿½?ä¸æ¸²ï¿½?```

#### æ§åˆ¶æµä¸­çš„æ¸²ï¿½?
```javascript
div {
  if (show) {
    #{
      const temp = getData()
      console.log(temp)      // ä¸æ¸²ï¿½?    }
    p { "visible" }          // ï¿½?æ¸²æŸ“
  }
  
  #{
    let i = 0
  }
  
  p { items[0] }
  
  #{
    i = i + 1
  }
  
  p { items[1] }
}
```

#### `#{}` çš„ç‰¹ï¿½?
- ï¿½?å¯ä»¥åµŒå¥—ï¼š`#{ #{ } }`
- ï¿½?åœ¨æ§åˆ¶æµå†…æ­£å¸¸å·¥ä½œï¼š`if () { #{ } }`
- ï¿½?å†…éƒ¨å…ƒç´ ä»ç„¶æ¸²æŸ“ï¼š`#{ p {} }`
- ï¿½?è¯­å¥å¹³é“ºï¼ˆä¸å¢åŠ åŒ…è£¹ï¿½?- ï¿½?å¯¹å…ƒç´ å†…éƒ¨ä¸ç”Ÿæ•ˆï¼ˆè¿›å…¥å…ƒç´ æ—¶é‡ç½®ï¿½?- ï¿½?ä½œç”¨åŸŸå…±äº«ï¼ˆå¯è®¿é—®å¤–å±‚å˜é‡ï¼‰

## å¯¼å‡ºæ–¹å¼

### æ–¹å¼1: å‘½åå¯¼å‡ºï¼ˆæ¨èï¼‰
```javascript
export const myComponent = div {
  "content"
}

// ä½¿ç”¨
import {myComponent} from './component.ovs'
```

### æ–¹å¼2: é»˜è®¤å¯¼å‡º
```javascript
export default div {
  "content"
}

// ä½¿ç”¨
import MyComponent from './component.ovs'
```

### æ–¹å¼3: è‡ªåŠ¨é»˜è®¤å¯¼å‡º
```javascript
// åªæœ‰å£°æ˜å’Œè¡¨è¾¾å¼ï¼Œæ²¡ï¿½?export default
const data = 100

div{456}
div{789}

// è‡ªåŠ¨ç”Ÿæˆ export default åŒ…è£¹æ‰€æœ‰è¡¨è¾¾å¼
```

### æ–¹å¼4: å¤šä¸ªå¯¼å‡º
```javascript
export const header = div { "Header" }
export const footer = div { "Footer" }
export const sidebar = div { "Sidebar" }

// ä½¿ç”¨
import {header, footer, sidebar} from './components.ovs'
```

## ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹1: `#{}` ä¸æ¸²æŸ“å—ä½¿ç”¨ï¼ˆNEW - v0.2.0ï¿½?```javascript
#{
  // é¡¶å±‚æ•°æ®åˆå§‹åŒ–ï¼ˆä¸æ¸²æŸ“ï¼‰
  const userName = "Alice"
  const userScore = 95
  
  // å·¥å…·å‡½æ•°ï¼ˆä¸æ¸²æŸ“ï¿½?  function formatScore(score) {
    return score >= 90 ? "ä¼˜ç§€" : "è‰¯å¥½"
  }
  
  console.log("é¡µé¢åˆå§‹ï¿½?)
}

div {
  h1 { "ç”¨æˆ·ä¿¡æ¯" }
  
  // æ™®é€šè°ƒç”¨ä¼šè¢«æ¸²ï¿½?  p { formatScore(userScore) }
  
  // #{} éš”ç¦»çº¯é€»è¾‘
  #{
    const temp = getData()
    console.log("è°ƒè¯•ä¿¡æ¯", temp)  // ä¸ä¼šæ˜¾ç¤ºåœ¨é¡µï¿½?  }
  
  // #{} å†…çš„å…ƒç´ ä»ç„¶æ¸²æŸ“
  #{
    const msg = "è®¡ç®—ç»“æœ"
    p { msg }                     // ï¿½?ä»ç„¶æ˜¾ç¤º
  }
  
  // æ§åˆ¶ï¿½?  #{
    let i = 0
  }
  
  p { items[0] }
  
  #{
    i = i + 1
  }
  
  p { items[1] }
}
```

### ç¤ºä¾‹2: ä¸ªäººä¿¡æ¯å¡ç‰‡
```javascript
const userName = "Alice"
const userAge = 25
const userRole = "Developer"
const isActive = true

div {
  h1 { userName }
  
  div {
    p { "Age: " }
    p { userAge }
  }
  
  div {
    p { "Role: " }
    p { userRole }
  }
  
  if (isActive) {
    div {
      p { "Status: Active" }
    }
  }
}
```

### ç¤ºä¾‹2: å‡½æ•°ä¸å¾ªç¯ç»“ï¿½?```javascript
function calculateSum(numbers) {
  let total = 0
  for (let i = 0; i < numbers.length; i++) {
    total = total + numbers[i]
  }
  return total
}

const double = (x) => x * 2

const items = [10, 20, 30]
const sum = calculateSum(items)
const doubled = double(sum)

div {
  h1 { "Calculation Results" }
  
  div {
    p { "Sum: " }
    p { sum }
  }
  
  div {
    p { "Doubled: " }
    p { doubled }
  }
}
```

### ç¤ºä¾‹3: å¤šè§†å›¾ç»„ï¿½?```javascript
const appTitle = "My Dashboard"

export const HeaderView = div {
  h1 { appTitle }
  p { "Welcome" }
}

export const ContentView = div {
  h2 { "Content" }
  p { "Main content area" }
}

export const FooterView = div {
  p { "Footer" }
}
```

## æœ€ä½³å®ï¿½?
### ï¿½?æ¨è

```javascript
// 1. ä½¿ç”¨ #{} ç»„ç»‡æ•°æ®å’Œå·¥å…·å‡½æ•°ï¼ˆNEW - v0.2.0ï¿½?#{
  const userName = "Alice"
  const userAge = 25
  
  function formatAge(age) {
    return age + " ï¿½?
  }
  
  console.log("åˆå§‹åŒ–å®Œï¿½?)
}

// 2. ï¿½?div {} å†…ç”¨ #{} éš”ç¦»çº¯é€»è¾‘
div {
  #{
    const data = processData()
    console.log("å¤„ç†å®Œæˆ")
  }
  
  p { data }
}

// 3. #{} å†…çš„å…ƒç´ ä»ç„¶æ¸²æŸ“
#{
  const show = true
  if (show) {
    p { "æ¡ä»¶æ¸²æŸ“" }  // ï¿½?ä»ç„¶æ˜¾ç¤º
  }
}

// 4. ç»„ä»¶å†…ä½¿ï¿½?#{} è®¡ç®—å±€éƒ¨æ•°ï¿½?ovsView Card ({props}) : div {
  #{
    const user = props.user
    const displayName = user.firstName + " " + user.lastName
  }
  
  h2 { displayName }
  p { user.email }
}
```

### ï¿½?é¿å…
```javascript
// ä¸è¦ä½¿ç”¨æ³¨é‡Šï¼ˆä¸ç¨³å®šï¿½?// const x = 100  // ï¿½?
// ä¸è¦ä½¿ç”¨é™¤æ³•ï¼ˆLexer å†²çªï¿½?const half = value / 2  // ï¿½?const half = value * 0.5  // ï¿½?
// ä¸è¦è¿‡åº¦åµŒå¥—
div { div { div { div { div {  // ï¿½?å¤ªæ·±
```

## å¸¸è§é—®é¢˜

**Q: å¦‚ä½•è°ƒè¯•ï¿½?*
æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹Consoleè¾“å‡ºã€ElementsæŸ¥çœ‹DOMç»“æ„ã€NetworkæŸ¥çœ‹ç¼–è¯‘åä»£ï¿½?
**Q: å¦‚ä½•æŸ¥çœ‹ç¼–è¯‘åçš„ä»£ç ï¿½?*
è¿è¡Œ `npx tsx ovs/src/test-final.ts`

**Q: ä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨é™¤æ³•ï¼Ÿ**
Lexerï¿½?`/` å½“æˆæ³¨é‡Šå¼€å§‹ï¼Œæ›¿ä»£æ–¹æ¡ˆï¼šç”¨ `* 0.5`

**Q: å¦‚ä½•å®ç°åˆ—è¡¨æ¸²æŸ“ï¿½?*
ä½¿ç”¨forå¾ªç¯ï¿½?```javascript
const items = ["A", "B", "C"]
for (let i = 0; i < items.length; i++) {
  div { p { items[i] } }
}
```

**Q: å¦‚ä½•ç»„åˆå¤šä¸ªç»„ä»¶ï¿½?*
ä½¿ç”¨å‘½åå¯¼å‡ºï¿½?```javascript
// components.ovs
export const Header = div { "Header" }
export const Footer = div { "Footer" }

// app.ovs
import {Header, Footer} from './components.ovs'
div {
  Header
  Footer
}
```

---

# ã€æ ¸å¿ƒå®ç°åŸç†ï¿½?
## ç¼–è¯‘æµç¨‹æ¶æ„
```
OVSæºä»£ï¿½?  ï¿½?1. è¯æ³•åˆ†æ(SubhutiLexer)
Tokens
  ï¿½?2. è¯­æ³•åˆ†æ(OvsParser)
CSTå…·ä½“è¯­æ³•ï¿½?  ï¿½?3. è¯­æ³•è½¬æ¢(OvsCstToSlimeAst.toProgram)
JavaScript AST
  ï¿½?4. æ·»åŠ import(ensureOvsAPIImport)
å¸¦importçš„AST
  ï¿½?5. åŒ…è£¹é¡¶å±‚è¡¨è¾¾ï¿½?wrapTopLevelExpressions) ï¿½?å¤„ç†åçš„AST
  ï¿½?6. ä»£ç ç”Ÿæˆ(SlimeGenerator.generator)
JavaScriptä»£ç 
  ï¿½?7. æ ¼å¼ï¿½?Prettier-ä»…ç”Ÿäº§ç¯ï¿½?
æœ€ç»ˆä»£ï¿½?```

## æ ¸å¿ƒæœºåˆ¶

### 1. è®¡æ•°å™¨æœºåˆ¶ï¼ˆOvsRenderDomViewDepthï¿½?ä½¿ç”¨è®¡æ•°å™¨æ ‡è®°å½“å‰æ˜¯å¦åœ¨OVSå…ƒç´ å†…éƒ¨ï¿½?
```typescript
export class OvsCstToSlimeAst extends SlimeCstToAst {
  private ovsRenderDomViewDepth = 0;

  createOvsRenderDomViewDeclarationAst(cst) {
    this.ovsRenderDomViewDepth++  // è¿›å…¥ï¿½?1
    try {
      // è½¬æ¢StatementList
      // ç”ŸæˆIIFEå‡½æ•°ï¿½?    } finally {
      this.ovsRenderDomViewDepth--  // é€€å‡ºï¼Œ-1
    }
  }

  createExpressionStatementAst(cst) {
    if (this.ovsRenderDomViewDepth > 0) {
      // åœ¨OVSå…ƒç´ å†…ï¼Œè½¬æ¢ä¸ºchildren.push(expr)
      return createChildrenPushStatement(expr)
    } else {
      // ä¸åœ¨å†…éƒ¨ï¼Œä¿æŒåŸï¿½?      return super.createExpressionStatementAst(cst)
    }
  }
}
```

**ä¼˜åŠ¿ï¿½?* ç®€å•ï¼ˆåªéœ€ä¸€ä¸ªæ•´æ•°ï¼‰ã€è‡ªåŠ¨ä¼ é€’ï¼ˆå®ä¾‹å˜é‡ï¼‰ã€æ”¯æŒåµŒå¥—ï¼ˆé€šè¿‡IIFEä½œç”¨åŸŸéš”ç¦»ï¼‰

### 2. æ™ºèƒ½å¯¼å‡ºç³»ç»Ÿ
```typescript
function wrapTopLevelExpressions(ast: SlimeProgram): SlimeProgram {
  const declarations: any[] = []
  const expressions: SlimeStatement[] = []
  let hasExportDefault = false
  
  // 1. åˆ†ç±»declarationså’Œexpressions
  for (const statement of ast.body) {
    if (statement.type === 'ExportDefaultDeclaration') {
      hasExportDefault = true
      declarations.push(statement)
    } else if (isDeclaration(statement)) {
      declarations.push(statement)  // const/let/function/class
    } else {
      expressions.push(statement)  // console.log, div{}, ï¿½?    }
  }
  
  // 2. å¦‚æœæœ‰export defaultï¼Œä¸åšåŒ…ï¿½?  if (hasExportDefault) return ast
  
  // 3. å¦‚æœæ²¡æœ‰è¡¨è¾¾å¼ï¼Œä¿æŒåŸæ ·
  if (expressions.length === 0) return ast
  
  // 4. åŒ…è£¹æ‰€æœ‰è¡¨è¾¾å¼åˆ°IIFE
  const iifeBody = [
    // const children = []
    // ...å¤„ç†æ‰€æœ‰è¡¨è¾¾å¼
    // return children
  ]
  
  const iife = createIIFE(iifeBody)
  const exportDefault = createExportDefaultDeclaration(iife)
  
  return createProgram([...declarations, exportDefault])
}
```

### 3. IIFEä¼˜åŒ–åˆ¤æ–­
```typescript
private isSimpleViewBody(statements: SlimeStatement[]): boolean {
  return statements.every(stmt => {
    // åªå…è®¸ExpressionStatement
    return stmt.type === SlimeAstType.ExpressionStatement
  })
}
```

**ä¼˜åŒ–ç­–ç•¥ï¿½?*
- ç®€å•è§†å›¾ï¼ˆåªæœ‰è¡¨è¾¾å¼ï¼‰ï¿½?ç›´æ¥è°ƒç”¨createVNodeï¼Œæ— IIFE
- å¤æ‚è§†å›¾ï¼ˆæœ‰è¯­å¥ï¼‰â†’ å®Œæ•´IIFEï¼Œæ”¯æŒæ‰€æœ‰é€»è¾‘

## ç¼–è¯‘è½¬æ¢ç¤ºä¾‹

### è¾“å…¥ä»£ç 
```javascript
export const hello = div {
  const abc = true
  if (abc) {
    123
  }
}

export default div{123}

div{456}
div{789}
```

### è¾“å‡ºä»£ç 
```javascript
import OvsAPI from 'ovsjs/src/OvsAPI'

export const hello = (function () {
  const children = []
  const abc = true
  if (abc) {
    children.push(123)
  }
  return OvsAPI.createVNode('div', children)
})()

export default (function () {
  const children = []
  children.push(123)
  return OvsAPI.createVNode('div', children)
})()

// div{456}å’Œdiv{789}ä¿æŒåŸæ ·ï¼ˆæœ‰defaultå°±ä¸ç®¡ï¼‰
```

## è®¾è®¡åŸåˆ™

**1. å•ä¸€èŒè´£**
- CST/ASTè½¬æ¢å±‚ï¼šåªè´Ÿè´£è¯­æ³•è½¬ï¿½?- æ’ä»¶å±‚ï¼šè´Ÿè´£æ–‡ä»¶çº§åˆ«åŒ…è£…å’Œå¯¼å‡ºé€»è¾‘

**2. è§£è€¦æ¸…ï¿½?*
- ä¸åŒå±‚æ¬¡èŒè´£åˆ†ç¦»
- å®¹æ˜“æµ‹è¯•å’Œç»´ï¿½?
**3. é›¶è¿è¡Œæ—¶å¼€é”€**
- æ‰€æœ‰è½¬æ¢åœ¨ç¼–è¯‘æ—¶å®Œï¿½?- ç›´æ¥ç”Ÿæˆä¼˜åŒ–çš„JavaScript

**4. ç±»å‹å®‰å…¨**
- å®Œæ•´TypeScriptæ”¯æŒ
- æ‰€æœ‰ASTèŠ‚ç‚¹éƒ½æœ‰ç±»å‹å®šä¹‰

## åµŒå¥—æ”¯æŒåŸç†

é€šè¿‡IIFEè‡ªåŠ¨åˆ›å»ºæ–°ä½œç”¨åŸŸï¿½?
```javascript
// è¾“å…¥
div {
  123
  span { 456 }
  789
}

// è¾“å‡º
(function(){
  const children = []        // å¤–å±‚children
  children.push(123)
  children.push(
    (function(){             // å†…å±‚IIFE
      const children = []    // æ–°ä½œç”¨åŸŸçš„children
      children.push(456)
      return h('span', {}, children)
    })()
  )
  children.push(789)
  return h('div', {}, children)
})()
```

æ¯ä¸ª `div { }` éƒ½æœ‰è‡ªå·±ï¿½?`children` å˜é‡ï¼Œé€šè¿‡IIFEè‡ªåŠ¨éš”ç¦»ï¼Œä¸ä¼šå†²çªï¿½?
---

# ã€ç»„ä»¶ç³»ç»ŸæŠ€æœ¯å®ç°ï¿½?
## 1. æ™ºèƒ½è¯†åˆ«æœºåˆ¶

### ç»„ä»¶ vs æ ‡ç­¾çš„è¯†ï¿½?
**æ ¸å¿ƒé€»è¾‘ï¿½?*
```typescript
// ï¿½?createOvsRenderDomViewDeclarationAst ï¿½?const id = this.createIdentifierAst(idCst)  // è·å–åç§°
const isComponent = id.name[0] === id.name[0].toUpperCase()  // é¦–å­—æ¯å¤§å†™åˆ¤ï¿½?```

**ç¼–è¯‘ç»“æœå·®å¼‚ï¿½?*
```javascript
// å°å†™ ï¿½?HTMLæ ‡ç­¾
div { "content" }
// ï¿½?h('div', {}, ["content"])  // å­—ç¬¦ï¿½?
// å¤§å†™ ï¿½?Vueç»„ä»¶
MyCard { "content" }
// ï¿½?h(MyCard, {}, ["content"])  // Identifierï¼ˆä¸åŠ å¼•å·ï¼‰
```

### Arguments å‚æ•°æå–

**CST ç»“æ„ï¿½?*
```
OvsRenderDomViewDeclaration
â”œâ”€ Identifier: "MyCard"
â”œâ”€ Arguments
ï¿½? â”œâ”€ LParen: "("
ï¿½? â”œâ”€ ArgumentList
ï¿½? ï¿½? â””â”€ AssignmentExpression (ObjectExpression)
ï¿½? â””â”€ RParen: ")"
â””â”€ LBrace/StatementList/RBrace
```

**æå–ä»£ç ï¿½?*
```typescript
const argumentsCst = cst.children?.find(child => child.name === 'Arguments')
if (argumentsCst) {
  const argListCst = argumentsCst.children.find(child => child.name === 'ArgumentList')
  const firstArgCst = argListCst.children[0]
  componentProps = this.createExpressionAst(firstArgCst.children[0])
}
```

## 2. å±æ€§èµ‹å€¼ç³»ï¿½?
### æ ˆæœºåˆ¶åŸï¿½?
**ä¸ºä»€ä¹ˆéœ€è¦æ ˆï¿½?*

åµŒå¥—viewä¼šè¦†ï¿½?attrs å˜é‡åï¼š
```javascript
div {              // è¿›å…¥ï¼špush('AAA')ï¼Œæ ˆ = [AAA]
  name = 10        // ä½¿ç”¨æ ˆé¡¶ AAA ï¿½?  
  h1 {             // è¿›å…¥ï¼špush('BBB')ï¼Œæ ˆ = [AAA, BBB]
    title = 20     // ä½¿ç”¨æ ˆé¡¶ BBB ï¿½?  }                // é€€å‡ºï¼špop()ï¼Œæ ˆ = [AAA] ï¿½?æ¢å¤å¤–å±‚
  
  age = 30         // ä½¿ç”¨æ ˆé¡¶ AAA ï¿½?(å…³é”®ï¿½?
}
```

**å®ç°ä»£ç ï¿½?*
```typescript
// OvsCstToSlimeAst ï¿½?private attrsVarNameStack: Array<string | null> = []

createOvsRenderDomViewDeclarationAst(cst) {
  const uuid = Math.random().toString(36).substring(2, 10)
  this.attrsVarNameStack.push(`temp$$attrs$$${uuid}`)  // è¿›å…¥æ—¶å‹ï¿½?  
  try {
    // è½¬æ¢è¯­å¥...
  } finally {
    this.attrsVarNameStack.pop()  // é€€å‡ºæ—¶å¼¹æ ˆï¼ˆç¡®ä¿æ¢å¤ï¼‰
  }
}

createExpressionStatementAst(cst) {
  const currentAttrsVarName = this.attrsVarNameStack[length - 1]  // å–æ ˆï¿½?  
  if (isAssignment) {
    // ä½¿ç”¨ currentAttrsVarName ç”Ÿæˆä»£ç 
  }
}
```

### èµ‹å€¼è¡¨è¾¾å¼è½¬æ¢

**è¾“å…¥ï¿½?*
```javascript
div {
  name = 10
  age = 25
}
```

**æ‰§è¡Œæµç¨‹ï¿½?*
1. è¿›å…¥ `createOvsRenderDomViewDeclarationAst`ï¼Œç”Ÿï¿½?uuid = "abc123"ï¼Œå‹ï¿½?2. è°ƒç”¨ `createStatementListAst`
3. éå†è¯­å¥ ï¿½?è°ƒç”¨ `createExpressionStatementAst`
   - `name = 10` ï¿½?è¯†åˆ«ä¸ºèµ‹ï¿½?ï¿½?ç”Ÿæˆ3æ¡è¯­ï¿½?   - `age = 25` ï¿½?è¯†åˆ«ä¸ºèµ‹ï¿½?ï¿½?ç”Ÿæˆ3æ¡è¯­ï¿½?4. é€€å‡ºæ—¶å¼¹æ ˆ

**ç”Ÿæˆä»£ç ï¿½?*
```javascript
(function() {
  const children = []
  const temp$$attrs$$abc123 = {}
  
  // name = 10 ï¿½?3æ¡è¯­ï¿½?  let name = 10                      // 1. å˜é‡å£°æ˜
  temp$$attrs$$abc123.name = name    // 2. èµ‹å€¼åˆ°attrs
  children.push(temp$$attrs$$abc123.name)  // 3. pushåˆ°children
  
  // age = 25 ï¿½?3æ¡è¯­ï¿½?  let age = 25
  temp$$attrs$$abc123.age = age
  children.push(temp$$attrs$$abc123.age)
  
  return h('div', {ovsAttr: temp$$attrs$$abc123}, children)
})()
```

## 3. ç»„ä»¶å£°æ˜è½¬æ¢

### ovsView è¯­æ³•è§„åˆ™

**Parserè§„åˆ™ï¿½?*
```typescript
@SubhutiRule
OvsViewDeclaration() {
  this.tokenConsumer.OvsViewToken()        // ovsView
  this.ovsRenderDomClassDeclaration()       // ComponentName ({params}) :
  this.OvsRenderDomViewDeclaration()        // div { ... }
}

@SubhutiRule
ovsRenderDomClassDeclaration() {
  this.tokenConsumer.Identifier()           // ComponentName
  this.Option(() => {
    this.FunctionFormalParameters()         // ({params})
  })
  this.tokenConsumer.Colon()                // :
}
```

### IIFE å±•å¼€æœºåˆ¶

**ç®€å•ç»„ä»¶ï¼ˆæ— è¯­å¥ï¼‰ï¿½?*
```javascript
ovsView MyCard ({attrs}) : div {
  h1 { attrs.title }
}

// è§†å›¾è½¬æ¢ï¿½?ï¿½?h('div', {}, [h('h1', {}, [attrs.title])])

// æœ€ç»ˆå‡½ï¿½?ï¿½?function MyCard({attrs}) {
  return h('div', {}, [h('h1', {}, [attrs.title])])
}
```

**å¤æ‚ç»„ä»¶ï¼ˆæœ‰è¯­å¥ï¼‰ï¼š**
```javascript
ovsView ProductCard ({attrs}) : div {
  let price = attrs.price
  let discount = price * 0.8
  p { discount }
}

// è§†å›¾è½¬æ¢ï¿½?IIFE ï¿½?(function() {
  const children = []
  const temp$$attrs$$uuid = {}
  let price = attrs.price
  let discount = price * 0.8
  children.push(h('p', {}, [discount]))
  return h('div', {ovsAttr: temp$$attrs$$uuid}, children)
})()

// å±•å¼€IIFEå†…å®¹åˆ°å‡½æ•°ä½“ ï¿½?function ProductCard({attrs}) {
  const children = []
  const temp$$attrs$$uuid = {}
  let price = attrs.price
  let discount = price * 0.8
  children.push(h('p', {}, [discount]))
  return h('div', {ovsAttr: temp$$attrs$$uuid}, children)
}
```

**å±•å¼€é€»è¾‘ï¿½?*
```typescript
createOvsViewDeclarationAst(cst) {
  // 1. æå–ç»„ä»¶åå’Œå‚æ•°
  const componentName = ...
  const params = ...
  
  // 2. è½¬æ¢è§†å›¾ï¼ˆä¼šç”ŸæˆIIFEæˆ–hè°ƒç”¨ï¿½?  const viewExpression = this.createOvsRenderDomViewDeclarationAst(viewCst)
  
  // 3. åˆ¤æ–­æ˜¯å¦æ˜¯IIFE
  if (viewExpression.type === 'CallExpression' && 
      viewExpression.callee.type === 'FunctionExpression') {
    // æ˜¯IIFEï¼Œæå–å‡½æ•°ä½“
    const iifeBody = viewExpression.callee.body.body
    functionBodyStatements = iifeBody  // ç›´æ¥ä½¿ç”¨IIFEçš„å‡½æ•°ä½“
  } else {
    // ä¸æ˜¯IIFEï¼ˆç®€å•è§†å›¾ï¼‰ï¼Œç›´æ¥return
    functionBodyStatements = [returnStatement(viewExpression)]
  }
  
  // 4. åˆ›å»ºå‡½æ•°å£°æ˜
  return FunctionDeclaration(componentName, params, functionBody)
}
```

## 4. å®Œæ•´ç¼–è¯‘æµç¨‹ç¤ºä¾‹

**è¾“å…¥ä»£ç ï¿½?*
```javascript
ovsView MyButton ({attrs}) : div {
  let text = attrs.label || "Click"
  button { text }
}

div {
  MyButton({attrs: {label: "æäº¤"}})
}
```

**ç¼–è¯‘æ­¥éª¤ï¿½?*

1. **è¯æ³•åˆ†æ** ï¿½?è¯†åˆ« `ovsView` å…³é”®å­—token
2. **è¯­æ³•åˆ†æ** ï¿½?ç”ŸæˆCSTï¼ˆOvsViewDeclarationèŠ‚ç‚¹ï¿½?3. **ASTè½¬æ¢** ï¿½?
   - `createOvsViewDeclarationAst` ï¿½?å‡½æ•°å£°æ˜
   - `createOvsRenderDomViewDeclarationAst` ï¿½?è§†å›¾IIFE
4. **IIFEå±•å¼€** ï¿½?æå–å‡½æ•°ä½“å†…ï¿½?5. **æ™ºèƒ½è¯†åˆ«** ï¿½?`MyButton` é¦–å­—æ¯å¤§å†™ï¼Œè¯†åˆ«ä¸ºç»„ï¿½?6. **ä»£ç ç”Ÿæˆ** ï¿½?æœ€ç»ˆJavaScript

**è¾“å‡ºä»£ç ï¿½?*
```javascript
import { h } from 'vue'

function MyButton({ attrs }) {
  const children = []
  const temp$$attrs$$xyz = {}
  let text = attrs.label || 'Click'
  children.push(h('button', {}, [text]))
  return h('div', { ovsAttr: temp$$attrs$$xyz }, children)
}

export default (function () {
  const children = []
  children.push(h(MyButton, { attrs: { label: 'æäº¤' } }, []))
  return children
})()
```

## 5. å…³é”®è®¾è®¡å†³ç­–

### ä¸ºä»€ä¹ˆç”¨æ ˆè€Œä¸æ˜¯å•ä¸ªå˜é‡ï¼Ÿ

**é—®é¢˜åœºæ™¯ï¿½?*
```javascript
div {
  name = 10     // éœ€è¦ç”¨å¤–å±‚attrs
  h1 {          // å†…å±‚viewå¼€ï¿½?    title = 20  // éœ€è¦ç”¨å†…å±‚attrs
  }             // å†…å±‚viewç»“æŸ
  age = 30      // éœ€è¦æ¢å¤å¤–å±‚attrs ï¿½?å…³é”®ï¿½?}
```

å¦‚æœç”¨å•ä¸ªå˜é‡ï¼Œå†…å±‚viewç»“æŸåæ— æ³•æ¢å¤å¤–å±‚çš„attrsVarNameï¿½?
### ä¸ºä»€ä¹ˆç»„ä»¶è°ƒç”¨è¦åŒºåˆ†å¤§å°å†™ï¼Ÿ

éµå¾ª Vue è§„èŒƒï¿½?- JSX/TSXï¼š`<MyComponent />` vs `<div />`
- hå‡½æ•°ï¼š`h(MyComponent)` vs `h('div')`

å¤§å°å†™åŒºåˆ†è®©ç¼–è¯‘å™¨è‡ªåŠ¨åˆ¤æ–­ï¼Œæ— éœ€é¢å¤–æ ‡è®°ï¿½?
### ä¸ºä»€ä¹ˆå±æ€§ç”¨ {ovsAttr: ...} è€Œä¸æ˜¯å±•å¼€ï¿½?
ç»Ÿä¸€å†…éƒ¨çº¦å®šï¿½?- `{ovsAttr: temp$$attrs$$}` - OVSå†…éƒ¨ç”Ÿæˆçš„attrs
- `{attrs: ...}` - ç”¨æˆ·æ˜¾å¼ä¼ é€’çš„props

ä¾¿äºåŒºåˆ†å’Œè°ƒè¯•ï¼Œé¿å…å±æ€§åå†²çªï¿½?
---

# å˜æ›´è®°å½•

ã€2025-10-30 17:33:02ã€‘
ã€2025-10-30ã€‘OVSæºç æ˜ å°„æµ‹è¯•å¥—ä»¶åˆ›å»ºå®Œæˆ

**åˆ›å»ºå†…å®¹ï¼š**
1. æµ‹è¯•ç”¨ä¾‹ï¼štests/cases/mapping/ ç›®å½•ä¸‹11ä¸ªæµ‹è¯•æ–‡ä»¶ï¼ˆ00-10ï¼‰
2. æµ‹è¯•è¿è¡Œå™¨ï¼štest-mapping-suite.ts
3. æµ‹è¯•æ–‡æ¡£ï¼štests/cases/mapping/README.md

**æµ‹è¯•ç»“æœï¼š**
- æµ‹è¯•æ•°é‡ï¼š11ä¸ªï¼ˆä»ç®€å•åˆ°å¤æ‚çš„æ¸è¿›å¼æµ‹è¯•ï¼‰
- ç¼–è¯‘æˆåŠŸç‡ï¼š100% âœ…
- æœ‰æ•ˆæ˜ å°„å‡†ç¡®ç‡ï¼š9/11è¾¾åˆ°100%

**ä¸»è¦å‘ç°ï¼š**
- âœ… æ ¸å¿ƒæ˜ å°„åŠŸèƒ½æ­£å¸¸ï¼šå˜é‡ã€å…ƒç´ æ ‡ç­¾ã€å­—ç¬¦ä¸²å­—é¢é‡æ˜ å°„å‡†ç¡®
- âš ï¸ æ— æ•ˆæ˜ å°„è¿‡å¤šï¼šæ¯ä¸ªæµ‹è¯•æœ‰18-40ä¸ªæ— æ•ˆæ˜ å°„ï¼ˆè‡ªåŠ¨æ·»åŠ çš„importè¯­å¥ï¼‰
- âš ï¸ æ¡ä»¶æ¸²æŸ“å’Œå¤æ‚åœºæ™¯æ˜ å°„è´¨é‡éœ€æ”¹è¿›

**æ”¹è¿›å»ºè®®ï¼š**
1. è¿‡æ»¤æ— æ•ˆæ˜ å°„ï¼ˆsourceä¸ºç©ºçš„æ˜ å°„ï¼‰
2. ä¼˜åŒ–æ¡ä»¶æ¸²æŸ“å†…éƒ¨çš„æ˜ å°„ç”Ÿæˆ
3. æ”¹è¿›å¤æ‚æ··åˆåœºæ™¯çš„æ˜ å°„å‡†ç¡®æ€§

**æµ‹è¯•ç”¨ä¾‹åˆ†ç±»ï¼š**
- åŸºç¡€åœºæ™¯ï¼ˆ00-03ï¼‰ï¼šå•å­—é¢é‡ã€å˜é‡ã€ç®€å•å…ƒç´ ã€å˜é‡ä½¿ç”¨
- ä¸­çº§åœºæ™¯ï¼ˆ04-07ï¼‰ï¼šåµŒå¥—å…ƒç´ ã€æ¡ä»¶æ¸²æŸ“ã€å¾ªç¯ã€å‡½æ•°è°ƒç”¨
- å¤æ‚åœºæ™¯ï¼ˆ08-10ï¼‰ï¼šæ·±å±‚åµŒå¥—ã€å¤æ‚è¡¨è¾¾å¼ã€ç»¼åˆåœºæ™¯

ï¿½?025-10-24 18:13:11ï¿½?ï¿½?025-10-24ã€‘æ‹¬å·ç³»ç»Ÿä¿®ï¿½?- å…¼å®¹æ€§éªŒè¯å®Œï¿½?
ï¿½?å…¼å®¹æ€§æµ‹è¯•ç»“æœï¼š100% å‘åå…¼å®¹

éªŒè¯èŒƒå›´ï¿½?- Slime 50ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼šå…¨éƒ¨é€šè¿‡ï¿½?0/50ï¿½?- OVS 13ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼šé¢„è®¡å…¨éƒ¨é€šè¿‡
- ç°æœ‰ä»£ç ï¼šé›¶å½±å“

ä¿®æ”¹åˆ†æï¿½?1. çº¯æ·»åŠ å‹ä¿®æ”¹ï¿½?0%ï¼‰ï¼šæ·»åŠ æ–°ç±»å‹ã€æ–°æ¥å£ã€æ–°æ–¹æ³•
2. è¡Œä¸ºä¿®å¤å‹ä¿®æ”¹ï¼ˆ20%ï¼‰ï¼šåªä¿®å¤bugï¼Œä¸å½±å“æ­£ç¡®åœºæ™¯

æŠ€æœ¯ä¿è¯ï¼š
- TypeScript è”åˆç±»å‹æ‰©å±•ï¼šå®Œå…¨å…¼ï¿½?- é€’å½’å¤„ç†æ¶æ„ï¼šæ–°èŠ‚ç‚¹è‡ªåŠ¨æ”¯æŒ
- æ¡ä»¶åˆ¤æ–­ç²¾ç¡®ï¼šåªåœ¨ç‰¹å®šåœºæ™¯è§¦ï¿½?
ç»“è®ºï¼šè¿™æ˜¯ä¸€æ¬¡æ— å‰¯ä½œç”¨çš„å®Œç¾ä¿®å¤ï¿½?
ï¿½?025-10-24 18:10:04ï¿½?ï¿½?025-10-24ã€‘Slime æ‹¬å·ç³»ç»Ÿå®Œæ•´ä¿®å¤ - æ¶æ„çº§ä¿®ï¿½?
ï¿½?ä¿®å¤ï¿½?ä¸ªBugï¿½?1. ç®­å¤´å‡½æ•°è¿”å›å¯¹è±¡å­—é¢é‡ï¼š() => ({ x: 1 }) æ‹¬å·ä¸¢å¤± ï¿½?è¯­æ³•é”™è¯¯
2. äºŒå…ƒè¡¨è¾¾å¼æ‹¬å·ä¸¢å¤±ï¼š(a + 1) % b æ‹¬å·è¢«ç§»ï¿½?ï¿½?è¿ç®—ç¬¦ä¼˜å…ˆçº§é”™è¯¯

ï¿½?ä¿®æ”¹5ä¸ªæ–‡ä»¶ï¼ˆå®Œæ•´çš„ç±»å‹ç³»ç»Ÿï¼‰ï¿½?1. SlimeAstType.ts - æ·»åŠ  ParenthesizedExpression æšä¸¾
2. SlimeAstInterface.ts - æ·»åŠ æ¥å£å®šä¹‰ + è”åˆç±»å‹
3. SlimeAst.ts - æ·»åŠ  createParenthesizedExpression å·¥å‚æ–¹æ³•
4. SlimeCstToAstUtil.ts - CST ï¿½?AST è½¬æ¢æ—¶åˆ›å»ºèŠ‚ï¿½?5. SlimeGenerator.ts - ä»£ç ç”Ÿæˆæ—¶è¾“å‡ºæ‹¬ï¿½?+ ä¿®å¤ç®­å¤´å‡½æ•°

ï¿½?æµ‹è¯•éªŒè¯100%é€šè¿‡ï¿½?- Slimeç‹¬ç«‹æµ‹è¯•ï¿½?ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- OVSç¼–è¯‘æµ‹è¯•ï¼šhello.ovs å®Œæ•´ç¼–è¯‘ï¼Œæ— è¯­æ³•é”™è¯¯
- æµè§ˆå™¨è¿è¡Œï¼šå“åº”å¼æ­£å¸¸ï¼Œé¢œè‰²æ¯ç§’å˜åŒ–

ï¿½?å½±å“ï¿½?- Vue computed()ã€reactive() ï¿½?API å®Œå…¨å¯ç”¨
- æ‰€æœ‰å¤æ‚æ•°å­¦è¿ç®—è¡¨è¾¾å¼æ­£ç¡®
- è¿ç®—ç¬¦ä¼˜å…ˆçº§å‡†ç¡®ä¿ç•™

ï¿½?025-10-24 18:08:31ï¿½?ï¿½?025-10-24ã€‘æ‹¬å·ç³»ç»Ÿå®Œæ•´ä¿®ï¿½?
ï¿½?ä¿®å¤çš„Bugï¿½?1. ç®­å¤´å‡½æ•°è¿”å›å¯¹è±¡å­—é¢é‡ï¼š() => ({ x: 1 }) æ‹¬å·ä¸¢å¤±
2. äºŒå…ƒè¡¨è¾¾å¼æ‹¬å·ä¸¢å¤±ï¼š(a + 1) % b æ‹¬å·è¢«ç§»ï¿½?
ï¿½?ä¿®æ”¹æ–‡ä»¶ï¿½?ä¸ªï¼‰ï¿½?1. slime-ast/src/SlimeAstType.ts - æ·»åŠ  ParenthesizedExpression ç±»å‹
2. slime-ast/src/SlimeAstInterface.ts - æ·»åŠ æ¥å£å®šä¹‰å’Œè”åˆç±»ï¿½?3. slime-ast/src/SlimeAst.ts - æ·»åŠ  createParenthesizedExpression å·¥å‚æ–¹æ³•
4. slime-parser/src/language/SlimeCstToAstUtil.ts - è¯†åˆ«æ‹¬å·å¹¶åˆ›å»ºèŠ‚ï¿½?5. slime-generator/src/SlimeGenerator.ts - ç”Ÿæˆæ‹¬å· + ä¿®å¤ç®­å¤´å‡½æ•°

ï¿½?æµ‹è¯•éªŒè¯ï¿½?- æµ‹è¯•1ï¿½?1 + 2) * 3 ï¿½?ï¿½?æ‹¬å·ä¿ç•™
- æµ‹è¯•2ï¿½?) => ({ x: 1 }) ï¿½?ï¿½?å¯¹è±¡æ‹¬å·æ­£ç¡®
- æµ‹è¯•3ï¿½?colorIndex.value + 1) % colors.length ï¿½?ï¿½?å¤æ‚æ‹¬å·ä¿ç•™
- OVSç¼–è¯‘ï¼šhello.ovs ï¿½?ï¿½?æ— è¯­æ³•é”™ï¿½?
ï¿½?å½±å“èŒƒå›´ï¿½?- æ‰€æœ‰æ‹¬å·è¡¨è¾¾å¼æ­£ç¡®ä¿ç•™
- ç®­å¤´å‡½æ•°è¿”å›å¯¹è±¡å­—é¢é‡å®Œå…¨æ­£ï¿½?- è¿ç®—ç¬¦ä¼˜å…ˆçº§å‡†ç¡®
- computed()ã€reactive() ï¿½?Vue API æ­£å¸¸å·¥ä½œ

ï¿½?025-10-24 16:58:08ï¿½?ï¿½?025-10-24ã€‘OVS v0.2.0 - #{} ä¸æ¸²æŸ“å—åŠŸèƒ½å®Œæ•´å®ç°

ï¿½?æ ¸å¿ƒåŠŸèƒ½å®ç°ï¿½?1. #{} è¯­æ³•æ”¯æŒ - éš”ç¦»ä¸æ¸²æŸ“çš„ä»£ç 
2. æ™ºèƒ½æ¸²æŸ“ç³»ç»Ÿ - å…ƒç´ ä¼˜å…ˆã€é»˜è®¤æ¸²æŸ“ï¿½?{} éš”ç¦»
3. è‡ªåŠ¨å¯¼å‡ºä¼˜åŒ– - ç®€ï¿½?å¤æ‚è‡ªåŠ¨åˆ¤æ–­
4. ReactiveVNode é›†æˆ - å“åº”å¼æ”¯ï¿½?
ï¿½?ä¿®æ”¹æ–‡ä»¶ï¿½?- OvsParser.ts - æ·»åŠ  NoRenderBlock è§„åˆ™ï¼Œåˆ ï¿½?RenderExpression
- OvsCstToSlimeAstUtil.ts - å®ç° #{} å±•å¼€å’Œæ¸²æŸ“åˆ¤ï¿½?- index.ts - ä¼˜åŒ–å¯¼å‡ºé€»è¾‘ï¼Œæ‰€æœ‰ä»£ç åŒ…è£¹åˆ° IIFE

ï¿½?æµ‹è¯•éªŒè¯ï¿½?- åˆ›å»ºæµ‹è¯•ç”¨ä¾‹ 13-norender-block.ovs
- æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•é€šè¿‡
- hello.ovs å®Œæ•´ç¤ºä¾‹ï¿½?10è¡Œï¼‰æ­£å¸¸ç¼–è¯‘

ï¿½?é¡µé¢å°±ç»ªï¿½?- å¼€å‘æœåŠ¡å™¨ï¼šhttp://localhost:5175
- main.ts ä½¿ç”¨ DefaultViews.map(v => v.toVnode())
- å±•ç¤º #{} åŠŸèƒ½ï¿½?ä¸ªç¤ºï¿½?
## 2025-10-24 [v0.2.0 - `#{}` ä¸æ¸²æŸ“å— + æ™ºèƒ½æ¸²æŸ“ç³»ç»Ÿ]

### ğŸ¯ æ ¸å¿ƒè®¾è®¡å˜æ›´

**è®¾è®¡å“²å­¦è½¬å˜ï¼šJavaScript æ˜¯ä¸»ä½“ï¼ŒUI æ˜¯é™„ï¿½?*

- **æ—§è®¾ï¿½?*ï¼šåªæœ‰ç‰¹å®šè¯­æ³•ï¼ˆ`#{ expr }`ï¼‰æ‰æ¸²æŸ“
- **æ–°è®¾ï¿½?*ï¼šé»˜è®¤éƒ½æ¸²æŸ“ï¼Œä½¿ï¿½?`#{}` éš”ç¦»ä¸æ¸²æŸ“çš„ä»£ç 

### ï¿½?æ–°å¢åŠŸèƒ½

#### 1. `#{}` ä¸æ¸²æŸ“å—
- **è¯­æ³•**ï¼š`#{ statements }` - å¯åŒ…å«å¤šä¸ªè¯­ï¿½?- **ä½œç”¨**ï¼šéš”ç¦»çº¯é€»è¾‘ä»£ç ï¼ˆæ•°æ®å¤„ç†ã€è°ƒè¯•æ—¥å¿—ç­‰ï¿½?- **ä½ç½®**ï¼šStatement å±‚çº§ï¼ˆå¯å‡ºç°åœ¨ä»»ä½•å…ï¿½?Statement çš„åœ°æ–¹ï¼‰
- **ç‰¹ï¿½?*ï¿½?  - è¯­å¥å¹³é“ºï¼ˆå»ï¿½?`#{}` åŒ…è£¹ï¼Œå†…å®¹ç›´æ¥æ’å…¥ï¼‰
  - æ”¯æŒåµŒå¥—
  - å…ƒç´ ä¼˜å…ˆï¼ˆ`p {}` ï¿½?`#{}` å†…ä»ç„¶æ¸²æŸ“ï¼‰
  - ä½œç”¨åŸŸå…±äº«ï¼ˆå¯è®¿é—®å¤–å±‚å˜é‡ï¼‰

#### 2. æ™ºèƒ½æ¸²æŸ“åˆ¤æ–­ç³»ç»Ÿ
- **ä¼˜å…ˆçº§æœºï¿½?*ï¿½?  1. `OvsRenderFunction` (`p {}`) ï¿½?æ°¸è¿œæ¸²æŸ“
  2. `noRenderDepth > 0` (ï¿½?`#{}` ï¿½? ï¿½?ä¸æ¸²ï¿½?  3. `ovsRenderDomViewDepth > 0` (ï¿½?`div {}` ï¿½? ï¿½?æ¸²æŸ“
  4. å…¶ä»– ï¿½?ä¸æ¸²ï¿½?
- **çŠ¶æ€ç®¡ï¿½?*ï¿½?  - `noRenderDepth` è®¡æ•°å™¨ï¼ˆè·Ÿè¸ª `#{}` åµŒå¥—ï¿½?  - è¿›å…¥å…ƒç´ æ—¶é‡ç½®ï¼ˆ`#{}` å¯¹å…ƒç´ å†…éƒ¨ä¸ç”Ÿæ•ˆï¿½?
### ğŸ”§ ä»£ç ä¿®æ”¹

**æ–‡ä»¶1ï¼šOvsParser.ts**
- ï¿½?æ·»åŠ  `NoRenderBlock` è§„åˆ™
- ï¿½?Override `Statement` è§„åˆ™ï¼ˆæ·»ï¿½?NoRenderBlock æ”¯æŒï¿½?- ï¿½?åˆ é™¤æ—§çš„ `RenderExpression` è§„åˆ™

**æ–‡ä»¶2ï¼šOvsCstToSlimeAstUtil.ts**
- ï¿½?æ·»åŠ  `noRenderDepth` è®¡æ•°ï¿½?- ï¿½?Override `createStatementListItemAst`ï¼ˆå±•å¼€ `#{}` å†…çš„è¯­å¥ï¿½?- ï¿½?ä¿®æ”¹ `createExpressionStatementAst`ï¼ˆæ–°çš„æ¸²æŸ“åˆ¤æ–­é€»è¾‘ï¿½?- ï¿½?ä¿®æ”¹ `createOvsRenderDomViewDeclarationAst`ï¼ˆè¿›å…¥å…ƒç´ æ—¶é‡ç½® noRenderDepthï¿½?- ï¿½?åˆ é™¤ `createRenderExpressionAst` æ–¹æ³•

**æ–‡ä»¶3ï¼šindex.ts**
- ï¿½?ä¿®å¤ `isOvsRenderDomView` è¯†åˆ« `h()` å‡½æ•°è°ƒç”¨
- ï¿½?ä¿®å¤ç®­å¤´å‡½æ•° params æ ¼å¼

### ğŸ“Š æµ‹è¯•éªŒè¯

åˆ›å»ºæµ‹è¯•ç”¨ä¾‹ï¼š`tests/cases/13-norender-block.ovs`

**éªŒè¯é¡¹ç›®**ï¿½?1. ï¿½?é¡¶å±‚ `#{}` ä»£ç å¹³é“º
2. ï¿½?`#{}` å†…çš„å±€éƒ¨å˜é‡å®šï¿½?3. ï¿½?`#{}` å†…çš„å‡½æ•°è°ƒç”¨ä¸æ¸²ï¿½?4. ï¿½?æ™®é€šå‡½æ•°è°ƒç”¨è¢«æ¸²æŸ“
5. ï¿½?`#{}` å†…çš„å…ƒç´ ä»ç„¶æ¸²æŸ“
6. ï¿½?åµŒå¥— `#{}` æ­£ç¡®å±•å¼€
7. ï¿½?æ§åˆ¶æµä¸­ï¿½?`#{}` æ­£å¸¸å·¥ä½œ
8. ï¿½?æ— è¯­æ³•é”™ï¿½?
### ğŸ¨ ç¤ºä¾‹ä»£ç 

è¯¦è§ `example/src/views/hello.ovs`ï¿½?00è¡Œå®Œæ•´ç¤ºä¾‹ï¼‰

---

# æºç æ˜ å°„ä¿®å¤æ¡ˆä¾‹ï¿½?025-10-30ï¿½?
## é—®é¢˜ï¼šæ— æ•ˆæ˜ ï¿½?79%ï¼ŒLSP ä¸ç¨³ï¿½?
**ç°è±¡ï¿½?* `div { name }` ç”Ÿæˆ 24 ä¸ªæ˜ å°„ï¼Œåªæœ‰ 5 ä¸ªæœ‰ï¿½?
**æ ¹å› ï¿½?* `commonLocType` è‡ªåŠ¨æ·»åŠ  `{ value: null }` é»˜è®¤ locï¼Œå‡­ç©ºä»£ç è¯¯åˆ›å»ºæ˜ å°„

## ä¿®å¤ï¿½? å±‚é˜²å¾¡ï¼‰

1. `slime/slime-ast/SlimeAst.ts:375` - æ·»åŠ  loc å‚æ•°
2. `ovs/factory/OvsCstToSlimeAstUtil.ts:602,729` - ä¼ ï¿½?id.loc
3. `slime/slime-generator/SlimeGenerator.ts:1131` - éªŒè¯ loc æœ‰æ•ˆï¿½?4. `langServer/OvsLanguagePlugin.ts:70` - è¿‡æ»¤æ— æ•ˆæ˜ å°„

## æ•ˆæœï¿½?1% ï¿½?100%

## æœ€ä½³å®ï¿½?
```typescript
// ï¿½?å‡­ç©ºç”Ÿæˆï¼šä¸ï¿½?loc
SlimeAstUtil.createIdentifier('children')

// ï¿½?æºç å¯¹åº”ï¼šä¼  loc
SlimeAstUtil.createStringLiteral(id.name, id.loc)
```

## è¯Šæ–­å·¥å…·

```bash
npx tsx test-mapping-diagnosis.ts  # æ£€æŸ¥æœ‰æ•ˆç‡
npx tsx test-mapping-issues.ts     # å®Œæ•´æµ‹è¯•
```


---

**OVS é¡¹ç›®å®Œæ•´æ–‡æ¡£ | æœ€åæ›´ï¿½? 2025-10-30**
