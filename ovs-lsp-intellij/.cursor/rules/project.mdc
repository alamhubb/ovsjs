---
description: OVS IntelliJ IDEA æ’ä»¶ - LSP å®¢æˆ·ç«¯å®ç°
alwaysApply: true
---

# OVS IntelliJ IDEA æ’ä»¶

## é¡¹ç›®å®šä½
ä¸º OVS (Object-oriented View Syntax) è¯­è¨€æä¾› IntelliJ IDEA çš„å®Œæ•´ IDE æ”¯æŒï¼Œä½œä¸º LSP å®¢æˆ·ç«¯è¿æ¥åˆ° OVS è¯­è¨€æœåŠ¡å™¨ã€‚

**æ ¸å¿ƒä»·å€¼ï¼š**
- å®Œæ•´çš„ ES6 è¯­æ³•é«˜äº®ï¼ˆåŸºäº JFlexï¼‰
- LSP è¯­ä¹‰é«˜äº®ï¼ˆSemantic Tokensï¼‰
- ä»£ç è¡¥å…¨ã€è·³è½¬ã€è¯Šæ–­ï¼ˆé€šè¿‡ LSPï¼‰
- ä¸ IntelliJ å¹³å°æ·±åº¦é›†æˆ

## å½“å‰é˜¶æ®µ
STAGE_3_INTEGRATION

## å½“å‰çŠ¶æ€
- âœ… æ–‡ä»¶ç±»å‹æ³¨å†Œï¼š.ovs æ–‡ä»¶è¯†åˆ«
- âœ… è¯­æ³•é«˜äº®ï¼šå®Œæ•´ ES6 æ”¯æŒï¼ˆåŸºäº JFlexï¼Œ230è¡Œè¯æ³•è§„åˆ™ï¼‰
- âœ… LSP å®¢æˆ·ç«¯ï¼šè¿æ¥åˆ°è¯­è¨€æœåŠ¡å™¨
- âœ… Semantic Tokensï¼šå®Œæ•´æ”¯æŒï¼ˆå·²éªŒè¯ï¼‰
- âœ… ä»£ç è¡¥å…¨ï¼šå®Œæ•´æ”¯æŒï¼ˆå·²éªŒè¯ï¼‰
- âš ï¸ Inlay Hintsï¼šç­‰å¾… IntelliJ API æ”¯æŒï¼ˆè§ä¸‹æ–¹è¯´æ˜ï¼‰
- ç‰ˆæœ¬ï¼š1.0-SNAPSHOT
- æŠ€æœ¯æ ˆï¼šKotlin + JFlex + IntelliJ Platform 2025.2.1
- Gradleç‰ˆæœ¬ï¼š8.13

## LSP åŠŸèƒ½æ”¯æŒæƒ…å†µ

### âœ… å·²æ”¯æŒå¹¶éªŒè¯ï¼ˆ2025-10-29ï¼‰

| LSP åŠŸèƒ½ | æœåŠ¡ç«¯ | IntelliJ å®¢æˆ·ç«¯ | çŠ¶æ€ |
|---------|--------|----------------|------|
| **Semantic Tokens** | âœ… | âœ… | ğŸ‰ **æ­£å¸¸å·¥ä½œ** |
| **Code Completion** | âœ… | âœ… | ğŸ‰ **æ­£å¸¸å·¥ä½œ** |
| **Diagnostics** | âœ… | âœ… | ğŸ‰ **æ­£å¸¸å·¥ä½œ** |
| **Go to Definition** | âœ… | âœ… | ğŸ‰ **æ­£å¸¸å·¥ä½œ** |
| **Hover** | âœ… | âœ… | ğŸ‰ **æ­£å¸¸å·¥ä½œ** |
| **Formatting** | âœ… | âœ… | ğŸ‰ **æ­£å¸¸å·¥ä½œ** |

### âŒ æš‚ä¸æ”¯æŒï¼ˆIntelliJ API é™åˆ¶ï¼‰

| LSP åŠŸèƒ½ | æœåŠ¡ç«¯ | IntelliJ å®¢æˆ·ç«¯ | åŸå›  |
|---------|--------|----------------|------|
| **Inlay Hints** | âœ… | âŒ | IntelliJ 2025.2.1 æ—  `LspInlayHintCustomizer` |

**æµ‹è¯•ç»“è®º**ï¼š
- âœ… æœåŠ¡ç«¯å®Œæ•´å£°æ˜ï¼š`"inlayHintProvider": {}`
- âœ… å®¢æˆ·ç«¯æ¥æ”¶èƒ½åŠ›ï¼šIntelliJ æ”¶åˆ° capabilities
- âŒ å®¢æˆ·ç«¯ä¸å‘è¯·æ±‚ï¼šæœªå‘é€ `textDocument/inlayHint`
- ğŸ“ æ›¿ä»£æ–¹æ¡ˆï¼šå·²è®°å½•æ–¹æ¡ˆBï¼ˆ`INLAY_HINTS_PLAN_B.md`ï¼‰
- â³ ç­‰å¾…å®˜æ–¹æ”¯æŒï¼šé¢„è®¡ 6-12 ä¸ªæœˆ

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. âœ… ~~ä¿®å¤ Semantic Tokens è§¦å‘é—®é¢˜~~ - å·²å®Œæˆ
2. ğŸ”„ å®Œå–„ä»£ç è¡¥å…¨åŠŸèƒ½ï¼ˆä¼˜åŒ–è§¦å‘æ¡ä»¶ï¼‰
3. ğŸ”„ æ·»åŠ é”™è¯¯è¯Šæ–­æ˜¾ç¤ºä¼˜åŒ–
4. â³ ç­‰å¾… IntelliJ æ·»åŠ  Inlay Hints æ”¯æŒ
5. ğŸ“ ç¼–å†™ç”¨æˆ·æ–‡æ¡£å’Œç¤ºä¾‹

---

# ã€æ ¸å¿ƒéœ€æ±‚å±‚ã€‘

## æ ¸å¿ƒåŠŸèƒ½ï¼ˆç”¨æˆ·èƒ½åšä»€ä¹ˆï¼‰

### IDE åŠŸèƒ½
- **è¯­æ³•é«˜äº®**ï¼šå®Œæ•´ ES6 å…³é”®å­—ã€å­—é¢é‡ã€è¿ç®—ç¬¦ç€è‰²ï¼ˆæœ¬åœ° Lexerï¼‰
- **è¯­ä¹‰é«˜äº®**ï¼šåŸºäº LSP çš„ç±»å‹ã€å˜é‡ã€å‡½æ•°ç€è‰²ï¼ˆSemantic Tokensï¼‰
- **é”™è¯¯è¯Šæ–­**ï¼šå®æ—¶è¯­æ³•å’Œè¯­ä¹‰é”™è¯¯æç¤ºï¼ˆé€šè¿‡ LSPï¼‰
- **ä»£ç è¡¥å…¨**ï¼šæ™ºèƒ½æç¤ºï¼ˆé€šè¿‡ LSPï¼‰
- **è·³è½¬å®šä¹‰**ï¼šCtrl+Click è·³è½¬ï¼ˆé€šè¿‡ LSPï¼‰
- **æ ¼å¼åŒ–**ï¼šä»£ç è‡ªåŠ¨æ ¼å¼åŒ–ï¼ˆé€šè¿‡ LSPï¼‰

### æ”¯æŒçš„ OVS è¯­æ³•
- å£°æ˜å¼ UIï¼š`div { "content" }`
- ç»„ä»¶å£°æ˜ï¼š`ovsView ComponentName ({props}) : div { ... }`
- `#{}` ä¸æ¸²æŸ“å—ï¼šéš”ç¦»çº¯é€»è¾‘ä»£ç 
- å®Œæ•´ ES6 è¯­æ³•ï¼šletã€constã€classã€async/await ç­‰

## æŠ€æœ¯æ–¹å‘ï¼ˆè®¾å¤‡æ”¯æŒã€æ€§èƒ½è¦æ±‚ï¼‰

### è¿è¡Œç¯å¢ƒ
- **IntelliJ IDEA**ï¼š2025.2.1+ (Ultimate æˆ– Community)
- **ä¾èµ–æ¨¡å—**ï¼š
  - `com.intellij.modules.platform`
  - `com.intellij.modules.lsp`
- **JDK**ï¼š17+

### æ€§èƒ½è¦æ±‚
- **è¯­æ³•é«˜äº®**ï¼š< 1msï¼ˆæœ¬åœ° JFlex Lexerï¼‰
- **LSP é€šä¿¡**ï¼š< 100msï¼ˆå¼‚æ­¥ï¼‰
- **å†…å­˜å ç”¨**ï¼š< 50MBï¼ˆæ’ä»¶è‡ªèº«ï¼‰

## æ•°æ®éœ€æ±‚ï¼ˆå­˜ä»€ä¹ˆã€æ€ä¹ˆå­˜ï¼‰

### é…ç½®æ–‡ä»¶
- **build.gradle.kts**ï¼šæ„å»ºé…ç½®
- **plugin.xml**ï¼šæ’ä»¶å…ƒæ•°æ®å’Œæ‰©å±•ç‚¹æ³¨å†Œ
- **gradle.properties**ï¼šGradle å±æ€§

### æºä»£ç 
- **è¯æ³•è§„åˆ™**ï¼š`src/main/grammar/Es6.flex`ï¼ˆ230è¡Œï¼‰
- **ç”Ÿæˆä»£ç **ï¼š`src/main/gen/lexer/_Es6Lexer.java`ï¼ˆ500è¡Œï¼Œè‡ªåŠ¨ç”Ÿæˆï¼‰
- **Kotlin æºç **ï¼š`src/main/kotlin/`
  - æ–‡ä»¶ç±»å‹ã€è¯­è¨€å®šä¹‰
  - LSP æ”¯æŒæä¾›è€…
  - è¯­æ³•é«˜äº®å™¨

### ä¸´æ—¶æ•°æ®
- **æ„å»ºè¾“å‡º**ï¼š`build/` ç›®å½•
- **IDEA æ²™ç®±**ï¼š`build/idea-sandbox/`

## ä¼˜å…ˆçº§ï¼ˆç¬¬ä¸€ç‰ˆåšä»€ä¹ˆï¼‰

**P0 - åŸºç¡€è®¾æ–½ï¼ˆå·²å®Œæˆï¼‰ï¼š**
- âœ… æ–‡ä»¶ç±»å‹æ³¨å†Œï¼ˆOvsFileTypeï¼‰
- âœ… è¯­è¨€å®šä¹‰ï¼ˆOvsLanguageï¼‰
- âœ… JFlex è¯æ³•è§„åˆ™ï¼ˆEs6.flexï¼‰
- âœ… è¯­æ³•é«˜äº®å™¨ï¼ˆOvsSyntaxHighlighterï¼‰

**P1 - LSP é›†æˆï¼ˆè¿›è¡Œä¸­ï¼‰ï¼š**
- âœ… LSP æœåŠ¡å™¨è¿æ¥ï¼ˆOvsLspServerSupportProviderï¼‰
- âœ… Semantic Tokens é…ç½®
- âš ï¸ Semantic Tokens è§¦å‘ä¿®å¤
- ğŸ”„ ä»£ç è¡¥å…¨ä¼˜åŒ–
- ğŸ”„ é”™è¯¯è¯Šæ–­æ˜¾ç¤º

**P2 - é«˜çº§åŠŸèƒ½ï¼ˆè§„åˆ’ä¸­ï¼‰ï¼š**
- â³ é‡æ„åŠŸèƒ½ï¼ˆé‡å‘½åã€æå–å˜é‡ï¼‰
- â³ è°ƒè¯•å™¨é›†æˆ
- â³ Source Map æ”¯æŒ

---

# ã€ç»†èŠ‚å®ç°å±‚ã€‘

## æ–‡ä»¶ç»“æ„

```
ovs-lsp-intellij/
â”œâ”€â”€ build.gradle.kts                    # æ„å»ºé…ç½®ï¼ˆJFlex + Pluginï¼‰
â”œâ”€â”€ src/main/
â”‚   â”œâ”€â”€ grammar/
â”‚   â”‚   â””â”€â”€ Es6.flex                    # è¯æ³•è§„åˆ™ï¼ˆ230è¡Œï¼‰
â”‚   â”œâ”€â”€ gen/
â”‚   â”‚   â””â”€â”€ lexer/_Es6Lexer.java        # è‡ªåŠ¨ç”Ÿæˆï¼ˆ500è¡Œ DFAï¼‰
â”‚   â”œâ”€â”€ kotlin/com/alamhubb/ovs/testovs/
â”‚   â”‚   â”œâ”€â”€ lexer/
â”‚   â”‚   â”‚   â””â”€â”€ Es6TokenTypes.kt        # Token ç±»å‹å®šä¹‰ï¼ˆ150è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ OvsFileType.kt              # æ–‡ä»¶ç±»å‹
â”‚   â”‚   â”œâ”€â”€ OvsLanguage.kt              # è¯­è¨€å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ OvsFile.kt                  # PSI æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ OvsLspServerSupportProvider.kt  # LSP æ”¯æŒï¼ˆ198è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ OvsSyntaxHighlighter.kt     # è¯­æ³•é«˜äº®å™¨
â”‚   â”‚   â”œâ”€â”€ OvsSyntaxHighlighterFactory.kt
â”‚   â”‚   â””â”€â”€ OvsTypedHandler.kt          # è¾“å…¥å¤„ç†
â”‚   â””â”€â”€ resources/
â”‚       â”œâ”€â”€ META-INF/plugin.xml         # æ’ä»¶é…ç½®
â”‚       â””â”€â”€ icons/ovs.png               # æ–‡ä»¶å›¾æ ‡
â”œâ”€â”€ test-semantic-tokens.ovs            # æµ‹è¯•æ–‡ä»¶
â””â”€â”€ test-syntax-highlighting.ovs        # æµ‹è¯•æ–‡ä»¶
```

## æ ¸å¿ƒæŠ€æœ¯å®ç°

### 1. è¯­æ³•é«˜äº®ï¼ˆJFlex + Lexerï¼‰

#### å·¥ä½œæµç¨‹
```
.ovs æ–‡ä»¶
  â†“
JFlex Lexer (_Es6Lexer.java)
  â†“
Token æµï¼ˆLET, CONST, STRING_LITERAL, ...ï¼‰
  â†“
OvsSyntaxHighlighterï¼ˆæ˜ å°„é¢œè‰²ï¼‰
  â†“
ç¼–è¾‘å™¨ç€è‰²æ˜¾ç¤º
```

#### æ”¯æŒçš„ ES6 ç‰¹æ€§

**å…³é”®å­—ï¼ˆ60+ï¼‰ï¼š**
```
ES5: var, function, if, else, for, while, return, throw, try, catch, ...
ES6: let, const, class, extends, super, import, export, async, await, ...
```

**å­—é¢é‡ï¼š**
```javascript
// æ•°å­—ï¼ˆæ‰€æœ‰æ ¼å¼ï¼‰
123, 123.45, 1.23e10    // åè¿›åˆ¶
0xFF, 0x1a2b            // åå…­è¿›åˆ¶
0o777, 0o644            // å…«è¿›åˆ¶ï¼ˆES6ï¼‰
0b1010, 0b1111          // äºŒè¿›åˆ¶ï¼ˆES6ï¼‰

// å­—ç¬¦ä¸²ï¼ˆ3ç§ï¼‰
"double quotes"
'single quotes'
`template ${variable}`   // æ¨¡æ¿å­—ç¬¦ä¸²ï¼ˆES6ï¼‰

// æ­£åˆ™è¡¨è¾¾å¼
/pattern/gi
```

**è¿ç®—ç¬¦ï¼ˆ40+ï¼‰ï¼š**
```javascript
+, -, *, /, %, ++, --                // ç®—æœ¯
<, >, <=, >=, ==, !=, ===, !==      // æ¯”è¾ƒ
!, &&, ||                            // é€»è¾‘
=, +=, -=, *=, /=                   // èµ‹å€¼
=>, ...                              // ES6
```

#### æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| å“åº”æ—¶é—´ | < 1msï¼ˆæœ¬åœ°è¯æ³•åˆ†æï¼‰ |
| å†…å­˜å ç”¨ | æä½ï¼ˆæŸ¥è¡¨æ³•ï¼‰ |
| å‡†ç¡®åº¦ | 100%ï¼ˆåŸºäº ES6 æ ‡å‡†ï¼‰ |
| æ–‡ä»¶å¤§å°æ”¯æŒ | æ— é™åˆ¶ |

#### Es6.flex è¯æ³•è§„åˆ™ï¼ˆæ ¸å¿ƒç‰‡æ®µï¼‰

```flex
%public
%class _Es6Lexer
%implements FlexLexer
%unicode
%function advance
%type IElementType

// å…³é”®å­—
"let"        { return Es6TokenTypes.LET; }
"const"      { return Es6TokenTypes.CONST; }
"class"      { return Es6TokenTypes.CLASS; }
"async"      { return Es6TokenTypes.ASYNC; }
"await"      { return Es6TokenTypes.AWAIT; }

// å­—é¢é‡
{IDENTIFIER}      { return Es6TokenTypes.IDENTIFIER; }
{STRING_LITERAL}  { return Es6TokenTypes.STRING_LITERAL; }
{NUMERIC_LITERAL} { return Es6TokenTypes.NUMERIC_LITERAL; }

// è¿ç®—ç¬¦
"=>"         { return Es6TokenTypes.ARROW; }
"..."        { return Es6TokenTypes.SPREAD; }
```

#### OvsSyntaxHighlighter.ktï¼ˆé¢œè‰²æ˜ å°„ï¼‰

```kotlin
override fun getTokenHighlights(tokenType: IElementType): Array<TextAttributesKey> {
    return when (tokenType) {
        // å…³é”®å­—
        Es6TokenTypes.LET, Es6TokenTypes.CONST, 
        Es6TokenTypes.CLASS, Es6TokenTypes.ASYNC -> 
            arrayOf(DefaultLanguageHighlighterColors.KEYWORD)
        
        // å­—ç¬¦ä¸²
        Es6TokenTypes.STRING_LITERAL -> 
            arrayOf(DefaultLanguageHighlighterColors.STRING)
        
        // æ•°å­—
        Es6TokenTypes.NUMERIC_LITERAL -> 
            arrayOf(DefaultLanguageHighlighterColors.NUMBER)
        
        // æ³¨é‡Š
        Es6TokenTypes.LINE_COMMENT, Es6TokenTypes.BLOCK_COMMENT -> 
            arrayOf(DefaultLanguageHighlighterColors.LINE_COMMENT)
        
        else -> TextAttributesKey.EMPTY_ARRAY
    }
}
```

### 2. LSP é›†æˆï¼ˆSemantic Tokensï¼‰

#### å…³é”®é…ç½®ï¼ˆplugin.xmlï¼‰

```xml
<extensions defaultExtensionNs="com.intellij">
    <!-- æ–‡ä»¶ç±»å‹ -->
    <fileType
        name="Ovs File"
        implementationClass="com.alamhubb.ovs.testovs.OvsFileType"
        fieldName="INSTANCE"
        language="ovs"
        extensions="ovs"/>
    
    <!-- LSP æ”¯æŒï¼ˆæ ¸å¿ƒï¼‰ -->
    <platform.lsp.serverSupportProvider 
        implementation="com.alamhubb.ovs.testovs.OvsLspServerSupportProvider"/>
    
    <!-- è¾“å…¥å¤„ç†å™¨ -->
    <typedHandler 
        implementation="com.alamhubb.ovs.testovs.OvsTypedHandler"/>
    
    <!-- âŒ ä¸è¦æ³¨å†Œ parserDefinitionï¼ˆä¼šé˜»æ­¢ LSP Semantic Tokensï¼‰
    <lang.parserDefinition ... />
    -->
</extensions>
```

**ä¸ºä»€ä¹ˆä¸æ³¨å†Œ `parserDefinition`ï¼Ÿ**

IntelliJ çš„è¯­è¨€æ”¯æŒä¼˜å…ˆçº§ï¼š
1. **æœ¬åœ° PSIï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰** - å¦‚æœæœ‰ `parserDefinition`ï¼Œä½¿ç”¨æœ¬åœ°è§£æ
2. **LSP æ¨¡å¼** - æ²¡æœ‰ `parserDefinition` æ—¶ï¼Œä¾èµ– LSP æœåŠ¡å™¨
3. **æ··åˆæ¨¡å¼** - åŒæ—¶æœ‰æ—¶ï¼Œæœ¬åœ°ä¼˜å…ˆï¼ŒLSP Semantic Tokens è¢«å¿½ç•¥

å› æ­¤ï¼Œ**çº¯ LSP è¯­è¨€å¿…é¡»ä¸æ³¨å†Œ `parserDefinition`**ã€‚

#### OvsLspServerSupportProvider.ktï¼ˆæ ¸å¿ƒå®ç°ï¼‰

```kotlin
class OvsLspServerSupportProvider : LspServerSupportProvider {
    override fun fileOpened(
        project: Project,
        file: VirtualFile,
        descriptor: LspServerDescriptor
    ) {
        if (file.extension == "ovs") {
            descriptor.lspServerStarter.ensureServerStarted(descriptor)
        }
    }

    override fun createLspServerDescriptor(
        project: Project,
        root: VirtualFile
    ): LspServerDescriptor? {
        return object : LspServerDescriptor(project, "OVS Language Server") {
            override fun createCommandLine(): GeneralCommandLine {
                val serverPath = findServerPath()
                return GeneralCommandLine().apply {
                    withExePath("node")
                    addParameter(serverPath)
                    addParameter("--stdio")
                }
            }
            
            override fun createInitializationOptions(): JsonObject {
                return JsonObject().apply {
                    addProperty("locale", "zh-CN")
                }
            }
        }
    }

    override val lspCustomization: LspCustomization =
        object : LspCustomization() {
            override val semanticTokensCustomizer: LspSemanticTokensCustomizer =
                object : LspSemanticTokensSupport() {
                    override val tokenTypes = listOf(
                        "namespace", "class", "enum", "interface",
                        "typeParameter", "type", "parameter",
                        "variable", "property", "enumMember",
                        "function", "method"
                    )

                    override val tokenModifiers = listOf(
                        "declaration", "readonly", "static",
                        "async", "defaultLibrary", "local"
                    )

                    override fun getTextAttributesKey(
                        tokenType: String,
                        modifiers: List<String>
                    ): TextAttributesKey? {
                        return when (tokenType) {
                            "class" -> DefaultLanguageHighlighterColors.CLASS_NAME
                            "interface" -> DefaultLanguageHighlighterColors.INTERFACE_NAME
                            "function", "method" -> DefaultLanguageHighlighterColors.FUNCTION_CALL
                            "variable" -> DefaultLanguageHighlighterColors.LOCAL_VARIABLE
                            "parameter" -> DefaultLanguageHighlighterColors.PARAMETER
                            "property" -> DefaultLanguageHighlighterColors.INSTANCE_FIELD
                            "type" -> DefaultLanguageHighlighterColors.CLASS_REFERENCE
                            else -> null
                        }
                    }
                }
        }
    
    private fun findServerPath(): String {
        // æŸ¥æ‰¾è¯­è¨€æœåŠ¡å™¨è·¯å¾„
        val possiblePaths = listOf(
            "../test-volar-copy/langServer/dist/server.js",
            "../test-volar-copy/langServer/src/server.ts"
        )
        
        return possiblePaths.firstOrNull { File(it).exists() }
            ?: throw IllegalStateException("LSP server not found")
    }
}
```

#### LSP é€šä¿¡æµç¨‹

```
IntelliJ IDEA
  â†“ æ‰“å¼€ .ovs æ–‡ä»¶
OvsLspServerSupportProvider
  â†“ å¯åŠ¨ Node.js è¿›ç¨‹
Language Server (langServer/dist/server.js)
  â†“ LSP åè®®é€šä¿¡
  
1. initialize è¯·æ±‚
   â† capabilitiesï¼ˆæ”¯æŒçš„åŠŸèƒ½åˆ—è¡¨ï¼‰
   
2. textDocument/didOpen é€šçŸ¥
   â†’ æ–‡æ¡£å†…å®¹
   
3. textDocument/semanticTokens/full è¯·æ±‚
   â† Semantic Tokens æ•°æ®
   
4. LspSemanticTokensSupport
   â†“ æ˜ å°„é¢œè‰²
ç¼–è¾‘å™¨æ˜¾ç¤º
```

### 3. å·²çŸ¥é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

#### âŒ Semantic Tokens ä¸è§¦å‘

**é—®é¢˜ï¼š** å®¢æˆ·ç«¯ä¸å‘é€ `textDocument/semanticTokens/full` è¯·æ±‚

**å¯èƒ½åŸå› ï¼š**
1. IntelliJ éœ€è¦ç”¨æˆ·äº¤äº’ï¼ˆç¼–è¾‘å†…å®¹ï¼‰æ‰è§¦å‘
2. éœ€è¦ `workspace.semanticTokens.refreshSupport = true`
3. é…ç½®æˆ–å®ç°é—®é¢˜

**è°ƒè¯•æ­¥éª¤ï¼š**

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**
   - `Help > Diagnostic Tools > Debug Log Settings`
   - æ·»åŠ ï¼š
     ```
     #com.intellij.platform.lsp
     #com.intellij.platform.lsp.impl.LspServerImpl
     #com.intellij.platform.lsp.impl.requests
     ```
   - é‡å¯ IDE

2. **æŸ¥çœ‹æ—¥å¿—**
   - `Help > Show Log in Explorer`
   - æœç´¢ï¼š`semanticTokens`ã€`Ovs`ã€`LSP request`

3. **æµ‹è¯•è§¦å‘**
   - æ‰“å¼€ `.ovs` æ–‡ä»¶
   - **åœ¨ç¼–è¾‘å™¨ä¸­è¾“å…¥å†…å®¹**ï¼ˆå…³é”®ï¼‰
   - è§‚å¯ŸæœåŠ¡ç«¯æ—¥å¿—

**ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼š**
- JFlex è¯­æ³•é«˜äº®å·²å®Œæ•´æ”¯æŒï¼ˆè¶³å¤Ÿæ—¥å¸¸ä½¿ç”¨ï¼‰
- ç»§ç»­è°ƒè¯• LSP Semantic Tokens

---

## å¼€å‘å‘½ä»¤

### ç”Ÿæˆ Lexer
```bash
cd ovs-lsp-intellij

# ä¿®æ”¹ Es6.flex åå¿…é¡»æ‰§è¡Œ
./gradlew generateLexer

# è¾“å‡ºï¼šsrc/main/gen/lexer/_Es6Lexer.java
```

### æ„å»ºæ’ä»¶
```bash
# å®Œæ•´æ„å»º
./gradlew buildPlugin

# è¾“å‡ºï¼šbuild/distributions/test1ovs-1.0-SNAPSHOT.zip
```

### è¿è¡Œæµ‹è¯• IDE
```bash
./gradlew runIde

# å¯åŠ¨æ²™ç®± IntelliJ IDEA
# è‡ªåŠ¨åŠ è½½æ’ä»¶
```

### æ¸…ç†
```bash
./gradlew clean

# åˆ é™¤ build/ ç›®å½•
```

### å®Œæ•´æµç¨‹
```bash
# 1. ä¿®æ”¹è¯æ³•è§„åˆ™
vim src/main/grammar/Es6.flex

# 2. é‡æ–°ç”Ÿæˆ
./gradlew generateLexer

# 3. æ„å»º
./gradlew buildPlugin

# 4. æµ‹è¯•
./gradlew runIde
```

---

## æµ‹è¯•ä¸éªŒè¯

### 1. è¯­æ³•é«˜äº®æµ‹è¯•

**æµ‹è¯•æ–‡ä»¶ï¼š** `test-syntax-highlighting.ovs`

```javascript
// ES6 è¯­æ³•é«˜äº®æµ‹è¯•
let userName = "Alice"
const userAge = 25

class Person {
  constructor(name, age) {
    this.name = name
    this.age = age
  }
  
  async fetchData() {
    const response = await fetch('/api/user')
    return response.json()
  }
}

import { User } from './models'
export default Person

const message = `Hello, ${userName}!`
const double = x => x * 2
const { name, age } = user
const newArray = [...oldArray, 4, 5]
```

**é¢„æœŸæ•ˆæœï¼š**
- âœ… å…³é”®å­— â†’ ç´«è‰²/æ©™è‰²
- âœ… å­—ç¬¦ä¸² â†’ ç»¿è‰²
- âœ… æ•°å­— â†’ è“è‰²
- âœ… æ³¨é‡Š â†’ ç°è‰²

### 2. Semantic Tokens æµ‹è¯•

**æµ‹è¯•æ–‡ä»¶ï¼š** `test-semantic-tokens.ovs`

```javascript
class UserManager {
  private users: User[]
  
  async getUser(id: number): Promise<User> {
    return this.users.find(u => u.id === id)
  }
}
```

**é¢„æœŸæ•ˆæœï¼ˆå¾…ä¿®å¤ï¼‰ï¼š**
- âœ… `UserManager` â†’ CLASS_NAME é¢œè‰²
- âœ… `getUser` â†’ FUNCTION_CALL é¢œè‰²
- âœ… `users`, `id` â†’ LOCAL_VARIABLE é¢œè‰²

### 3. LSP è¿æ¥æµ‹è¯•

**æ­¥éª¤ï¼š**
1. è¿è¡Œ `./gradlew runIde`
2. æ‰“å¼€ `.ovs` æ–‡ä»¶
3. æŸ¥çœ‹ IDE æ—¥å¿—ï¼ˆHelp > Show Logï¼‰

**é¢„æœŸæ—¥å¿—ï¼š**
```
LSP server starting: node .../server.js --stdio
LSP server started successfully
textDocument/didOpen sent
Language ID: ovs
```

---

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
cd ovs-lsp-all/ovs-lsp-intellij

# æ£€æŸ¥ JDK ç‰ˆæœ¬ï¼ˆéœ€è¦ 17+ï¼‰
java -version

# æ£€æŸ¥ Gradle
./gradlew --version
```

### 2. ç”Ÿæˆå¹¶æ„å»º

```bash
# ç”Ÿæˆ Lexer
./gradlew generateLexer

# æ„å»ºæ’ä»¶
./gradlew buildPlugin
```

### 3. è¿è¡Œæµ‹è¯•

```bash
# å¯åŠ¨æµ‹è¯• IDE
./gradlew runIde

# åœ¨æµ‹è¯• IDE ä¸­ï¼š
# 1. File > Open > é€‰æ‹© test-syntax-highlighting.ovs
# 2. éªŒè¯è¯­æ³•é«˜äº®
# 3. ç¼–è¾‘å†…å®¹ï¼Œè§‚å¯Ÿ Semantic Tokens
```

### 4. å®‰è£…åˆ°æœ¬åœ° IDE

```bash
# æ„å»º zip
./gradlew buildPlugin

# åœ¨ IntelliJ IDEA ä¸­ï¼š
# Settings > Plugins > âš™ï¸ > Install Plugin from Disk
# é€‰æ‹©ï¼šbuild/distributions/test1ovs-1.0-SNAPSHOT.zip
```

---

## ä¾èµ–çš„æœåŠ¡ç«¯

### è¯­è¨€æœåŠ¡å™¨
- **é¡¹ç›®**ï¼š`../test-volar-copy/langServer`
- **å¯åŠ¨å‘½ä»¤**ï¼š`node dist/server.js --stdio`
- **åè®®**ï¼šLSP (Language Server Protocol)
- **åŠŸèƒ½**ï¼š
  - Semantic Tokens
  - ä»£ç è¡¥å…¨
  - è·³è½¬å®šä¹‰
  - é”™è¯¯è¯Šæ–­

### OVS ç¼–è¯‘å™¨
- **é¡¹ç›®**ï¼š`../test-volar-copy/ovs`
- **ä½œç”¨**ï¼šç¼–è¯‘ .ovs æ–‡ä»¶ä¸º JavaScript
- **é›†æˆ**ï¼šé€šè¿‡è¯­è¨€æœåŠ¡å™¨é—´æ¥ä½¿ç”¨

---

## æ–‡æ¡£ä½“ç³»

### æœ¬é¡¹ç›®æ–‡æ¡£
1. **`.cursor/rules/project.mdc`** - ğŸ“Œ å®Œæ•´é¡¹ç›®ä¿¡æ¯ï¼ˆæœ¬æ–‡ä»¶ï¼‰
2. **`INLAY_HINTS_PLAN_B.md`** - ğŸ“‹ Inlay Hints åŸç”Ÿå®ç°æ–¹æ¡ˆï¼ˆè§„åˆ’ï¼‰
3. **`ES6_SYNTAX_HIGHLIGHTING_GUIDE.md`** - ğŸ“š JFlex å®ç°è¯¦ç»†æŒ‡å—
4. **`SOLUTION_SEMANTIC_TOKENS.md`** - ğŸ“š LSP é—®é¢˜è§£å†³æ–¹æ¡ˆ

### ç›¸å…³é¡¹ç›®æ–‡æ¡£
- **test-volar-copy/langServer/.cursor/rules/project.mdc** - OVS è¯­è¨€æœåŠ¡å™¨
- **test-volar-copy/ovs/.cursor/rules/project.mdc** - OVS ç¼–è¯‘å™¨

---

# ã€å˜æ›´è®°å½•ã€‘

## 2025-10-29 [Inlay Hints æµ‹è¯•ä¸ä¼˜åŒ–]
- âœ… å®Œæ•´æµ‹è¯• Inlay Hints åŠŸèƒ½
- âœ… ç¡®è®¤ IntelliJ API é™åˆ¶
- âœ… è®°å½•æ–¹æ¡ˆBå®ç°æ–¹æ¡ˆï¼ˆ`INLAY_HINTS_PLAN_B.md`ï¼‰
- âœ… æ›´æ–° LSP åŠŸèƒ½æ”¯æŒè¡¨æ ¼
- âœ… ä¼˜åŒ–é¡¹ç›®æ–‡æ¡£ç»“æ„
- âœ… å‡çº§ Gradle 8.11.1 â†’ 8.13

## 2025-10-29 [æ–‡æ¡£é‡æ„]
- âœ… åˆ†ç¦»å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ–‡æ¡£
- âœ… ä¸“æ³¨äº IntelliJ æ’ä»¶å®ç°
- âœ… å®Œå–„ LSP é›†æˆè¯´æ˜
- âœ… æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æŒ‡å—

## å†å²è®°å½•
- âœ… JFlex ES6 è¯­æ³•é«˜äº®å®ç°ï¼ˆ230è¡Œè¯æ³•è§„åˆ™ï¼‰
- âœ… LSP æœåŠ¡å™¨è¿æ¥ï¼ˆOvsLspServerSupportProviderï¼‰
- âœ… Semantic Tokens é…ç½®ï¼ˆé¢œè‰²æ˜ å°„ï¼‰
- âœ… Semantic Tokens è§¦å‘é—®é¢˜ä¿®å¤ï¼ˆå·²éªŒè¯å·¥ä½œæ­£å¸¸ï¼‰
- âœ… ä»£ç è¡¥å…¨åŠŸèƒ½éªŒè¯ï¼ˆå·²æ­£å¸¸å·¥ä½œï¼‰

---

**IntelliJ IDEA æ’ä»¶ | LSP å®¢æˆ·ç«¯ | æœ€åæ›´æ–°: 2025-10-29**
